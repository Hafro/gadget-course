<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Defining stock interations | Building models using the Gadget framework</title>
  <meta name="description" content="5 Defining stock interations | Building models using the Gadget framework" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Defining stock interations | Building models using the Gadget framework" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Defining stock interations | Building models using the Gadget framework" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="getting-started-with-the-gadget-framework.html"/>
<link rel="next" href="building-complex-gadget-models.html"/>
<script src="assets/jquery-2.2.3/jquery.min.js"></script>
<link href="assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="assets/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="assets/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="assets/anchor-sections-1.0/anchor-sections.js"></script>
<script src="assets/htmlwidgets-1.5.2/htmlwidgets.js"></script>
<link href="assets/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="assets/datatables-binding-0.16/datatables.js"></script>
<link href="assets/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="assets/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="assets/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="assets/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="assets/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">Building Gadget models</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> About this course</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#course-objectives"><i class="fa fa-check"></i><b>1.1</b> Course objectives</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#your-a-priori-homework"><i class="fa fa-check"></i><b>1.2</b> Your a priori homework</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#reading-material"><i class="fa fa-check"></i><b>1.3</b> Reading material</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="general-context-of-gadget.html"><a href="general-context-of-gadget.html"><i class="fa fa-check"></i><b>2</b> General context of Gadget</a><ul>
<li class="chapter" data-level="2.1" data-path="general-context-of-gadget.html"><a href="general-context-of-gadget.html#gadget-a-toolbox-for-fisheries-stock-assessments"><i class="fa fa-check"></i><b>2.1</b> Gadget – a toolbox for fisheries stock assessments</a></li>
<li class="chapter" data-level="2.2" data-path="general-context-of-gadget.html"><a href="general-context-of-gadget.html#description-of-gadget"><i class="fa fa-check"></i><b>2.2</b> Description of Gadget</a></li>
<li class="chapter" data-level="2.3" data-path="general-context-of-gadget.html"><a href="general-context-of-gadget.html#this-course"><i class="fa fa-check"></i><b>2.3</b> This course</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html"><i class="fa fa-check"></i><b>3</b> Introduction to Tidyverse</a><ul>
<li class="chapter" data-level="3.1" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#idealogy-behind-r-for-data-science"><i class="fa fa-check"></i><b>3.1</b> Idealogy behind R for Data Science</a></li>
<li class="chapter" data-level="3.2" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#the-foundation-tibbles-tidy-data-and-piping"><i class="fa fa-check"></i><b>3.2</b> The foundation: tibbles, tidy data, and piping</a><ul>
<li class="chapter" data-level="3.2.1" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#tibbles"><i class="fa fa-check"></i><b>3.2.1</b> Tibbles</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#tidy-data"><i class="fa fa-check"></i><b>3.3</b> Tidy data</a><ul>
<li class="chapter" data-level="3.3.1" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#piping"><i class="fa fa-check"></i><b>3.3.1</b> Piping</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#the-power-of-tidyverse-all-you-need-in-a-handful-of-functions"><i class="fa fa-check"></i><b>3.4</b> The power of tidyverse: all you need in a handful of functions</a></li>
<li class="chapter" data-level="3.5" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#plotting-in-tidyverse"><i class="fa fa-check"></i><b>3.5</b> Plotting in tidyverse</a><ul>
<li class="chapter" data-level="3.5.1" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#ggplot-key-components"><i class="fa fa-check"></i><b>3.5.1</b> ggplot: Key components</a></li>
<li class="chapter" data-level="3.5.2" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#aesthetic"><i class="fa fa-check"></i><b>3.5.2</b> aesthetic</a></li>
<li class="chapter" data-level="3.5.3" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#facetting"><i class="fa fa-check"></i><b>3.5.3</b> Facetting</a></li>
<li class="chapter" data-level="3.5.4" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#adding-layers"><i class="fa fa-check"></i><b>3.5.4</b> Adding layers</a></li>
<li class="chapter" data-level="3.5.5" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#add-a-line-to-a-scatterplot"><i class="fa fa-check"></i><b>3.5.5</b> Add a line to a scatterplot</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#statistical-summary-graphs"><i class="fa fa-check"></i><b>3.6</b> Statistical summary graphs</a></li>
<li class="chapter" data-level="3.7" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#other-statistical-summaries"><i class="fa fa-check"></i><b>3.7</b> Other statistical summaries</a></li>
<li class="chapter" data-level="3.8" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#some-controls"><i class="fa fa-check"></i><b>3.8</b> Some controls</a><ul>
<li class="chapter" data-level="3.8.1" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#labels"><i class="fa fa-check"></i><b>3.8.1</b> labels</a></li>
<li class="chapter" data-level="3.8.2" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#legend-position"><i class="fa fa-check"></i><b>3.8.2</b> Legend position</a></li>
<li class="chapter" data-level="3.8.3" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#breaks"><i class="fa fa-check"></i><b>3.8.3</b> breaks</a></li>
<li class="chapter" data-level="3.8.4" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#limits"><i class="fa fa-check"></i><b>3.8.4</b> limits</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#further-readings"><i class="fa fa-check"></i><b>3.9</b> Further readings</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html"><i class="fa fa-check"></i><b>4</b> Getting started with the Gadget framework</a><ul>
<li class="chapter" data-level="4.1" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html#what-is-rgadget"><i class="fa fa-check"></i><b>4.1</b> What is Rgadget?</a></li>
<li class="chapter" data-level="4.2" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html#using-rgadget"><i class="fa fa-check"></i><b>4.2</b> Using Rgadget</a></li>
<li class="chapter" data-level="4.3" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html#creating-model-input-files"><i class="fa fa-check"></i><b>4.3</b> Creating model input files</a><ul>
<li class="chapter" data-level="4.3.1" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html#time-file"><i class="fa fa-check"></i><b>4.3.1</b> Time file</a></li>
<li class="chapter" data-level="4.3.2" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html#area-file"><i class="fa fa-check"></i><b>4.3.2</b> Area file</a></li>
<li class="chapter" data-level="4.3.3" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html#stockfiles"><i class="fa fa-check"></i><b>4.3.3</b> Stockfiles</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html#starting-a-simulation"><i class="fa fa-check"></i><b>4.4</b> Starting a simulation</a></li>
<li class="chapter" data-level="4.5" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html#gadget-variables"><i class="fa fa-check"></i><b>4.5</b> Gadget variables</a></li>
<li class="chapter" data-level="4.6" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html#predation"><i class="fa fa-check"></i><b>4.6</b> Predation</a></li>
<li class="chapter" data-level="4.7" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html#fleet-operations"><i class="fa fa-check"></i><b>4.7</b> Fleet operations</a><ul>
<li class="chapter" data-level="4.7.1" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html#excercise"><i class="fa fa-check"></i><b>4.7.1</b> Excercise</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html#recruitment"><i class="fa fa-check"></i><b>4.8</b> Recruitment</a><ul>
<li class="chapter" data-level="4.8.1" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html#exercise-1"><i class="fa fa-check"></i><b>4.8.1</b> Exercise</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="defining-stock-interations.html"><a href="defining-stock-interations.html"><i class="fa fa-check"></i><b>5</b> Defining stock interations</a><ul>
<li class="chapter" data-level="5.1" data-path="defining-stock-interations.html"><a href="defining-stock-interations.html#fish-recruits-into-a-stock"><i class="fa fa-check"></i><b>5.1</b> Fish recruits into a stock</a><ul>
<li class="chapter" data-level="5.1.1" data-path="defining-stock-interations.html"><a href="defining-stock-interations.html#excercise-1"><i class="fa fa-check"></i><b>5.1.1</b> Excercise</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="defining-stock-interations.html"><a href="defining-stock-interations.html#spawning"><i class="fa fa-check"></i><b>5.2</b> Spawning</a><ul>
<li class="chapter" data-level="5.2.1" data-path="defining-stock-interations.html"><a href="defining-stock-interations.html#time-variables"><i class="fa fa-check"></i><b>5.2.1</b> Time variables</a></li>
<li class="chapter" data-level="5.2.2" data-path="defining-stock-interations.html"><a href="defining-stock-interations.html#excercise-2"><i class="fa fa-check"></i><b>5.2.2</b> Excercise</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="defining-stock-interations.html"><a href="defining-stock-interations.html#consumption"><i class="fa fa-check"></i><b>5.3</b> Consumption</a><ul>
<li class="chapter" data-level="5.3.1" data-path="defining-stock-interations.html"><a href="defining-stock-interations.html#excercise-3"><i class="fa fa-check"></i><b>5.3.1</b> Excercise</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="building-complex-gadget-models.html"><a href="building-complex-gadget-models.html"><i class="fa fa-check"></i><b>6</b> Building complex Gadget models</a><ul>
<li class="chapter" data-level="6.1" data-path="building-complex-gadget-models.html"><a href="building-complex-gadget-models.html#defining-growth"><i class="fa fa-check"></i><b>6.1</b> Defining growth</a><ul>
<li class="chapter" data-level="6.1.1" data-path="building-complex-gadget-models.html"><a href="building-complex-gadget-models.html#growth"><i class="fa fa-check"></i><b>6.1.1</b> Growth</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="building-complex-gadget-models.html"><a href="building-complex-gadget-models.html#ling-stock-assessment-in-icelandic-waters"><i class="fa fa-check"></i><b>6.2</b> Ling stock assessment in Icelandic waters</a></li>
<li class="chapter" data-level="6.3" data-path="building-complex-gadget-models.html"><a href="building-complex-gadget-models.html#model-initiation"><i class="fa fa-check"></i><b>6.3</b> Model initiation</a><ul>
<li class="chapter" data-level="6.3.1" data-path="building-complex-gadget-models.html"><a href="building-complex-gadget-models.html#maturation-as-multi-stock-models"><i class="fa fa-check"></i><b>6.3.1</b> Maturation as multi-‘stock’ models</a></li>
<li class="chapter" data-level="6.3.2" data-path="building-complex-gadget-models.html"><a href="building-complex-gadget-models.html#initial-conditions"><i class="fa fa-check"></i><b>6.3.2</b> Initial conditions</a></li>
<li class="chapter" data-level="6.3.3" data-path="building-complex-gadget-models.html"><a href="building-complex-gadget-models.html#renewal"><i class="fa fa-check"></i><b>6.3.3</b> Renewal</a></li>
<li class="chapter" data-level="6.3.4" data-path="building-complex-gadget-models.html"><a href="building-complex-gadget-models.html#reference-weight"><i class="fa fa-check"></i><b>6.3.4</b> Reference Weight</a></li>
<li class="chapter" data-level="6.3.5" data-path="building-complex-gadget-models.html"><a href="building-complex-gadget-models.html#is-fished-eaten"><i class="fa fa-check"></i><b>6.3.5</b> Is fished / eaten</a></li>
<li class="chapter" data-level="6.3.6" data-path="building-complex-gadget-models.html"><a href="building-complex-gadget-models.html#set-up-fleets-using-catch-or-effort-data"><i class="fa fa-check"></i><b>6.3.6</b> Set up fleets using catch or effort data</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="building-complex-gadget-models.html"><a href="building-complex-gadget-models.html#run-the-simulation-using-pre-determined-parameters"><i class="fa fa-check"></i><b>6.4</b> Run the simulation using pre-determined parameters</a></li>
<li class="chapter" data-level="6.5" data-path="building-complex-gadget-models.html"><a href="building-complex-gadget-models.html#talking-points"><i class="fa fa-check"></i><b>6.5</b> Talking points</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="fitting-a-model-to-data.html"><a href="fitting-a-model-to-data.html"><i class="fa fa-check"></i><b>7</b> Fitting a model to data</a><ul>
<li class="chapter" data-level="7.1" data-path="fitting-a-model-to-data.html"><a href="fitting-a-model-to-data.html#introducing-likelihood-functions"><i class="fa fa-check"></i><b>7.1</b> Introducing likelihood functions</a></li>
<li class="chapter" data-level="7.2" data-path="fitting-a-model-to-data.html"><a href="fitting-a-model-to-data.html#incorporating-data-ling-case-study-cont."><i class="fa fa-check"></i><b>7.2</b> Incorporating data (Ling case study cont.)</a><ul>
<li class="chapter" data-level="7.2.1" data-path="fitting-a-model-to-data.html"><a href="fitting-a-model-to-data.html#exercise-3"><i class="fa fa-check"></i><b>7.2.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="fitting-a-model-to-data.html"><a href="fitting-a-model-to-data.html#setting-up-likelihood-components"><i class="fa fa-check"></i><b>7.3</b> Setting up likelihood components</a><ul>
<li class="chapter" data-level="7.3.1" data-path="fitting-a-model-to-data.html"><a href="fitting-a-model-to-data.html#setting-up-survey-indices"><i class="fa fa-check"></i><b>7.3.1</b> Setting up survey indices</a></li>
<li class="chapter" data-level="7.3.2" data-path="fitting-a-model-to-data.html"><a href="fitting-a-model-to-data.html#penalty-functions"><i class="fa fa-check"></i><b>7.3.2</b> Penalty functions</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="fitting-a-model-to-data.html"><a href="fitting-a-model-to-data.html#fitting-a-gadget-model-to-data"><i class="fa fa-check"></i><b>7.4</b> Fitting a Gadget model to data</a><ul>
<li class="chapter" data-level="7.4.1" data-path="fitting-a-model-to-data.html"><a href="fitting-a-model-to-data.html#create-starting-values"><i class="fa fa-check"></i><b>7.4.1</b> Create starting values</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="fitting-a-model-to-data.html"><a href="fitting-a-model-to-data.html#set-optimisation-routine"><i class="fa fa-check"></i><b>7.5</b> Set optimisation routine</a></li>
<li class="chapter" data-level="7.6" data-path="fitting-a-model-to-data.html"><a href="fitting-a-model-to-data.html#using-the-iterative-reweighting-function-to-fit-a-gadget-statistical-model"><i class="fa fa-check"></i><b>7.6</b> Using the iterative reweighting function to fit a Gadget statistical model</a></li>
<li class="chapter" data-level="7.7" data-path="fitting-a-model-to-data.html"><a href="fitting-a-model-to-data.html#visualize-gadget-statistical-model-fit"><i class="fa fa-check"></i><b>7.7</b> Visualize Gadget statistical model fit</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="defining-multi-area-models.html"><a href="defining-multi-area-models.html"><i class="fa fa-check"></i><b>8</b> Defining multi area models</a><ul>
<li class="chapter" data-level="8.1" data-path="defining-multi-area-models.html"><a href="defining-multi-area-models.html#alternate-structures-multiple-areas"><i class="fa fa-check"></i><b>8.1</b> Alternate structures: multiple areas</a><ul>
<li class="chapter" data-level="8.1.1" data-path="defining-multi-area-models.html"><a href="defining-multi-area-models.html#migration"><i class="fa fa-check"></i><b>8.1.1</b> Migration</a></li>
<li class="chapter" data-level="8.1.2" data-path="defining-multi-area-models.html"><a href="defining-multi-area-models.html#using-data-from-multiple-areas"><i class="fa fa-check"></i><b>8.1.2</b> Using data from multiple areas</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="marine-mammals.html"><a href="marine-mammals.html"><i class="fa fa-check"></i><b>9</b> Marine mammals</a><ul>
<li class="chapter" data-level="9.1" data-path="marine-mammals.html"><a href="marine-mammals.html#setting-up-a-model-for-a-hypothetical-whale-stock"><i class="fa fa-check"></i><b>9.1</b> Setting up a model for a hypothetical whale stock</a></li>
<li class="chapter" data-level="9.2" data-path="marine-mammals.html"><a href="marine-mammals.html#run-gadget-and-set-initial-parameters"><i class="fa fa-check"></i><b>9.2</b> Run Gadget and set initial parameters</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html"><i class="fa fa-check"></i><b>10</b> Processing input data with MFDB</a><ul>
<li class="chapter" data-level="10.1" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#working-with-data"><i class="fa fa-check"></i><b>10.1</b> Working with data</a></li>
<li class="chapter" data-level="10.2" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#description-of-the-mfdb-system"><i class="fa fa-check"></i><b>10.2</b> Description of the MFDB system</a><ul>
<li class="chapter" data-level="10.2.1" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#installing-mfdb"><i class="fa fa-check"></i><b>10.2.1</b> Installing MFDB</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#importing-data"><i class="fa fa-check"></i><b>10.3</b> Importing data</a><ul>
<li class="chapter" data-level="10.3.1" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#connect-to-database"><i class="fa fa-check"></i><b>10.3.1</b> Connect to database</a></li>
<li class="chapter" data-level="10.3.2" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#defining-taxonomies"><i class="fa fa-check"></i><b>10.3.2</b> Defining taxonomies</a></li>
<li class="chapter" data-level="10.3.3" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#define-areas-divisions"><i class="fa fa-check"></i><b>10.3.3</b> Define areas &amp; divisions</a></li>
<li class="chapter" data-level="10.3.4" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#define-sampling-types"><i class="fa fa-check"></i><b>10.3.4</b> Define sampling types</a></li>
<li class="chapter" data-level="10.3.5" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#define-vessel-taxonomy"><i class="fa fa-check"></i><b>10.3.5</b> Define vessel taxonomy</a></li>
<li class="chapter" data-level="10.3.6" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#define-tow-taxonomy"><i class="fa fa-check"></i><b>10.3.6</b> Define tow taxonomy</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#importing-data-1"><i class="fa fa-check"></i><b>10.4</b> Importing data</a><ul>
<li class="chapter" data-level="10.4.1" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#import-temperature-data"><i class="fa fa-check"></i><b>10.4.1</b> Import temperature data</a></li>
<li class="chapter" data-level="10.4.2" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#importing-surveycommercial-samples"><i class="fa fa-check"></i><b>10.4.2</b> Importing survey/commercial samples</a></li>
<li class="chapter" data-level="10.4.3" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#import-stomach-survey"><i class="fa fa-check"></i><b>10.4.3</b> Import stomach survey</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#querying-data"><i class="fa fa-check"></i><b>10.5</b> Querying data</a></li>
<li class="chapter" data-level="10.6" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#uploading-the-datras-database-to-mfdb"><i class="fa fa-check"></i><b>10.6</b> Uploading the DATRAS database to MFDB</a></li>
<li class="chapter" data-level="10.7" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#dumping-restoring-a-db"><i class="fa fa-check"></i><b>10.7</b> Dumping / Restoring a DB</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="installing-gadget-from-source.html"><a href="installing-gadget-from-source.html"><i class="fa fa-check"></i><b>A</b> Installing Gadget from source</a><ul>
<li class="chapter" data-level="A.1" data-path="installing-gadget-from-source.html"><a href="installing-gadget-from-source.html#command-line-version"><i class="fa fa-check"></i><b>A.1</b> Command line version</a><ul>
<li class="chapter" data-level="A.1.1" data-path="installing-gadget-from-source.html"><a href="installing-gadget-from-source.html#linux"><i class="fa fa-check"></i><b>A.1.1</b> Linux</a></li>
<li class="chapter" data-level="A.1.2" data-path="installing-gadget-from-source.html"><a href="installing-gadget-from-source.html#mac"><i class="fa fa-check"></i><b>A.1.2</b> Mac</a></li>
<li class="chapter" data-level="A.1.3" data-path="installing-gadget-from-source.html"><a href="installing-gadget-from-source.html#windows"><i class="fa fa-check"></i><b>A.1.3</b> Windows</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="installing-gadget-from-source.html"><a href="installing-gadget-from-source.html#download-compile-and-install"><i class="fa fa-check"></i><b>A.2</b> Download, compile and install</a><ul>
<li class="chapter" data-level="A.2.1" data-path="installing-gadget-from-source.html"><a href="installing-gadget-from-source.html#standard-procedure"><i class="fa fa-check"></i><b>A.2.1</b> Standard procedure</a></li>
<li class="chapter" data-level="A.2.2" data-path="installing-gadget-from-source.html"><a href="installing-gadget-from-source.html#recommended-via-git"><i class="fa fa-check"></i><b>A.2.2</b> Recommended: via Git</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="troubleshooting-gadget-models.html"><a href="troubleshooting-gadget-models.html"><i class="fa fa-check"></i><b>B</b> Troubleshooting Gadget models</a><ul>
<li class="chapter" data-level="B.1" data-path="troubleshooting-gadget-models.html"><a href="troubleshooting-gadget-models.html#file-data-gadget-cannot-be-found"><i class="fa fa-check"></i><b>B.1</b> File / data / Gadget cannot be found</a></li>
<li class="chapter" data-level="B.2" data-path="troubleshooting-gadget-models.html"><a href="troubleshooting-gadget-models.html#fleet-data-likelihood-problems"><i class="fa fa-check"></i><b>B.2</b> Fleet / Data / Likelihood problems</a><ul>
<li class="chapter" data-level="B.2.1" data-path="troubleshooting-gadget-models.html"><a href="troubleshooting-gadget-models.html#fleet-does-not-exist-in-an-area"><i class="fa fa-check"></i><b>B.2.1</b> Fleet does not exist in an area</a></li>
<li class="chapter" data-level="B.2.2" data-path="troubleshooting-gadget-models.html"><a href="troubleshooting-gadget-models.html#certain-likelihood-scores-or-values-are-not-being-calculated"><i class="fa fa-check"></i><b>B.2.2</b> Certain likelihood scores or values are not being calculated</a></li>
<li class="chapter" data-level="B.2.3" data-path="troubleshooting-gadget-models.html"><a href="troubleshooting-gadget-models.html#starting-value-is-outside-the-bounds-of-the-parameter"><i class="fa fa-check"></i><b>B.2.3</b> Starting value is outside the bounds of the parameter</a></li>
<li class="chapter" data-level="B.2.4" data-path="troubleshooting-gadget-models.html"><a href="troubleshooting-gadget-models.html#update-gadget-and-rgadget-restart-the-rsession"><i class="fa fa-check"></i><b>B.2.4</b> Update Gadget and Rgadget, restart the Rsession</a></li>
</ul></li>
<li class="chapter" data-level="B.3" data-path="troubleshooting-gadget-models.html"><a href="troubleshooting-gadget-models.html#list-of-known-gadget-quirks"><i class="fa fa-check"></i><b>B.3</b> List of known Gadget quirks</a></li>
<li class="chapter" data-level="B.4" data-path="troubleshooting-gadget-models.html"><a href="troubleshooting-gadget-models.html#gadget-is-working-properly-but-results-are-strange"><i class="fa fa-check"></i><b>B.4</b> Gadget is working properly, but results are strange</a><ul>
<li class="chapter" data-level="B.4.1" data-path="troubleshooting-gadget-models.html"><a href="troubleshooting-gadget-models.html#programming-errors"><i class="fa fa-check"></i><b>B.4.1</b> Programming errors</a></li>
<li class="chapter" data-level="B.4.2" data-path="troubleshooting-gadget-models.html"><a href="troubleshooting-gadget-models.html#old-files-hanging-around-in-the-gadget-model-directory"><i class="fa fa-check"></i><b>B.4.2</b> Old files hanging around in the Gadget model directory</a></li>
<li class="chapter" data-level="B.4.3" data-path="troubleshooting-gadget-models.html"><a href="troubleshooting-gadget-models.html#gadget-iterative-gives-errors"><i class="fa fa-check"></i><b>B.4.3</b> Gadget iterative gives errors</a></li>
<li class="chapter" data-level="B.4.4" data-path="troubleshooting-gadget-models.html"><a href="troubleshooting-gadget-models.html#the-gadget-working-directory-is-incorporating-files-from-another-gadget-model"><i class="fa fa-check"></i><b>B.4.4</b> The Gadget working directory is incorporating files from another Gadget model</a></li>
<li class="chapter" data-level="B.4.5" data-path="troubleshooting-gadget-models.html"><a href="troubleshooting-gadget-models.html#your-model-is-not-good"><i class="fa fa-check"></i><b>B.4.5</b> Your model is not good</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="C" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>C</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Building models using the Gadget framework</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="defining-stock-interations" class="section level1">
<h1><span class="header-section-number">5</span> Defining stock interations</h1>
<p>As we have already seen there are a number of ways we can define interactions between stocks. Here we will, however, explore further the various different mechanisms implemented in Gadget. These interaction can essentially be grouped into two categories:</p>
<ul>
<li>Fish entering stock due to a process in a related stock
<ul>
<li>This can be either movement between stocks or spawning</li>
</ul></li>
<li>Fish is removed from a stock due to predation</li>
</ul>
<p>We will illustrate these processes using a simple multistock model:</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="defining-stock-interations.html#cb156-1"></a>gd &lt;-<span class="st"> </span><span class="kw">gadget.variant.dir</span>(<span class="st">&#39;simple_multistock_model&#39;</span>)</span>
<span id="cb156-2"><a href="defining-stock-interations.html#cb156-2"></a></span>
<span id="cb156-3"><a href="defining-stock-interations.html#cb156-3"></a>schedule &lt;-<span class="st"> </span></span>
<span id="cb156-4"><a href="defining-stock-interations.html#cb156-4"></a><span class="st">  </span><span class="kw">expand.grid</span>(<span class="dt">year =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">30</span>, <span class="dt">step =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb156-5"><a href="defining-stock-interations.html#cb156-5"></a><span class="st">  </span><span class="kw">arrange</span>(year)</span>
<span id="cb156-6"><a href="defining-stock-interations.html#cb156-6"></a></span>
<span id="cb156-7"><a href="defining-stock-interations.html#cb156-7"></a><span class="kw">gadgetfile</span>(<span class="st">&#39;Modelfiles/area&#39;</span>,</span>
<span id="cb156-8"><a href="defining-stock-interations.html#cb156-8"></a>           <span class="dt">file_type =</span> <span class="st">&#39;area&#39;</span>,</span>
<span id="cb156-9"><a href="defining-stock-interations.html#cb156-9"></a>           <span class="dt">components =</span> <span class="kw">list</span>(<span class="kw">list</span>(<span class="dt">areas =</span> <span class="dv">1</span>,</span>
<span id="cb156-10"><a href="defining-stock-interations.html#cb156-10"></a>                                  <span class="dt">size =</span> <span class="dv">1</span>,</span>
<span id="cb156-11"><a href="defining-stock-interations.html#cb156-11"></a>                                  <span class="dt">temperature =</span> schedule <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb156-12"><a href="defining-stock-interations.html#cb156-12"></a><span class="st">                                    </span><span class="kw">mutate</span>(<span class="dt">area =</span> <span class="dv">1</span>, <span class="dt">temperature =</span> <span class="dv">5</span>)))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb156-13"><a href="defining-stock-interations.html#cb156-13"></a><span class="st">  </span><span class="kw">write.gadget.file</span>(gd)</span>
<span id="cb156-14"><a href="defining-stock-interations.html#cb156-14"></a></span>
<span id="cb156-15"><a href="defining-stock-interations.html#cb156-15"></a><span class="kw">gadgetfile</span>(<span class="st">&#39;Modelfiles/time&#39;</span>,</span>
<span id="cb156-16"><a href="defining-stock-interations.html#cb156-16"></a>           <span class="dt">file_type =</span> <span class="st">&#39;time&#39;</span>,</span>
<span id="cb156-17"><a href="defining-stock-interations.html#cb156-17"></a>           <span class="dt">components =</span> <span class="kw">list</span>(<span class="kw">list</span>(<span class="dt">firstyear =</span> <span class="kw">min</span>(schedule<span class="op">$</span>year),</span>
<span id="cb156-18"><a href="defining-stock-interations.html#cb156-18"></a>                                  <span class="dt">firststep=</span><span class="dv">1</span>,</span>
<span id="cb156-19"><a href="defining-stock-interations.html#cb156-19"></a>                                  <span class="dt">lastyear=</span><span class="kw">max</span>(schedule<span class="op">$</span>year),</span>
<span id="cb156-20"><a href="defining-stock-interations.html#cb156-20"></a>                                  <span class="dt">laststep=</span><span class="dv">4</span>,</span>
<span id="cb156-21"><a href="defining-stock-interations.html#cb156-21"></a>                                  <span class="dt">notimesteps=</span><span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>)))) <span class="op">%&gt;%</span><span class="st"> </span><span class="co">## number of time steps and step length in months</span></span>
<span id="cb156-22"><a href="defining-stock-interations.html#cb156-22"></a><span class="st">  </span><span class="kw">write.gadget.file</span>(gd)</span>
<span id="cb156-23"><a href="defining-stock-interations.html#cb156-23"></a></span>
<span id="cb156-24"><a href="defining-stock-interations.html#cb156-24"></a>stock_template &lt;-<span class="st"> </span></span>
<span id="cb156-25"><a href="defining-stock-interations.html#cb156-25"></a><span class="st">  </span><span class="kw">gadgetstock</span>(<span class="st">&#39;stock_1&#39;</span>,gd,<span class="dt">missingOkay =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb156-26"><a href="defining-stock-interations.html#cb156-26"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;stock&#39;</span>,</span>
<span id="cb156-27"><a href="defining-stock-interations.html#cb156-27"></a>                <span class="dt">livesonareas =</span> <span class="dv">1</span>,</span>
<span id="cb156-28"><a href="defining-stock-interations.html#cb156-28"></a>                <span class="dt">maxage =</span> <span class="dv">1</span>,</span>
<span id="cb156-29"><a href="defining-stock-interations.html#cb156-29"></a>                <span class="dt">minage =</span> <span class="dv">1</span>,</span>
<span id="cb156-30"><a href="defining-stock-interations.html#cb156-30"></a>                <span class="dt">minlength =</span> <span class="dv">0</span>,</span>
<span id="cb156-31"><a href="defining-stock-interations.html#cb156-31"></a>                <span class="dt">maxlength =</span> <span class="dv">2</span>,</span>
<span id="cb156-32"><a href="defining-stock-interations.html#cb156-32"></a>                <span class="dt">dl =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb156-33"><a href="defining-stock-interations.html#cb156-33"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;doesgrow&#39;</span>,<span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb156-34"><a href="defining-stock-interations.html#cb156-34"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;naturalmortality&#39;</span>, <span class="fl">0.2</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb156-35"><a href="defining-stock-interations.html#cb156-35"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;refweight&#39;</span>,<span class="dt">data=</span><span class="kw">tibble</span>(<span class="dt">length=</span><span class="dv">0</span><span class="op">:</span><span class="dv">2</span>,<span class="dt">mean=</span><span class="dv">0</span><span class="op">:</span><span class="dv">2</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb156-36"><a href="defining-stock-interations.html#cb156-36"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;initialconditions&#39;</span>,</span>
<span id="cb156-37"><a href="defining-stock-interations.html#cb156-37"></a>                <span class="dt">normalparam =</span> <span class="kw">tibble</span>(<span class="dt">age =</span> <span class="dv">1</span>,</span>
<span id="cb156-38"><a href="defining-stock-interations.html#cb156-38"></a>                                     <span class="dt">area =</span> <span class="dv">1</span>,</span>
<span id="cb156-39"><a href="defining-stock-interations.html#cb156-39"></a>                                     <span class="dt">age.factor =</span> <span class="dv">0</span>,   </span>
<span id="cb156-40"><a href="defining-stock-interations.html#cb156-40"></a>                                     <span class="dt">area.factor =</span><span class="dv">1</span>,</span>
<span id="cb156-41"><a href="defining-stock-interations.html#cb156-41"></a>                                     <span class="dt">mean =</span> <span class="dv">1</span>,</span>
<span id="cb156-42"><a href="defining-stock-interations.html#cb156-42"></a>                                     <span class="dt">stddev =</span> <span class="fl">.1</span>,</span>
<span id="cb156-43"><a href="defining-stock-interations.html#cb156-43"></a>                                     <span class="dt">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb156-44"><a href="defining-stock-interations.html#cb156-44"></a>                                     <span class="dt">beta =</span> <span class="dv">1</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb156-45"><a href="defining-stock-interations.html#cb156-45"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;doesrenew&#39;</span>,</span>
<span id="cb156-46"><a href="defining-stock-interations.html#cb156-46"></a>                <span class="dt">normalparam =</span> schedule <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb156-47"><a href="defining-stock-interations.html#cb156-47"></a><span class="st">                  </span><span class="kw">filter</span>(step <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb156-48"><a href="defining-stock-interations.html#cb156-48"></a><span class="st">                  </span><span class="kw">mutate</span>(<span class="dt">area =</span> <span class="dv">1</span>, <span class="co">## where does the rec. take place</span></span>
<span id="cb156-49"><a href="defining-stock-interations.html#cb156-49"></a>                         <span class="dt">age =</span> <span class="dv">1</span>, <span class="co">## age of recruits</span></span>
<span id="cb156-50"><a href="defining-stock-interations.html#cb156-50"></a>                         <span class="dt">number =</span> <span class="dv">1</span>, <span class="co">## num. of recruits (x10 000)</span></span>
<span id="cb156-51"><a href="defining-stock-interations.html#cb156-51"></a>                         <span class="dt">mean =</span> <span class="dv">1</span>, <span class="co">## mean length</span></span>
<span id="cb156-52"><a href="defining-stock-interations.html#cb156-52"></a>                         <span class="dt">stddev =</span> <span class="fl">.1</span>, <span class="co">## std in length</span></span>
<span id="cb156-53"><a href="defining-stock-interations.html#cb156-53"></a>                         <span class="dt">alpha =</span> <span class="dv">1</span>, <span class="co">## a in w = aL^b</span></span>
<span id="cb156-54"><a href="defining-stock-interations.html#cb156-54"></a>                         <span class="dt">beta =</span> <span class="dv">1</span>))</span></code></pre></div>
<p>We will use the stock template to define multiple stocks to illustrate the various possible interactions the user is able to define in a Gadget model.</p>
<div id="fish-recruits-into-a-stock" class="section level2">
<h2><span class="header-section-number">5.1</span> Fish recruits into a stock</h2>
<p>We have already seen how to implment the most straitforward version of recruitment into a stock, that is the renewal process. To recap, the renewal process adds fish into a stock based on a predefined schedule on the number and age of fish at a given time step. The most obvious use of this feature is to define a non-parametric recruitment to a stock a the minimum age of the stock. However one can use it also to add migrations from a related to stock, where the dynamics of the related stock is not modelled. An example of this would be the sporadic migrations of cod from Greenlandic waters into Icelandic waters.</p>
<p>Movement between stocks can however be defined to more elaborate. We have already seen how maturation can be modelled as a two step approach, that is a combination of Maturation and Movement. Movement is the simplest approach as it simply takes the oldest fish of one stock and pushes it into a another stock, provided that this other stocks age range includes the maximum age of the first stock.</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="defining-stock-interations.html#cb157-1"></a>young_stock &lt;-<span class="st"> </span></span>
<span id="cb157-2"><a href="defining-stock-interations.html#cb157-2"></a><span class="st">  </span>stock_template <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb157-3"><a href="defining-stock-interations.html#cb157-3"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;stock&#39;</span>,</span>
<span id="cb157-4"><a href="defining-stock-interations.html#cb157-4"></a>                <span class="dt">stockname =</span> <span class="st">&#39;young_stock&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb157-5"><a href="defining-stock-interations.html#cb157-5"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;doesmove&#39;</span>,</span>
<span id="cb157-6"><a href="defining-stock-interations.html#cb157-6"></a>                <span class="co">## be careful how you spell this</span></span>
<span id="cb157-7"><a href="defining-stock-interations.html#cb157-7"></a>                <span class="dt">transitionstocksandratios =</span> <span class="kw">list</span>(<span class="dt">stock=</span><span class="st">&#39;old_stock&#39;</span>,<span class="dt">ratio =</span> <span class="dv">1</span>),</span>
<span id="cb157-8"><a href="defining-stock-interations.html#cb157-8"></a>                <span class="dt">transitionstep =</span> <span class="dv">4</span>)</span>
<span id="cb157-9"><a href="defining-stock-interations.html#cb157-9"></a></span>
<span id="cb157-10"><a href="defining-stock-interations.html#cb157-10"></a>old_stock &lt;-<span class="st"> </span></span>
<span id="cb157-11"><a href="defining-stock-interations.html#cb157-11"></a><span class="st">  </span>stock_template <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb157-12"><a href="defining-stock-interations.html#cb157-12"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;stock&#39;</span>,</span>
<span id="cb157-13"><a href="defining-stock-interations.html#cb157-13"></a>                <span class="dt">stockname =</span> <span class="st">&#39;old_stock&#39;</span>,</span>
<span id="cb157-14"><a href="defining-stock-interations.html#cb157-14"></a>                <span class="dt">minage =</span> <span class="dv">2</span>,</span>
<span id="cb157-15"><a href="defining-stock-interations.html#cb157-15"></a>                <span class="dt">maxage =</span> <span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb157-16"><a href="defining-stock-interations.html#cb157-16"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;doesrenew&#39;</span>,<span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb157-17"><a href="defining-stock-interations.html#cb157-17"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;naturalmortality&#39;</span>, <span class="fl">0.2</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb157-18"><a href="defining-stock-interations.html#cb157-18"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;initialconditions&#39;</span>,</span>
<span id="cb157-19"><a href="defining-stock-interations.html#cb157-19"></a>                <span class="dt">normalparam =</span> <span class="kw">tibble</span>(<span class="dt">age =</span> <span class="dv">2</span>,</span>
<span id="cb157-20"><a href="defining-stock-interations.html#cb157-20"></a>                                     <span class="dt">area =</span> <span class="dv">1</span>,</span>
<span id="cb157-21"><a href="defining-stock-interations.html#cb157-21"></a>                                     <span class="dt">age.factor =</span> <span class="dv">0</span>,   </span>
<span id="cb157-22"><a href="defining-stock-interations.html#cb157-22"></a>                                     <span class="dt">area.factor =</span><span class="dv">1</span>,</span>
<span id="cb157-23"><a href="defining-stock-interations.html#cb157-23"></a>                                     <span class="dt">mean =</span> <span class="dv">1</span>,</span>
<span id="cb157-24"><a href="defining-stock-interations.html#cb157-24"></a>                                     <span class="dt">stddev =</span> <span class="fl">.1</span>,</span>
<span id="cb157-25"><a href="defining-stock-interations.html#cb157-25"></a>                                     <span class="dt">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb157-26"><a href="defining-stock-interations.html#cb157-26"></a>                                     <span class="dt">beta =</span> <span class="dv">1</span>))</span>
<span id="cb157-27"><a href="defining-stock-interations.html#cb157-27"></a></span>
<span id="cb157-28"><a href="defining-stock-interations.html#cb157-28"></a></span>
<span id="cb157-29"><a href="defining-stock-interations.html#cb157-29"></a>young_stock <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb157-30"><a href="defining-stock-interations.html#cb157-30"></a><span class="st">  </span><span class="kw">write.gadget.file</span>(gd)</span>
<span id="cb157-31"><a href="defining-stock-interations.html#cb157-31"></a></span>
<span id="cb157-32"><a href="defining-stock-interations.html#cb157-32"></a>old_stock <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb157-33"><a href="defining-stock-interations.html#cb157-33"></a><span class="st">  </span><span class="kw">write.gadget.file</span>(gd)</span>
<span id="cb157-34"><a href="defining-stock-interations.html#cb157-34"></a></span>
<span id="cb157-35"><a href="defining-stock-interations.html#cb157-35"></a>fit &lt;-<span class="st"> </span><span class="kw">gadget.fit</span>(<span class="dt">wgts =</span> <span class="ot">NULL</span>,<span class="dt">gd=</span>gd,<span class="dt">steps =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Reading input data&quot;
## [1] &quot;Running Gadget&quot;
## [1] &quot;Reading output files&quot;
## [1] &quot;Gathering results&quot;
## [1] &quot;Merging input and output&quot;</code></pre>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="defining-stock-interations.html#cb159-1"></a><span class="co">## better color scheme</span></span>
<span id="cb159-2"><a href="defining-stock-interations.html#cb159-2"></a></span>
<span id="cb159-3"><a href="defining-stock-interations.html#cb159-3"></a>scale_fill_crayola &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">n =</span> <span class="dv">100</span>, ...) {</span>
<span id="cb159-4"><a href="defining-stock-interations.html#cb159-4"></a>  </span>
<span id="cb159-5"><a href="defining-stock-interations.html#cb159-5"></a>  <span class="co"># taken from RColorBrewer::brewer.pal(12, &quot;Paired&quot;)</span></span>
<span id="cb159-6"><a href="defining-stock-interations.html#cb159-6"></a>  pal &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;#A6CEE3&quot;</span>, <span class="st">&quot;#1F78B4&quot;</span>, <span class="st">&quot;#B2DF8A&quot;</span>, <span class="st">&quot;#33A02C&quot;</span>,</span>
<span id="cb159-7"><a href="defining-stock-interations.html#cb159-7"></a>           <span class="st">&quot;#FB9A99&quot;</span>, <span class="st">&quot;#E31A1C&quot;</span>, <span class="st">&quot;#FDBF6F&quot;</span>, <span class="st">&quot;#FF7F00&quot;</span>,</span>
<span id="cb159-8"><a href="defining-stock-interations.html#cb159-8"></a>           <span class="st">&quot;#CAB2D6&quot;</span>, <span class="st">&quot;#6A3D9A&quot;</span>, <span class="st">&quot;#FFFF99&quot;</span>, <span class="st">&quot;#B15928&quot;</span>)</span>
<span id="cb159-9"><a href="defining-stock-interations.html#cb159-9"></a>  pal &lt;-<span class="st"> </span><span class="kw">rep</span>(pal, n)</span>
<span id="cb159-10"><a href="defining-stock-interations.html#cb159-10"></a>  ggplot2<span class="op">::</span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> pal, ...)</span>
<span id="cb159-11"><a href="defining-stock-interations.html#cb159-11"></a>  </span>
<span id="cb159-12"><a href="defining-stock-interations.html#cb159-12"></a>}</span>
<span id="cb159-13"><a href="defining-stock-interations.html#cb159-13"></a></span>
<span id="cb159-14"><a href="defining-stock-interations.html#cb159-14"></a><span class="kw">plot</span>(fit,<span class="dt">data=</span><span class="st">&#39;res.by.year&#39;</span>,<span class="dt">type=</span><span class="st">&#39;num.total&#39;</span>)</span>
<span id="cb159-15"><a href="defining-stock-interations.html#cb159-15"></a><span class="kw">plot</span>(fit,<span class="dt">data=</span><span class="st">&#39;stock.std&#39;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_crayola</span>()</span></code></pre></div>
<p><img src="stock_interactions_files/figure-html/unnamed-chunk-2-1.png" width="50%" /><img src="stock_interactions_files/figure-html/unnamed-chunk-2-2.png" width="50%" /></p>
<p>And this process can of course continue further. Two processes allow the user to define movement based on size or age. These are the maturation process and the straying process. These behave in a similar manner but there are key differences, in particular how you can define the movement. In the ling example the maturity process was a continuous process where the probability of a maturing at a certain length or age was determing using the following equation:
<span class="math display">\[ 
p_{la} = \frac{1}{1+e^{-\alpha(l - l_{50}) - \beta(a - a_{50})}}
\]</span>
For a stock to mature you need to set <code>doesmature</code>,<code>maturityfunction</code> and <code>maturityfile</code>. The <code>maturityfile</code> defines the maturation function parameters and to which stock(s) the immmature stock matures into. Gadget has three additional functions you can use to define movement from an immmature to a mature stock:</p>
<ul>
<li><code>constant</code> which is essentially the same as the <code>continous</code> function apart from the definition of the <code>maturitysteps</code>, i.e. when the maturation takes place.</li>
<li><code>constantweight</code> same as above but the probability of maturation is now also a function of the body condition:
<span class="math display">\[ 
p_{la} = \frac{1}{1+e^{-\alpha(l - l_{50}) - \beta(a - a_{50}) - \gamma(k-k_{50})}}
\]</span>
where the body condition, <span class="math inline">\(k\)</span>, is determined by dividing the reference weight to the modelled weight</li>
<li><code>fixedlength</code> which is a knife-edge selection in terms of length. You need to define the <code>maturitysteps</code> and <code>maturitylengths</code>.</li>
</ul>
<p>The straying process is slightly different as it is thought of as the means to provide mechanisms to define processes such as dispersal between breeding components and different growth rates within the same stock due to different enviromental factors. To setup the straying process you will need to define when the straying occurs, where it occurs (i.e. what area) and what fish strays. The fish that strays is defined by specific length selection listed below:</p>
<ul>
<li><code>constant</code>: <span class="math inline">\(S_l = \alpha\)</span></li>
<li><code>straightline</code>: <span class="math inline">\(S_l = \alpha l + \beta\)</span></li>
<li><code>exponential</code>: <span class="math inline">\(S_l = \frac{1}{1+e^{\alpha(l-l_{50})}}\)</span></li>
</ul>
<p>For our simple model we will define 20<span class="math inline">\(\%\)</span> straying between two stock components, from <code>stock_a</code> to <code>stock_b</code>:</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="defining-stock-interations.html#cb160-1"></a>stock_a &lt;-<span class="st"> </span></span>
<span id="cb160-2"><a href="defining-stock-interations.html#cb160-2"></a><span class="st">  </span>stock_template <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb160-3"><a href="defining-stock-interations.html#cb160-3"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;stock&#39;</span>,</span>
<span id="cb160-4"><a href="defining-stock-interations.html#cb160-4"></a>                <span class="dt">stockname =</span> <span class="st">&#39;stock_a&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb160-5"><a href="defining-stock-interations.html#cb160-5"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;doesstray&#39;</span>,</span>
<span id="cb160-6"><a href="defining-stock-interations.html#cb160-6"></a>                <span class="dt">straysteps =</span> <span class="dv">3</span>,</span>
<span id="cb160-7"><a href="defining-stock-interations.html#cb160-7"></a>                <span class="dt">strayareas =</span> <span class="dv">1</span>,</span>
<span id="cb160-8"><a href="defining-stock-interations.html#cb160-8"></a>                <span class="dt">straystocksandratios =</span> <span class="kw">list</span>(<span class="dt">stock=</span><span class="st">&#39;stock_b&#39;</span>,<span class="dt">ratio =</span> <span class="dv">1</span>),</span>
<span id="cb160-9"><a href="defining-stock-interations.html#cb160-9"></a>                <span class="dt">proportionfunction =</span> <span class="kw">list</span>(<span class="dt">sel_function=</span><span class="st">&#39;constant&#39;</span>,<span class="dt">alpha =</span> <span class="fl">0.2</span>))</span>
<span id="cb160-10"><a href="defining-stock-interations.html#cb160-10"></a></span>
<span id="cb160-11"><a href="defining-stock-interations.html#cb160-11"></a>stock_b &lt;-<span class="st"> </span></span>
<span id="cb160-12"><a href="defining-stock-interations.html#cb160-12"></a><span class="st">  </span>stock_template <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb160-13"><a href="defining-stock-interations.html#cb160-13"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;stock&#39;</span>,</span>
<span id="cb160-14"><a href="defining-stock-interations.html#cb160-14"></a>                <span class="dt">stockname =</span> <span class="st">&#39;stock_b&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb160-15"><a href="defining-stock-interations.html#cb160-15"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;doesrenew&#39;</span>,<span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb160-16"><a href="defining-stock-interations.html#cb160-16"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;initialconditions&#39;</span>,</span>
<span id="cb160-17"><a href="defining-stock-interations.html#cb160-17"></a>                <span class="dt">normalparam =</span> <span class="kw">tibble</span>(<span class="dt">age =</span> <span class="dv">1</span>,</span>
<span id="cb160-18"><a href="defining-stock-interations.html#cb160-18"></a>                                     <span class="dt">area =</span> <span class="dv">1</span>,</span>
<span id="cb160-19"><a href="defining-stock-interations.html#cb160-19"></a>                                     <span class="dt">age.factor =</span> <span class="fl">.1</span>,   </span>
<span id="cb160-20"><a href="defining-stock-interations.html#cb160-20"></a>                                     <span class="dt">area.factor =</span><span class="dv">1</span>,</span>
<span id="cb160-21"><a href="defining-stock-interations.html#cb160-21"></a>                                     <span class="dt">mean =</span> <span class="dv">1</span>,</span>
<span id="cb160-22"><a href="defining-stock-interations.html#cb160-22"></a>                                     <span class="dt">stddev =</span> <span class="fl">.1</span>,</span>
<span id="cb160-23"><a href="defining-stock-interations.html#cb160-23"></a>                                     <span class="dt">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb160-24"><a href="defining-stock-interations.html#cb160-24"></a>                                     <span class="dt">beta =</span> <span class="dv">1</span>))</span>
<span id="cb160-25"><a href="defining-stock-interations.html#cb160-25"></a></span>
<span id="cb160-26"><a href="defining-stock-interations.html#cb160-26"></a>stock_a <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb160-27"><a href="defining-stock-interations.html#cb160-27"></a><span class="st">  </span><span class="kw">write.gadget.file</span>(gd)</span>
<span id="cb160-28"><a href="defining-stock-interations.html#cb160-28"></a></span>
<span id="cb160-29"><a href="defining-stock-interations.html#cb160-29"></a>stock_b <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb160-30"><a href="defining-stock-interations.html#cb160-30"></a><span class="st">  </span><span class="kw">write.gadget.file</span>(gd)</span>
<span id="cb160-31"><a href="defining-stock-interations.html#cb160-31"></a></span>
<span id="cb160-32"><a href="defining-stock-interations.html#cb160-32"></a>fit &lt;-<span class="st"> </span><span class="kw">gadget.fit</span>(<span class="dt">wgts =</span> <span class="ot">NULL</span>,<span class="dt">gd=</span>gd,<span class="dt">steps =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Reading input data&quot;
## [1] &quot;Running Gadget&quot;
## [1] &quot;Reading output files&quot;
## [1] &quot;Gathering results&quot;
## [1] &quot;Merging input and output&quot;</code></pre>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="defining-stock-interations.html#cb162-1"></a>fit<span class="op">$</span>res.by.year <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb162-2"><a href="defining-stock-interations.html#cb162-2"></a><span class="st">  </span><span class="kw">filter</span>(stock <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;stock_a&#39;</span>,<span class="st">&#39;stock_b&#39;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb162-3"><a href="defining-stock-interations.html#cb162-3"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year,total.number,<span class="dt">lty =</span> stock)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>()</span></code></pre></div>
<p><img src="stock_interactions_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<div id="excercise-1" class="section level3">
<h3><span class="header-section-number">5.1.1</span> Excercise</h3>
<ul>
<li>Depletion of stock components is often a concern. Using the straying mechanism set up a three stock model where individual are slowly dispersed between all three components. Define a fishing fleet that targets only one of the stocks and investigate how different dispersion levels affect the depletion of all stocks.</li>
<li>Gadget allow you to set up a catch at age model. Use the movement mechanism to define a model with a maximum age of 10, where each age is a separate stock. How would you define the fleets for this model so you could use commercial catch at age directly into the model?</li>
</ul>
</div>
</div>
<div id="spawning" class="section level2">
<h2><span class="header-section-number">5.2</span> Spawning</h2>
<p>The spawning process allows the user to define recruits into as stock as function of the size of another stock. A number of relationships can be defined:</p>
<ul>
<li><code>fecundity</code> <span class="math display">\[R = p_0 \sum_a\sum_l l^{p_1}a^{p_2}N_{al}^{p_3}W_{al}^{p_4}\]</span></li>
<li><code>simplessb</code> <span class="math display">\[R = \mu S\]</span> where <span class="math inline">\(S = \sum_a\sum_l N_{al}W_{al}\)</span></li>
<li><code>ricker</code> <span class="math display">\[R = \mu Se^{-\lambda S}\]</span></li>
<li><code>bevertonholt</code> <span class="math display">\[R = \frac{\mu S}{\lambda + S}\]</span></li>
<li><code>hockeystick</code> <span class="math display">\[R = R =  \begin{cases}
R_0,&amp;\text{If } B_{lim} \leq S \\
\frac{R_0S}{B_{lim}} &amp; \text{If } 0 \leq S \leq B_{lim}
\end{cases}  \]</span></li>
</ul>
<p>In addition the user can define using the same length based selection function as for straying which of the stock “spawns” and what happens to them, i.e. what mortalities are applied to the stock and changes in condition. The spawning stock is updated according to the following equations:
<span class="math display">\[ N_l = N_l(1 + P_l(e^{-m_l} - 1)) \]</span>
<span class="math display">\[ W_l = W_l\frac{1 + P_l((2-w_l)e^{-m_l} -1)}{(1 + P_l(2e^{-m_l} -1))} \]</span>
where <span class="math inline">\(P_l\)</span> is proportion that will spawn, <span class="math inline">\(m_l\)</span> is the mortality for and <span class="math inline">\(w_l\)</span> is the weight loss for length group <span class="math inline">\(l\)</span>. To illustrate how to set up spawning for a particular stock we will use the simple stock templates from above and use those to define parent and offspring stocks:</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="defining-stock-interations.html#cb163-1"></a>parent &lt;-<span class="st"> </span></span>
<span id="cb163-2"><a href="defining-stock-interations.html#cb163-2"></a><span class="st">  </span>stock_template <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb163-3"><a href="defining-stock-interations.html#cb163-3"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;stock&#39;</span>,</span>
<span id="cb163-4"><a href="defining-stock-interations.html#cb163-4"></a>                <span class="dt">stockname =</span> <span class="st">&#39;parent&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb163-5"><a href="defining-stock-interations.html#cb163-5"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;doesrenew&#39;</span>,<span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb163-6"><a href="defining-stock-interations.html#cb163-6"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;doesspawn&#39;</span>,</span>
<span id="cb163-7"><a href="defining-stock-interations.html#cb163-7"></a>                <span class="dt">spawnsteps =</span> <span class="dv">1</span>, </span>
<span id="cb163-8"><a href="defining-stock-interations.html#cb163-8"></a>                <span class="dt">spawnareas =</span> <span class="dv">1</span>,</span>
<span id="cb163-9"><a href="defining-stock-interations.html#cb163-9"></a>                <span class="dt">firstspawnyear =</span> <span class="dv">1</span>,</span>
<span id="cb163-10"><a href="defining-stock-interations.html#cb163-10"></a>                <span class="dt">lastspawnyear =</span> <span class="dv">30</span>,</span>
<span id="cb163-11"><a href="defining-stock-interations.html#cb163-11"></a>                <span class="dt">spawnstocksandratios =</span> <span class="kw">list</span>(<span class="dt">stock=</span><span class="st">&#39;offspring&#39;</span>, <span class="dt">ratio =</span> <span class="dv">1</span>),</span>
<span id="cb163-12"><a href="defining-stock-interations.html#cb163-12"></a>                <span class="dt">proportionfunction =</span> <span class="kw">list</span>(<span class="dt">sel_func =</span> <span class="st">&#39;constant&#39;</span>, <span class="dt">alpha =</span> <span class="dv">1</span>),</span>
<span id="cb163-13"><a href="defining-stock-interations.html#cb163-13"></a>                <span class="dt">mortalityfunction =</span> <span class="kw">list</span>(<span class="dt">sel_func =</span> <span class="st">&#39;constant&#39;</span>, <span class="dt">alpha =</span> <span class="dv">0</span>),</span>
<span id="cb163-14"><a href="defining-stock-interations.html#cb163-14"></a>                <span class="dt">weightlossfunction =</span> <span class="kw">list</span>(<span class="dt">sel_func =</span> <span class="st">&#39;constant&#39;</span>, <span class="dt">alpha =</span> <span class="dv">0</span>),</span>
<span id="cb163-15"><a href="defining-stock-interations.html#cb163-15"></a>                <span class="dt">recruitment =</span> <span class="kw">list</span>(<span class="dt">spawn_function =</span> <span class="st">&#39;ricker&#39;</span>, <span class="dt">mu =</span> <span class="dv">2</span>, <span class="dt">lambda =</span> <span class="fl">1e-4</span>), </span>
<span id="cb163-16"><a href="defining-stock-interations.html#cb163-16"></a>                <span class="dt">stockparameters =</span> <span class="kw">list</span>(<span class="dt">mean =</span> <span class="dv">1</span>,</span>
<span id="cb163-17"><a href="defining-stock-interations.html#cb163-17"></a>                                       <span class="dt">stddev =</span> <span class="fl">.1</span>,</span>
<span id="cb163-18"><a href="defining-stock-interations.html#cb163-18"></a>                                       <span class="dt">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb163-19"><a href="defining-stock-interations.html#cb163-19"></a>                                       <span class="dt">beta =</span> <span class="dv">1</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb163-20"><a href="defining-stock-interations.html#cb163-20"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;initialconditions&#39;</span>,</span>
<span id="cb163-21"><a href="defining-stock-interations.html#cb163-21"></a>                <span class="dt">normalparam =</span> <span class="kw">tibble</span>(<span class="dt">age =</span> <span class="dv">1</span>,</span>
<span id="cb163-22"><a href="defining-stock-interations.html#cb163-22"></a>                                     <span class="dt">area =</span> <span class="dv">1</span>,</span>
<span id="cb163-23"><a href="defining-stock-interations.html#cb163-23"></a>                                     <span class="dt">age.factor =</span> <span class="dv">1</span>,   </span>
<span id="cb163-24"><a href="defining-stock-interations.html#cb163-24"></a>                                     <span class="dt">area.factor =</span> <span class="fl">.1</span>,</span>
<span id="cb163-25"><a href="defining-stock-interations.html#cb163-25"></a>                                     <span class="dt">mean =</span> <span class="dv">1</span>,</span>
<span id="cb163-26"><a href="defining-stock-interations.html#cb163-26"></a>                                     <span class="dt">stddev =</span> <span class="fl">.1</span>,</span>
<span id="cb163-27"><a href="defining-stock-interations.html#cb163-27"></a>                                     <span class="dt">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb163-28"><a href="defining-stock-interations.html#cb163-28"></a>                                     <span class="dt">beta =</span> <span class="dv">1</span>))</span>
<span id="cb163-29"><a href="defining-stock-interations.html#cb163-29"></a></span>
<span id="cb163-30"><a href="defining-stock-interations.html#cb163-30"></a></span>
<span id="cb163-31"><a href="defining-stock-interations.html#cb163-31"></a>offspring &lt;-<span class="st"> </span></span>
<span id="cb163-32"><a href="defining-stock-interations.html#cb163-32"></a><span class="st">  </span>stock_template <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb163-33"><a href="defining-stock-interations.html#cb163-33"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;stock&#39;</span>,</span>
<span id="cb163-34"><a href="defining-stock-interations.html#cb163-34"></a>                <span class="dt">stockname =</span> <span class="st">&#39;offspring&#39;</span>,</span>
<span id="cb163-35"><a href="defining-stock-interations.html#cb163-35"></a>                <span class="dt">minage =</span> <span class="dv">0</span>,</span>
<span id="cb163-36"><a href="defining-stock-interations.html#cb163-36"></a>                <span class="dt">maxage =</span> <span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb163-37"><a href="defining-stock-interations.html#cb163-37"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;initialconditions&#39;</span>,</span>
<span id="cb163-38"><a href="defining-stock-interations.html#cb163-38"></a>                <span class="dt">normalparam =</span> <span class="kw">tibble</span>(<span class="dt">age =</span> <span class="dv">0</span>,</span>
<span id="cb163-39"><a href="defining-stock-interations.html#cb163-39"></a>                                     <span class="dt">area =</span> <span class="dv">1</span>,</span>
<span id="cb163-40"><a href="defining-stock-interations.html#cb163-40"></a>                                     <span class="dt">age.factor =</span> <span class="dv">0</span>,   </span>
<span id="cb163-41"><a href="defining-stock-interations.html#cb163-41"></a>                                     <span class="dt">area.factor =</span> <span class="dv">0</span>,</span>
<span id="cb163-42"><a href="defining-stock-interations.html#cb163-42"></a>                                     <span class="dt">mean =</span> <span class="dv">1</span>,</span>
<span id="cb163-43"><a href="defining-stock-interations.html#cb163-43"></a>                                     <span class="dt">stddev =</span> <span class="fl">.1</span>,</span>
<span id="cb163-44"><a href="defining-stock-interations.html#cb163-44"></a>                                     <span class="dt">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb163-45"><a href="defining-stock-interations.html#cb163-45"></a>                                     <span class="dt">beta =</span> <span class="dv">1</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb163-46"><a href="defining-stock-interations.html#cb163-46"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;doesrenew&#39;</span>,<span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb163-47"><a href="defining-stock-interations.html#cb163-47"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;doesmove&#39;</span>,</span>
<span id="cb163-48"><a href="defining-stock-interations.html#cb163-48"></a>                <span class="dt">transitionsteps =</span> <span class="dv">4</span>,</span>
<span id="cb163-49"><a href="defining-stock-interations.html#cb163-49"></a>                <span class="dt">transitionstocksandratios =</span> <span class="kw">list</span>(<span class="dt">stock=</span><span class="st">&#39;parent&#39;</span>,<span class="dt">ratio=</span><span class="dv">1</span>))</span>
<span id="cb163-50"><a href="defining-stock-interations.html#cb163-50"></a></span>
<span id="cb163-51"><a href="defining-stock-interations.html#cb163-51"></a></span>
<span id="cb163-52"><a href="defining-stock-interations.html#cb163-52"></a>parent <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb163-53"><a href="defining-stock-interations.html#cb163-53"></a><span class="st">  </span><span class="kw">write.gadget.file</span>(gd)</span>
<span id="cb163-54"><a href="defining-stock-interations.html#cb163-54"></a>offspring <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb163-55"><a href="defining-stock-interations.html#cb163-55"></a><span class="st">  </span><span class="kw">write.gadget.file</span>(gd)</span>
<span id="cb163-56"><a href="defining-stock-interations.html#cb163-56"></a></span>
<span id="cb163-57"><a href="defining-stock-interations.html#cb163-57"></a>fit &lt;-<span class="st"> </span><span class="kw">gadget.fit</span>(<span class="dt">wgts =</span> <span class="ot">NULL</span>, <span class="dt">gd =</span> gd, <span class="dt">steps =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Reading input data&quot;
## [1] &quot;Running Gadget&quot;
## [1] &quot;Reading output files&quot;
## [1] &quot;Gathering results&quot;
## [1] &quot;Merging input and output&quot;</code></pre>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="defining-stock-interations.html#cb165-1"></a>fit<span class="op">$</span>res.by.year <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb165-2"><a href="defining-stock-interations.html#cb165-2"></a><span class="st">  </span><span class="kw">filter</span>(stock <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;parent&#39;</span>,<span class="st">&#39;offspring&#39;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb165-3"><a href="defining-stock-interations.html#cb165-3"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year,total.number,<span class="dt">lty =</span> stock)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb165-4"><a href="defining-stock-interations.html#cb165-4"></a><span class="st">  </span><span class="kw">expand_limits</span>(<span class="dt">y=</span><span class="dv">0</span>)</span></code></pre></div>
<p><img src="stock_interactions_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>The code above defines a Ricker recruitment function between the parent and offspring stocks. As evident from the graph above the relationship between the two stocks is a fairly deterministic. This type of relationship, however, is hardly ever observed without error (both in process and observation). To include process variation into the model Gadget has another trick up its sleave, Time variables.</p>
<div id="time-variables" class="section level3">
<h3><span class="header-section-number">5.2.1</span> Time variables</h3>
<p>Time variables allow Gadget to change the value of parameters with time. They are an extension to the Gadget formulae functionality and can be use (almost) where ever you can use Gadget formulae. To define a time variable you will need to define a data frame with the start time for a particular value, which will be valid until the next change. Example uses might be shifts fleet selection due to changes in regulation and temperature effects in growth. In the case of the simple stock recruitment relationship above we may want change the value for <span class="math inline">\(\mu\)</span> with time. To introduce time variables into this model you will need to create a special file:</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="defining-stock-interations.html#cb166-1"></a>mu_time &lt;-<span class="st"> </span></span>
<span id="cb166-2"><a href="defining-stock-interations.html#cb166-2"></a><span class="st">  </span><span class="kw">gadgetfile</span>(<span class="st">&#39;Modelfiles/mu_time&#39;</span>,</span>
<span id="cb166-3"><a href="defining-stock-interations.html#cb166-3"></a>             <span class="dt">file_type =</span> <span class="st">&#39;timevariable&#39;</span>,</span>
<span id="cb166-4"><a href="defining-stock-interations.html#cb166-4"></a>             <span class="dt">components =</span> <span class="kw">list</span>(<span class="kw">list</span>(<span class="st">&#39;mu_time&#39;</span>,</span>
<span id="cb166-5"><a href="defining-stock-interations.html#cb166-5"></a>                                    <span class="dt">data =</span> schedule <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb166-6"><a href="defining-stock-interations.html#cb166-6"></a><span class="st">                                      </span><span class="kw">filter</span>(step <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb166-7"><a href="defining-stock-interations.html#cb166-7"></a><span class="st">                                      </span><span class="kw">mutate</span>(<span class="dt">value =</span> <span class="dv">2</span><span class="op">*</span><span class="kw">rlnorm</span>(<span class="dt">n =</span> <span class="dv">30</span>, <span class="dt">sdlog =</span> <span class="fl">0.2</span>)))))</span>
<span id="cb166-8"><a href="defining-stock-interations.html#cb166-8"></a></span>
<span id="cb166-9"><a href="defining-stock-interations.html#cb166-9"></a>mu_time <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb166-10"><a href="defining-stock-interations.html#cb166-10"></a><span class="st">  </span><span class="kw">write.gadget.file</span>(gd)</span>
<span id="cb166-11"><a href="defining-stock-interations.html#cb166-11"></a></span>
<span id="cb166-12"><a href="defining-stock-interations.html#cb166-12"></a>mu_time</span></code></pre></div>
<pre><code>## ; Generated by Rgadget 0.5
##  mu_time
## data
## ; year   step    value
## 1    1   2.04828522481477
## 2    1   1.93080982011214
## 3    1   2.64834407681078
## 4    1   2.11463558012716
## 5    1   2.31191411558799
## 6    1   1.54044555246455
## 7    1   1.96451713146509
## 8    1   1.46530982098884
## 9    1   1.73075077353238
## 10   1   2.5794347729634
## 11   1   2.24613417093631
## 12   1   2.45402271389924
## 13   1   1.3431789183443
## 14   1   2.63394976055913
## 15   1   2.28169439407908
## 16   1   1.78835028067647
## 17   1   2.27936162738224
## 18   1   2.13066520253464
## 19   1   2.50031020052314
## 20   1   2.41177273342478
## 21   1   1.47870761099084
## 22   1   1.6333915167802
## 23   1   2.10108224908664
## 24   1   1.87902708797292
## 25   1   1.90187192329423
## 26   1   1.40202942219348
## 27   1   2.28160166184842
## 28   1   1.62214409151318
## 29   1   2.17854422471164
## 30   1   1.9339823550804</code></pre>
<p>and then we need to replace value for <span class="math inline">\(\mu\)</span> with this file:</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="defining-stock-interations.html#cb168-1"></a>parent &lt;-<span class="st"> </span></span>
<span id="cb168-2"><a href="defining-stock-interations.html#cb168-2"></a><span class="st">  </span>parent <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb168-3"><a href="defining-stock-interations.html#cb168-3"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;doesspawn&#39;</span>,</span>
<span id="cb168-4"><a href="defining-stock-interations.html#cb168-4"></a>                <span class="dt">spawnsteps =</span> <span class="dv">1</span>, </span>
<span id="cb168-5"><a href="defining-stock-interations.html#cb168-5"></a>                <span class="dt">spawnareas =</span> <span class="dv">1</span>,</span>
<span id="cb168-6"><a href="defining-stock-interations.html#cb168-6"></a>                <span class="dt">firstspawnyear =</span> <span class="dv">1</span>,</span>
<span id="cb168-7"><a href="defining-stock-interations.html#cb168-7"></a>                <span class="dt">lastspawnyear =</span> <span class="dv">30</span>,</span>
<span id="cb168-8"><a href="defining-stock-interations.html#cb168-8"></a>                <span class="dt">spawnstocksandratios =</span> <span class="kw">list</span>(<span class="dt">stock=</span><span class="st">&#39;offspring&#39;</span>, <span class="dt">ratio =</span> <span class="dv">1</span>),</span>
<span id="cb168-9"><a href="defining-stock-interations.html#cb168-9"></a>                <span class="dt">proportionfunction =</span> <span class="kw">list</span>(<span class="dt">sel_func =</span> <span class="st">&#39;constant&#39;</span>, <span class="dt">alpha =</span> <span class="dv">1</span>),</span>
<span id="cb168-10"><a href="defining-stock-interations.html#cb168-10"></a>                <span class="dt">mortalityfunction =</span> <span class="kw">list</span>(<span class="dt">sel_func =</span> <span class="st">&#39;constant&#39;</span>, <span class="dt">alpha =</span> <span class="dv">0</span>),</span>
<span id="cb168-11"><a href="defining-stock-interations.html#cb168-11"></a>                <span class="dt">weightlossfunction =</span> <span class="kw">list</span>(<span class="dt">sel_func =</span> <span class="st">&#39;constant&#39;</span>, <span class="dt">alpha =</span> <span class="dv">0</span>),</span>
<span id="cb168-12"><a href="defining-stock-interations.html#cb168-12"></a>                <span class="dt">recruitment =</span> <span class="kw">list</span>(<span class="dt">spawn_function =</span> <span class="st">&#39;ricker&#39;</span>, <span class="dt">mu =</span> <span class="st">&quot;Modelfiles/mu_time&quot;</span>, <span class="dt">lambda =</span> <span class="fl">1e-4</span>), </span>
<span id="cb168-13"><a href="defining-stock-interations.html#cb168-13"></a>                <span class="dt">stockparameters =</span> <span class="kw">list</span>(<span class="dt">mean =</span> <span class="dv">1</span>,</span>
<span id="cb168-14"><a href="defining-stock-interations.html#cb168-14"></a>                                       <span class="dt">stddev =</span> <span class="fl">.1</span>,</span>
<span id="cb168-15"><a href="defining-stock-interations.html#cb168-15"></a>                                       <span class="dt">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb168-16"><a href="defining-stock-interations.html#cb168-16"></a>                                       <span class="dt">beta =</span> <span class="dv">1</span>))</span>
<span id="cb168-17"><a href="defining-stock-interations.html#cb168-17"></a>parent <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb168-18"><a href="defining-stock-interations.html#cb168-18"></a><span class="st">  </span><span class="kw">write.gadget.file</span>(gd)</span>
<span id="cb168-19"><a href="defining-stock-interations.html#cb168-19"></a></span>
<span id="cb168-20"><a href="defining-stock-interations.html#cb168-20"></a>fit &lt;-<span class="st"> </span><span class="kw">gadget.fit</span>(<span class="dt">wgts =</span> <span class="ot">NULL</span>, <span class="dt">gd =</span> gd, <span class="dt">steps =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Reading input data&quot;
## [1] &quot;Running Gadget&quot;
## [1] &quot;Reading output files&quot;
## [1] &quot;Gathering results&quot;
## [1] &quot;Merging input and output&quot;</code></pre>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="defining-stock-interations.html#cb170-1"></a>fit<span class="op">$</span>res.by.year <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb170-2"><a href="defining-stock-interations.html#cb170-2"></a><span class="st">  </span><span class="kw">filter</span>(stock <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;parent&#39;</span>,<span class="st">&#39;offspring&#39;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb170-3"><a href="defining-stock-interations.html#cb170-3"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year,total.number,<span class="dt">lty =</span> stock)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb170-4"><a href="defining-stock-interations.html#cb170-4"></a><span class="st">  </span><span class="kw">expand_limits</span>(<span class="dt">y=</span><span class="dv">0</span>)</span></code></pre></div>
<p><img src="stock_interactions_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
</div>
<div id="excercise-2" class="section level3">
<h3><span class="header-section-number">5.2.2</span> Excercise</h3>
<ul>
<li>Modify the code above such that the spawning is split into two stocks, representing e.g. either the male or female part of the stock.</li>
<li>Using the simple stock template define a auto-spawning stock, i.e. a stock that spawns into it self.</li>
<li>Instead of the Ricker function try to parametrise the Beverton and Holt recruitment function for the example above.</li>
<li>In the ling example consider how you would project the recruitment into the future.</li>
</ul>
</div>
</div>
<div id="consumption" class="section level2">
<h2><span class="header-section-number">5.3</span> Consumption</h2>
<p>In Gadget there are a number of predator-prey relations that can be defined. They include the obvious case where one substock predates the other. Additionally a cannibalistic relationship can be defined if the substocks are modelled as an immature and a mature part of the same species. The predation in Gadget is implemented as follows. Each predator will conceptually be assigned <strong>availability</strong> of a certain prey in comparison with other food sources and a <strong>feeding level</strong>, i.e., fraction of available food the predator wants to consume. Combining these two terms the amount that the predator wants to consume is calculated.</p>
<p>The availability of a certain prey <span class="math inline">\(p\)</span> for a predator <span class="math inline">\(P\)</span> is determined by the prey biomass per length group (<span class="math inline">\(N_{l}W_{l}\)</span>, where <span class="math inline">\(W_l\)</span> is the weight at length <span class="math inline">\(l\)</span>) and a length based suitability function listed <a href="getting_started.html#predation">here</a>.</p>
<p>In the simple predator-prey relation between the substocks in Gadget the prey availability to a predator becomes
<span class="math display">\[\frac{F_{Ll}}{\sum_{l&#39;}F_{Ll&#39;}+OA}\]</span>
where <span class="math display">\[F_{Ll} = (S_{Pp}(L,l) N_{pl}W_{pl})^{d_p}\]</span> is the prey biomass of length <span class="math inline">\(l\)</span> that the predator could consume, <span class="math inline">\(W_{pl}\)</span> is the average weight for prey of length <span class="math inline">\(l\)</span>, <span class="math inline">\(d_p\)</span> is the preference, and <span class="math inline">\(O\)</span> is the density, per unit area, of other unspecified food sources and <span class="math inline">\(A\)</span> is the size of the area.</p>
<p>The feeding level of the predator is
<span class="math display">\[\Psi_L = M_L \frac{\sum_{l&#39;}F_{Ll&#39;}+OA}{\sum_{l&#39;}F_{Ll&#39;}+OA+HA}\]</span>
where <span class="math inline">\(M_L\)</span> is the maximum consumption of a predator of length <span class="math inline">\(L\)</span> for a particular time step length <span class="math inline">\(\Delta t\)</span>. It is determined by <span class="math display">\[M_L=m_0L^{m_4}\Delta t e^{(m_1 T - m_2 T^3)}\]</span> where <span class="math inline">\(m_0\)</span> to <span class="math inline">\(m_4\)</span> are user defined constants. <span class="math inline">\(H\)</span> is the density (biomass per area unit) of available food at which the predator can consume half maximum consumption. Note that <span class="math inline">\(H\)</span> should reflect how able the predator is to pursue its prey, which should factor in variables such as temperature and the cost of search. <span class="math inline">\(H\)</span> determines therefore how quickly the predators consumption reaches <span class="math inline">\(M_L\)</span>. <span class="math inline">\(H=0\)</span> would indicate that the predator would easily consume <span class="math inline">\(M_L\)</span> of the available biomass. A larger value for <span class="math inline">\(H\)</span> would indicate that prey is harder to find and therefore prey needs to be more abundant for the predator to reach <span class="math inline">\(M_L\)</span>.</p>
<p>Given the feeding level and the prey availability the desired consumption of all predators of length <span class="math inline">\(L\)</span> is
<span class="math display">\[
\begin{split}
C_{L,l}&amp;=N_{L}\Psi_{L}\left[\frac{F_{Ll}}{\sum_{l&#39;}F_{Ll&#39;}+OA}\right]\\
&amp;=N_{L}M_{L}\frac{F_{Ll}}{\sum_{l&#39;}F_{Ll&#39;}+OA+HA}\\
\end{split}
\]</span>
For each prey an upper limit needs to be set on the total amount consumed by all predators, including the fleets, to prevent more consumption than the available biomass. To prevent this overconsumption when fitting a Gadget model the <code>understocking</code> likelihood component is usually added to the likelihood.</p>
<p>To illustrate how one can set up a predator prey relationship in Gadget we will take the simple case of one stock, <code>predator</code>, predating another, <code>prey</code>. First we will need to set up the prey stock:</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="defining-stock-interations.html#cb171-1"></a>prey &lt;-<span class="st"> </span></span>
<span id="cb171-2"><a href="defining-stock-interations.html#cb171-2"></a><span class="st">  </span>stock_template <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb171-3"><a href="defining-stock-interations.html#cb171-3"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;stock&#39;</span>,</span>
<span id="cb171-4"><a href="defining-stock-interations.html#cb171-4"></a>                <span class="dt">stockname =</span> <span class="st">&#39;prey&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb171-5"><a href="defining-stock-interations.html#cb171-5"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;iseaten&#39;</span>,</span>
<span id="cb171-6"><a href="defining-stock-interations.html#cb171-6"></a>                <span class="co">## define how many KJ per gram</span></span>
<span id="cb171-7"><a href="defining-stock-interations.html#cb171-7"></a>                <span class="dt">energycontent =</span> <span class="dv">1</span>) </span></code></pre></div>
<p>We also have to define something called “Otherfood”. Otherfood refers to other non-dynamic food items that the predator consumes. It is usually defined in order for the stock to consume something else in the absense of the prey.</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="defining-stock-interations.html#cb172-1"></a>otherfood &lt;-<span class="st"> </span></span>
<span id="cb172-2"><a href="defining-stock-interations.html#cb172-2"></a><span class="st">  </span><span class="kw">gadgetfile</span>(<span class="st">&#39;Modelfiles/otherfood&#39;</span>,</span>
<span id="cb172-3"><a href="defining-stock-interations.html#cb172-3"></a>             <span class="dt">file_type =</span> <span class="st">&#39;otherfood&#39;</span>,</span>
<span id="cb172-4"><a href="defining-stock-interations.html#cb172-4"></a>             <span class="dt">components =</span> <span class="kw">list</span>(<span class="dt">component=</span><span class="kw">list</span>(<span class="dt">foodname =</span> <span class="st">&#39;otherfood&#39;</span>,</span>
<span id="cb172-5"><a href="defining-stock-interations.html#cb172-5"></a>                                              <span class="dt">livesonareas =</span> <span class="dv">1</span>,</span>
<span id="cb172-6"><a href="defining-stock-interations.html#cb172-6"></a>                                              <span class="dt">lengths =</span> <span class="kw">list</span>(<span class="dt">min =</span> <span class="dv">1</span>, <span class="dt">max =</span> <span class="dv">2</span>),</span>
<span id="cb172-7"><a href="defining-stock-interations.html#cb172-7"></a>                                              <span class="dt">energycontent =</span> <span class="dv">1</span>,</span>
<span id="cb172-8"><a href="defining-stock-interations.html#cb172-8"></a>                                              <span class="dt">amount =</span> <span class="kw">gadgetfile</span>(<span class="st">&#39;Data/otherfood&#39;</span>,</span>
<span id="cb172-9"><a href="defining-stock-interations.html#cb172-9"></a>                                                                  <span class="dt">component =</span> <span class="kw">list</span>(schedule <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb172-10"><a href="defining-stock-interations.html#cb172-10"></a><span class="st">                                                                    </span><span class="kw">mutate</span>(<span class="dt">area =</span> <span class="dv">1</span>, <span class="dt">food_name =</span> <span class="st">&#39;otherfood&#39;</span>,<span class="dt">amount =</span> <span class="fl">1e6</span>))))))</span></code></pre></div>
<p>The predator stock is bit more involved:</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="defining-stock-interations.html#cb173-1"></a>predator &lt;-</span>
<span id="cb173-2"><a href="defining-stock-interations.html#cb173-2"></a><span class="st">  </span>stock_template <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb173-3"><a href="defining-stock-interations.html#cb173-3"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;stock&#39;</span>,</span>
<span id="cb173-4"><a href="defining-stock-interations.html#cb173-4"></a>                <span class="dt">stockname =</span> <span class="st">&#39;predator&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb173-5"><a href="defining-stock-interations.html#cb173-5"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;doeseat&#39;</span>,</span>
<span id="cb173-6"><a href="defining-stock-interations.html#cb173-6"></a>                <span class="dt">suitability =</span> <span class="kw">list</span>(<span class="kw">paste</span>(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>,<span class="dt">prey =</span> <span class="st">&#39;prey&#39;</span>,<span class="dt">type=</span><span class="st">&#39;function&#39;</span>,<span class="dt">suit_func =</span> <span class="st">&#39;constant&#39;</span>, <span class="dt">alpha =</span> <span class="dv">1</span>,<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>, <span class="dt">sep =</span> <span class="st">&#39;</span><span class="ch">\t</span><span class="st">&#39;</span>),</span>
<span id="cb173-7"><a href="defining-stock-interations.html#cb173-7"></a>                                   <span class="kw">paste</span>(<span class="dt">prey =</span> <span class="st">&#39;otherfood&#39;</span>,<span class="dt">type=</span><span class="st">&#39;function&#39;</span>,<span class="dt">suit_func =</span> <span class="st">&#39;constant&#39;</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>, <span class="dt">sep =</span> <span class="st">&#39;</span><span class="ch">\t</span><span class="st">&#39;</span>)),</span>
<span id="cb173-8"><a href="defining-stock-interations.html#cb173-8"></a>                <span class="dt">preference =</span> <span class="kw">paste</span>(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>,<span class="st">&#39;prey&#39;</span>,<span class="dv">1</span>,<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>,<span class="st">&#39;otherfood&#39;</span>, <span class="dv">1</span>),</span>
<span id="cb173-9"><a href="defining-stock-interations.html#cb173-9"></a>                <span class="dt">maxconsumption =</span> <span class="kw">list</span>(<span class="dt">m0=</span><span class="dv">1</span>,<span class="dt">m1=</span><span class="dv">0</span>,<span class="dt">m2=</span><span class="dv">0</span>,<span class="dt">m3=</span><span class="dv">0</span>),</span>
<span id="cb173-10"><a href="defining-stock-interations.html#cb173-10"></a>                <span class="dt">halffeedingvalue =</span> <span class="fl">0.2</span>)</span></code></pre></div>
<p>Now save this all to file and run Gadget:</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="defining-stock-interations.html#cb174-1"></a>prey <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb174-2"><a href="defining-stock-interations.html#cb174-2"></a><span class="st">  </span><span class="kw">write.gadget.file</span>(gd)</span>
<span id="cb174-3"><a href="defining-stock-interations.html#cb174-3"></a></span>
<span id="cb174-4"><a href="defining-stock-interations.html#cb174-4"></a>predator <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb174-5"><a href="defining-stock-interations.html#cb174-5"></a><span class="st">  </span><span class="kw">write.gadget.file</span>(gd)</span>
<span id="cb174-6"><a href="defining-stock-interations.html#cb174-6"></a></span>
<span id="cb174-7"><a href="defining-stock-interations.html#cb174-7"></a>otherfood <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb174-8"><a href="defining-stock-interations.html#cb174-8"></a><span class="st">  </span><span class="kw">write.gadget.file</span>(gd)</span>
<span id="cb174-9"><a href="defining-stock-interations.html#cb174-9"></a></span>
<span id="cb174-10"><a href="defining-stock-interations.html#cb174-10"></a>fit &lt;-<span class="st"> </span><span class="kw">gadget.fit</span>(<span class="dt">wgts =</span> <span class="ot">NULL</span>, <span class="dt">gd =</span> gd, <span class="dt">steps =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Reading input data&quot;
## [1] &quot;Running Gadget&quot;
## [1] &quot;Reading output files&quot;
## [1] &quot;Gathering results&quot;
## [1] &quot;Merging input and output&quot;</code></pre>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="defining-stock-interations.html#cb176-1"></a>fit<span class="op">$</span>res.by.year <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb176-2"><a href="defining-stock-interations.html#cb176-2"></a><span class="st">  </span><span class="kw">filter</span>(stock <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;predator&#39;</span>,<span class="st">&#39;prey&#39;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb176-3"><a href="defining-stock-interations.html#cb176-3"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year,total.number,<span class="dt">lty =</span> stock)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb176-4"><a href="defining-stock-interations.html#cb176-4"></a><span class="st">  </span><span class="kw">expand_limits</span>(<span class="dt">y=</span><span class="dv">0</span>)</span>
<span id="cb176-5"><a href="defining-stock-interations.html#cb176-5"></a></span>
<span id="cb176-6"><a href="defining-stock-interations.html#cb176-6"></a>fit<span class="op">$</span>predator.prey <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb176-7"><a href="defining-stock-interations.html#cb176-7"></a><span class="st">  </span><span class="kw">group_by</span>(year) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb176-8"><a href="defining-stock-interations.html#cb176-8"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">num =</span> <span class="kw">sum</span>(number_consumed)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb176-9"><a href="defining-stock-interations.html#cb176-9"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year,num)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>()</span></code></pre></div>
<p><img src="stock_interactions_files/figure-html/unnamed-chunk-11-1.png" width="50%" /><img src="stock_interactions_files/figure-html/unnamed-chunk-11-2.png" width="50%" /></p>
<div id="excercise-3" class="section level3">
<h3><span class="header-section-number">5.3.1</span> Excercise</h3>
<ul>
<li>In the example above, insert variable names instead of direct numbers for the selection and predation parameters. Investigate the effects of changing the selection parameter has on the consumption. E.g:
<ul>
<li>Change the otherfood time series such that it is more variable</li>
<li>Change the recruitment of both predator and prey</li>
<li>Add a new prey</li>
</ul></li>
</ul>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="getting-started-with-the-gadget-framework.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="building-complex-gadget-models.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="assets/gitbook-2.6.7/js/app.min.js"></script>
<script src="assets/gitbook-2.6.7/js/lunr.js"></script>
<script src="assets/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/hafro/gadget-course/edit/master/stock_interactions.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/hafro/gadget-course/blob/master/stock_interactions.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>

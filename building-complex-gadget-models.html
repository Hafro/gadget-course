<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Building complex Gadget models | Building models using the Gadget framework</title>
  <meta name="description" content="6 Building complex Gadget models | Building models using the Gadget framework" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Building complex Gadget models | Building models using the Gadget framework" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Building complex Gadget models | Building models using the Gadget framework" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="defining-stock-interations.html"/>
<link rel="next" href="fitting-a-model-to-data.html"/>
<script src="assets/jquery-2.2.3/jquery.min.js"></script>
<link href="assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="assets/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="assets/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="assets/anchor-sections-1.0/anchor-sections.js"></script>
<script src="assets/htmlwidgets-1.5.2/htmlwidgets.js"></script>
<link href="assets/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="assets/datatables-binding-0.16/datatables.js"></script>
<link href="assets/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="assets/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="assets/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="assets/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="assets/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">Building Gadget models</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> About this course</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#course-objectives"><i class="fa fa-check"></i><b>1.1</b> Course objectives</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#your-a-priori-homework"><i class="fa fa-check"></i><b>1.2</b> Your a priori homework</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#reading-material"><i class="fa fa-check"></i><b>1.3</b> Reading material</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="general-context-of-gadget.html"><a href="general-context-of-gadget.html"><i class="fa fa-check"></i><b>2</b> General context of Gadget</a><ul>
<li class="chapter" data-level="2.1" data-path="general-context-of-gadget.html"><a href="general-context-of-gadget.html#gadget-a-toolbox-for-fisheries-stock-assessments"><i class="fa fa-check"></i><b>2.1</b> Gadget – a toolbox for fisheries stock assessments</a></li>
<li class="chapter" data-level="2.2" data-path="general-context-of-gadget.html"><a href="general-context-of-gadget.html#description-of-gadget"><i class="fa fa-check"></i><b>2.2</b> Description of Gadget</a></li>
<li class="chapter" data-level="2.3" data-path="general-context-of-gadget.html"><a href="general-context-of-gadget.html#this-course"><i class="fa fa-check"></i><b>2.3</b> This course</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html"><i class="fa fa-check"></i><b>3</b> Introduction to Tidyverse</a><ul>
<li class="chapter" data-level="3.1" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#idealogy-behind-r-for-data-science"><i class="fa fa-check"></i><b>3.1</b> Idealogy behind R for Data Science</a></li>
<li class="chapter" data-level="3.2" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#the-foundation-tibbles-tidy-data-and-piping"><i class="fa fa-check"></i><b>3.2</b> The foundation: tibbles, tidy data, and piping</a><ul>
<li class="chapter" data-level="3.2.1" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#tibbles"><i class="fa fa-check"></i><b>3.2.1</b> Tibbles</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#tidy-data"><i class="fa fa-check"></i><b>3.3</b> Tidy data</a><ul>
<li class="chapter" data-level="3.3.1" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#piping"><i class="fa fa-check"></i><b>3.3.1</b> Piping</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#the-power-of-tidyverse-all-you-need-in-a-handful-of-functions"><i class="fa fa-check"></i><b>3.4</b> The power of tidyverse: all you need in a handful of functions</a></li>
<li class="chapter" data-level="3.5" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#plotting-in-tidyverse"><i class="fa fa-check"></i><b>3.5</b> Plotting in tidyverse</a><ul>
<li class="chapter" data-level="3.5.1" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#ggplot-key-components"><i class="fa fa-check"></i><b>3.5.1</b> ggplot: Key components</a></li>
<li class="chapter" data-level="3.5.2" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#aesthetic-mapping"><i class="fa fa-check"></i><b>3.5.2</b> Aesthetic mapping</a></li>
<li class="chapter" data-level="3.5.3" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#facetting"><i class="fa fa-check"></i><b>3.5.3</b> Facetting</a></li>
<li class="chapter" data-level="3.5.4" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#adding-layers"><i class="fa fa-check"></i><b>3.5.4</b> Adding layers</a></li>
<li class="chapter" data-level="3.5.5" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#add-a-line-to-a-scatterplot"><i class="fa fa-check"></i><b>3.5.5</b> Add a line to a scatterplot</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#statistical-summary-graphs"><i class="fa fa-check"></i><b>3.6</b> Statistical summary graphs</a></li>
<li class="chapter" data-level="3.7" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#other-statistical-summaries"><i class="fa fa-check"></i><b>3.7</b> Other statistical summaries</a></li>
<li class="chapter" data-level="3.8" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#some-controls"><i class="fa fa-check"></i><b>3.8</b> Some controls</a><ul>
<li class="chapter" data-level="3.8.1" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#labels"><i class="fa fa-check"></i><b>3.8.1</b> labels</a></li>
<li class="chapter" data-level="3.8.2" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#legend-position"><i class="fa fa-check"></i><b>3.8.2</b> Legend position</a></li>
<li class="chapter" data-level="3.8.3" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#breaks"><i class="fa fa-check"></i><b>3.8.3</b> breaks</a></li>
<li class="chapter" data-level="3.8.4" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#limits"><i class="fa fa-check"></i><b>3.8.4</b> limits</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="introduction-to-tidyverse.html"><a href="introduction-to-tidyverse.html#further-readings"><i class="fa fa-check"></i><b>3.9</b> Further readings</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html"><i class="fa fa-check"></i><b>4</b> Getting started with the Gadget framework</a><ul>
<li class="chapter" data-level="4.1" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html#what-is-rgadget"><i class="fa fa-check"></i><b>4.1</b> What is Rgadget?</a></li>
<li class="chapter" data-level="4.2" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html#using-rgadget"><i class="fa fa-check"></i><b>4.2</b> Using Rgadget</a></li>
<li class="chapter" data-level="4.3" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html#creating-model-input-files"><i class="fa fa-check"></i><b>4.3</b> Creating model input files</a><ul>
<li class="chapter" data-level="4.3.1" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html#time-file"><i class="fa fa-check"></i><b>4.3.1</b> Time file</a></li>
<li class="chapter" data-level="4.3.2" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html#area-file"><i class="fa fa-check"></i><b>4.3.2</b> Area file</a></li>
<li class="chapter" data-level="4.3.3" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html#stockfiles"><i class="fa fa-check"></i><b>4.3.3</b> Stockfiles</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html#starting-a-simulation"><i class="fa fa-check"></i><b>4.4</b> Starting a simulation</a></li>
<li class="chapter" data-level="4.5" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html#gadget-variables"><i class="fa fa-check"></i><b>4.5</b> Gadget variables</a></li>
<li class="chapter" data-level="4.6" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html#predation"><i class="fa fa-check"></i><b>4.6</b> Predation</a></li>
<li class="chapter" data-level="4.7" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html#fleet-operations"><i class="fa fa-check"></i><b>4.7</b> Fleet operations</a><ul>
<li class="chapter" data-level="4.7.1" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html#excercise"><i class="fa fa-check"></i><b>4.7.1</b> Excercise</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html#recruitment"><i class="fa fa-check"></i><b>4.8</b> Recruitment</a><ul>
<li class="chapter" data-level="4.8.1" data-path="getting-started-with-the-gadget-framework.html"><a href="getting-started-with-the-gadget-framework.html#exercise-1"><i class="fa fa-check"></i><b>4.8.1</b> Exercise</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="defining-stock-interations.html"><a href="defining-stock-interations.html"><i class="fa fa-check"></i><b>5</b> Defining stock interations</a><ul>
<li class="chapter" data-level="5.1" data-path="defining-stock-interations.html"><a href="defining-stock-interations.html#fish-recruits-into-a-stock"><i class="fa fa-check"></i><b>5.1</b> Fish recruits into a stock</a><ul>
<li class="chapter" data-level="5.1.1" data-path="defining-stock-interations.html"><a href="defining-stock-interations.html#exercise-2"><i class="fa fa-check"></i><b>5.1.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="defining-stock-interations.html"><a href="defining-stock-interations.html#spawning"><i class="fa fa-check"></i><b>5.2</b> Spawning</a><ul>
<li class="chapter" data-level="5.2.1" data-path="defining-stock-interations.html"><a href="defining-stock-interations.html#time-variables"><i class="fa fa-check"></i><b>5.2.1</b> Time variables</a></li>
<li class="chapter" data-level="5.2.2" data-path="defining-stock-interations.html"><a href="defining-stock-interations.html#exercise-3"><i class="fa fa-check"></i><b>5.2.2</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="defining-stock-interations.html"><a href="defining-stock-interations.html#consumption"><i class="fa fa-check"></i><b>5.3</b> Consumption</a><ul>
<li class="chapter" data-level="5.3.1" data-path="defining-stock-interations.html"><a href="defining-stock-interations.html#exercise-4"><i class="fa fa-check"></i><b>5.3.1</b> Exercise</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="building-complex-gadget-models.html"><a href="building-complex-gadget-models.html"><i class="fa fa-check"></i><b>6</b> Building complex Gadget models</a><ul>
<li class="chapter" data-level="6.1" data-path="building-complex-gadget-models.html"><a href="building-complex-gadget-models.html#defining-growth"><i class="fa fa-check"></i><b>6.1</b> Defining growth</a><ul>
<li class="chapter" data-level="6.1.1" data-path="building-complex-gadget-models.html"><a href="building-complex-gadget-models.html#growth"><i class="fa fa-check"></i><b>6.1.1</b> Growth</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="building-complex-gadget-models.html"><a href="building-complex-gadget-models.html#ling-stock-assessment-in-icelandic-waters"><i class="fa fa-check"></i><b>6.2</b> Ling stock assessment in Icelandic waters</a></li>
<li class="chapter" data-level="6.3" data-path="building-complex-gadget-models.html"><a href="building-complex-gadget-models.html#model-initiation"><i class="fa fa-check"></i><b>6.3</b> Model initiation</a><ul>
<li class="chapter" data-level="6.3.1" data-path="building-complex-gadget-models.html"><a href="building-complex-gadget-models.html#maturation-as-multi-stock-models"><i class="fa fa-check"></i><b>6.3.1</b> Maturation as multi-‘stock’ models</a></li>
<li class="chapter" data-level="6.3.2" data-path="building-complex-gadget-models.html"><a href="building-complex-gadget-models.html#initial-conditions"><i class="fa fa-check"></i><b>6.3.2</b> Initial conditions</a></li>
<li class="chapter" data-level="6.3.3" data-path="building-complex-gadget-models.html"><a href="building-complex-gadget-models.html#renewal"><i class="fa fa-check"></i><b>6.3.3</b> Renewal</a></li>
<li class="chapter" data-level="6.3.4" data-path="building-complex-gadget-models.html"><a href="building-complex-gadget-models.html#reference-weight"><i class="fa fa-check"></i><b>6.3.4</b> Reference Weight</a></li>
<li class="chapter" data-level="6.3.5" data-path="building-complex-gadget-models.html"><a href="building-complex-gadget-models.html#is-fished-eaten"><i class="fa fa-check"></i><b>6.3.5</b> Is fished / eaten</a></li>
<li class="chapter" data-level="6.3.6" data-path="building-complex-gadget-models.html"><a href="building-complex-gadget-models.html#set-up-fleets-using-catch-or-effort-data"><i class="fa fa-check"></i><b>6.3.6</b> Set up fleets using catch or effort data</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="building-complex-gadget-models.html"><a href="building-complex-gadget-models.html#run-the-simulation-using-pre-determined-parameters"><i class="fa fa-check"></i><b>6.4</b> Run the simulation using pre-determined parameters</a></li>
<li class="chapter" data-level="6.5" data-path="building-complex-gadget-models.html"><a href="building-complex-gadget-models.html#talking-points"><i class="fa fa-check"></i><b>6.5</b> Talking points</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="fitting-a-model-to-data.html"><a href="fitting-a-model-to-data.html"><i class="fa fa-check"></i><b>7</b> Fitting a model to data</a><ul>
<li class="chapter" data-level="7.1" data-path="fitting-a-model-to-data.html"><a href="fitting-a-model-to-data.html#introducing-likelihood-functions"><i class="fa fa-check"></i><b>7.1</b> Introducing likelihood functions</a></li>
<li class="chapter" data-level="7.2" data-path="fitting-a-model-to-data.html"><a href="fitting-a-model-to-data.html#incorporating-data-ling-case-study-cont."><i class="fa fa-check"></i><b>7.2</b> Incorporating data (Ling case study cont.)</a><ul>
<li class="chapter" data-level="7.2.1" data-path="fitting-a-model-to-data.html"><a href="fitting-a-model-to-data.html#exercise-7"><i class="fa fa-check"></i><b>7.2.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="fitting-a-model-to-data.html"><a href="fitting-a-model-to-data.html#setting-up-likelihood-components"><i class="fa fa-check"></i><b>7.3</b> Setting up likelihood components</a><ul>
<li class="chapter" data-level="7.3.1" data-path="fitting-a-model-to-data.html"><a href="fitting-a-model-to-data.html#setting-up-survey-indices"><i class="fa fa-check"></i><b>7.3.1</b> Setting up survey indices</a></li>
<li class="chapter" data-level="7.3.2" data-path="fitting-a-model-to-data.html"><a href="fitting-a-model-to-data.html#penalty-functions"><i class="fa fa-check"></i><b>7.3.2</b> Penalty functions</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="fitting-a-model-to-data.html"><a href="fitting-a-model-to-data.html#fitting-a-gadget-model-to-data"><i class="fa fa-check"></i><b>7.4</b> Fitting a Gadget model to data</a><ul>
<li class="chapter" data-level="7.4.1" data-path="fitting-a-model-to-data.html"><a href="fitting-a-model-to-data.html#create-starting-values"><i class="fa fa-check"></i><b>7.4.1</b> Create starting values</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="fitting-a-model-to-data.html"><a href="fitting-a-model-to-data.html#set-optimisation-routine"><i class="fa fa-check"></i><b>7.5</b> Set optimisation routine</a></li>
<li class="chapter" data-level="7.6" data-path="fitting-a-model-to-data.html"><a href="fitting-a-model-to-data.html#using-the-iterative-reweighting-function-to-fit-a-gadget-statistical-model"><i class="fa fa-check"></i><b>7.6</b> Using the iterative reweighting function to fit a Gadget statistical model</a></li>
<li class="chapter" data-level="7.7" data-path="fitting-a-model-to-data.html"><a href="fitting-a-model-to-data.html#visualize-gadget-statistical-model-fit"><i class="fa fa-check"></i><b>7.7</b> Visualize Gadget statistical model fit</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="projections-using-rgadget.html"><a href="projections-using-rgadget.html"><i class="fa fa-check"></i><b>8</b> Projections using Rgadget</a><ul>
<li class="chapter" data-level="8.1" data-path="projections-using-rgadget.html"><a href="projections-using-rgadget.html#example-based-on-the-ling-assessment"><i class="fa fa-check"></i><b>8.1</b> Example based on the ling assessment</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="defining-multi-area-models.html"><a href="defining-multi-area-models.html"><i class="fa fa-check"></i><b>9</b> Defining multi area models</a><ul>
<li class="chapter" data-level="9.1" data-path="defining-multi-area-models.html"><a href="defining-multi-area-models.html#alternate-structures-multiple-areas"><i class="fa fa-check"></i><b>9.1</b> Alternate structures: multiple areas</a><ul>
<li class="chapter" data-level="9.1.1" data-path="defining-multi-area-models.html"><a href="defining-multi-area-models.html#migration"><i class="fa fa-check"></i><b>9.1.1</b> Migration</a></li>
<li class="chapter" data-level="9.1.2" data-path="defining-multi-area-models.html"><a href="defining-multi-area-models.html#using-data-from-multiple-areas"><i class="fa fa-check"></i><b>9.1.2</b> Using data from multiple areas</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="marine-mammals.html"><a href="marine-mammals.html"><i class="fa fa-check"></i><b>10</b> Marine mammals</a><ul>
<li class="chapter" data-level="10.1" data-path="marine-mammals.html"><a href="marine-mammals.html#setting-up-a-model-for-a-hypothetical-whale-stock"><i class="fa fa-check"></i><b>10.1</b> Setting up a model for a hypothetical whale stock</a></li>
<li class="chapter" data-level="10.2" data-path="marine-mammals.html"><a href="marine-mammals.html#run-gadget-and-set-initial-parameters"><i class="fa fa-check"></i><b>10.2</b> Run Gadget and set initial parameters</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html"><i class="fa fa-check"></i><b>11</b> Processing input data with MFDB</a><ul>
<li class="chapter" data-level="11.1" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#working-with-data"><i class="fa fa-check"></i><b>11.1</b> Working with data</a></li>
<li class="chapter" data-level="11.2" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#description-of-the-mfdb-system"><i class="fa fa-check"></i><b>11.2</b> Description of the MFDB system</a><ul>
<li class="chapter" data-level="11.2.1" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#installing-mfdb"><i class="fa fa-check"></i><b>11.2.1</b> Installing MFDB</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#importing-data"><i class="fa fa-check"></i><b>11.3</b> Importing data</a><ul>
<li class="chapter" data-level="11.3.1" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#connect-to-database"><i class="fa fa-check"></i><b>11.3.1</b> Connect to database</a></li>
<li class="chapter" data-level="11.3.2" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#defining-taxonomies"><i class="fa fa-check"></i><b>11.3.2</b> Defining taxonomies</a></li>
<li class="chapter" data-level="11.3.3" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#define-areas-divisions"><i class="fa fa-check"></i><b>11.3.3</b> Define areas &amp; divisions</a></li>
<li class="chapter" data-level="11.3.4" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#define-sampling-types"><i class="fa fa-check"></i><b>11.3.4</b> Define sampling types</a></li>
<li class="chapter" data-level="11.3.5" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#define-vessel-taxonomy"><i class="fa fa-check"></i><b>11.3.5</b> Define vessel taxonomy</a></li>
<li class="chapter" data-level="11.3.6" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#define-tow-taxonomy"><i class="fa fa-check"></i><b>11.3.6</b> Define tow taxonomy</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#importing-data-1"><i class="fa fa-check"></i><b>11.4</b> Importing data</a><ul>
<li class="chapter" data-level="11.4.1" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#import-temperature-data"><i class="fa fa-check"></i><b>11.4.1</b> Import temperature data</a></li>
<li class="chapter" data-level="11.4.2" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#importing-surveycommercial-samples"><i class="fa fa-check"></i><b>11.4.2</b> Importing survey/commercial samples</a></li>
<li class="chapter" data-level="11.4.3" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#import-stomach-survey"><i class="fa fa-check"></i><b>11.4.3</b> Import stomach survey</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#querying-data"><i class="fa fa-check"></i><b>11.5</b> Querying data</a></li>
<li class="chapter" data-level="11.6" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#uploading-the-datras-database-to-mfdb"><i class="fa fa-check"></i><b>11.6</b> Uploading the DATRAS database to MFDB</a></li>
<li class="chapter" data-level="11.7" data-path="processing-input-data-with-mfdb.html"><a href="processing-input-data-with-mfdb.html#dumping-restoring-a-db"><i class="fa fa-check"></i><b>11.7</b> Dumping / Restoring a DB</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="installing-gadget-from-source.html"><a href="installing-gadget-from-source.html"><i class="fa fa-check"></i><b>A</b> Installing Gadget from source</a><ul>
<li class="chapter" data-level="A.1" data-path="installing-gadget-from-source.html"><a href="installing-gadget-from-source.html#command-line-version"><i class="fa fa-check"></i><b>A.1</b> Command line version</a><ul>
<li class="chapter" data-level="A.1.1" data-path="installing-gadget-from-source.html"><a href="installing-gadget-from-source.html#linux"><i class="fa fa-check"></i><b>A.1.1</b> Linux</a></li>
<li class="chapter" data-level="A.1.2" data-path="installing-gadget-from-source.html"><a href="installing-gadget-from-source.html#mac"><i class="fa fa-check"></i><b>A.1.2</b> Mac</a></li>
<li class="chapter" data-level="A.1.3" data-path="installing-gadget-from-source.html"><a href="installing-gadget-from-source.html#windows"><i class="fa fa-check"></i><b>A.1.3</b> Windows</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="installing-gadget-from-source.html"><a href="installing-gadget-from-source.html#download-compile-and-install"><i class="fa fa-check"></i><b>A.2</b> Download, compile and install</a><ul>
<li class="chapter" data-level="A.2.1" data-path="installing-gadget-from-source.html"><a href="installing-gadget-from-source.html#standard-procedure"><i class="fa fa-check"></i><b>A.2.1</b> Standard procedure</a></li>
<li class="chapter" data-level="A.2.2" data-path="installing-gadget-from-source.html"><a href="installing-gadget-from-source.html#recommended-via-git"><i class="fa fa-check"></i><b>A.2.2</b> Recommended: via Git</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="troubleshooting-gadget-models.html"><a href="troubleshooting-gadget-models.html"><i class="fa fa-check"></i><b>B</b> Troubleshooting Gadget models</a><ul>
<li class="chapter" data-level="B.1" data-path="troubleshooting-gadget-models.html"><a href="troubleshooting-gadget-models.html#file-data-gadget-cannot-be-found"><i class="fa fa-check"></i><b>B.1</b> File / data / Gadget cannot be found</a></li>
<li class="chapter" data-level="B.2" data-path="troubleshooting-gadget-models.html"><a href="troubleshooting-gadget-models.html#fleet-data-likelihood-problems"><i class="fa fa-check"></i><b>B.2</b> Fleet / Data / Likelihood problems</a><ul>
<li class="chapter" data-level="B.2.1" data-path="troubleshooting-gadget-models.html"><a href="troubleshooting-gadget-models.html#fleet-does-not-exist-in-an-area"><i class="fa fa-check"></i><b>B.2.1</b> Fleet does not exist in an area</a></li>
<li class="chapter" data-level="B.2.2" data-path="troubleshooting-gadget-models.html"><a href="troubleshooting-gadget-models.html#certain-likelihood-scores-or-values-are-not-being-calculated"><i class="fa fa-check"></i><b>B.2.2</b> Certain likelihood scores or values are not being calculated</a></li>
<li class="chapter" data-level="B.2.3" data-path="troubleshooting-gadget-models.html"><a href="troubleshooting-gadget-models.html#starting-value-is-outside-the-bounds-of-the-parameter"><i class="fa fa-check"></i><b>B.2.3</b> Starting value is outside the bounds of the parameter</a></li>
<li class="chapter" data-level="B.2.4" data-path="troubleshooting-gadget-models.html"><a href="troubleshooting-gadget-models.html#update-gadget-and-rgadget-restart-the-rsession"><i class="fa fa-check"></i><b>B.2.4</b> Update Gadget and Rgadget, restart the Rsession</a></li>
</ul></li>
<li class="chapter" data-level="B.3" data-path="troubleshooting-gadget-models.html"><a href="troubleshooting-gadget-models.html#list-of-known-gadget-quirks"><i class="fa fa-check"></i><b>B.3</b> List of known Gadget quirks</a></li>
<li class="chapter" data-level="B.4" data-path="troubleshooting-gadget-models.html"><a href="troubleshooting-gadget-models.html#gadget-is-working-properly-but-results-are-strange"><i class="fa fa-check"></i><b>B.4</b> Gadget is working properly, but results are strange</a><ul>
<li class="chapter" data-level="B.4.1" data-path="troubleshooting-gadget-models.html"><a href="troubleshooting-gadget-models.html#programming-errors"><i class="fa fa-check"></i><b>B.4.1</b> Programming errors</a></li>
<li class="chapter" data-level="B.4.2" data-path="troubleshooting-gadget-models.html"><a href="troubleshooting-gadget-models.html#old-files-hanging-around-in-the-gadget-model-directory"><i class="fa fa-check"></i><b>B.4.2</b> Old files hanging around in the Gadget model directory</a></li>
<li class="chapter" data-level="B.4.3" data-path="troubleshooting-gadget-models.html"><a href="troubleshooting-gadget-models.html#gadget-iterative-gives-errors"><i class="fa fa-check"></i><b>B.4.3</b> Gadget iterative gives errors</a></li>
<li class="chapter" data-level="B.4.4" data-path="troubleshooting-gadget-models.html"><a href="troubleshooting-gadget-models.html#the-gadget-working-directory-is-incorporating-files-from-another-gadget-model"><i class="fa fa-check"></i><b>B.4.4</b> The Gadget working directory is incorporating files from another Gadget model</a></li>
<li class="chapter" data-level="B.4.5" data-path="troubleshooting-gadget-models.html"><a href="troubleshooting-gadget-models.html#your-model-is-not-good"><i class="fa fa-check"></i><b>B.4.5</b> Your model is not good</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="C" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>C</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Building models using the Gadget framework</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="building-complex-gadget-models" class="section level1">
<h1><span class="header-section-number">6</span> Building complex Gadget models</h1>
<div id="defining-growth" class="section level2">
<h2><span class="header-section-number">6.1</span> Defining growth</h2>
<p>Let us begin by setting the scene with time and area in the typical fashion:</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="building-complex-gadget-models.html#cb177-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb177-2"><a href="building-complex-gadget-models.html#cb177-2"></a><span class="kw">library</span>(Rgadget)</span>
<span id="cb177-3"><a href="building-complex-gadget-models.html#cb177-3"></a></span>
<span id="cb177-4"><a href="building-complex-gadget-models.html#cb177-4"></a></span>
<span id="cb177-5"><a href="building-complex-gadget-models.html#cb177-5"></a>gd &lt;-<span class="st"> </span><span class="kw">gadget.variant.dir</span>(<span class="st">&#39;simple_growth_model&#39;</span>)</span>
<span id="cb177-6"><a href="building-complex-gadget-models.html#cb177-6"></a>gd</span></code></pre></div>
<pre><code>## [1] &quot;simple_growth_model&quot;
## attr(,&quot;mainfile&quot;)
## [1] &quot;main&quot;
## attr(,&quot;class&quot;)
## [1] &quot;gadget.variant&quot; &quot;list&quot;</code></pre>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="building-complex-gadget-models.html#cb179-1"></a><span class="co">## lets look at the files in gd</span></span>
<span id="cb179-2"><a href="building-complex-gadget-models.html#cb179-2"></a><span class="co">#fs::dir_ls(gd) ## nothing has happened</span></span>
<span id="cb179-3"><a href="building-complex-gadget-models.html#cb179-3"></a></span>
<span id="cb179-4"><a href="building-complex-gadget-models.html#cb179-4"></a><span class="co">## Time file</span></span>
<span id="cb179-5"><a href="building-complex-gadget-models.html#cb179-5"></a>schedule &lt;-<span class="st"> </span></span>
<span id="cb179-6"><a href="building-complex-gadget-models.html#cb179-6"></a><span class="st">  </span><span class="kw">expand.grid</span>(<span class="dt">year =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">step =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb179-7"><a href="building-complex-gadget-models.html#cb179-7"></a><span class="st">  </span><span class="kw">arrange</span>(year)</span>
<span id="cb179-8"><a href="building-complex-gadget-models.html#cb179-8"></a></span>
<span id="cb179-9"><a href="building-complex-gadget-models.html#cb179-9"></a><span class="kw">gadgetfile</span>(<span class="st">&#39;Modelfiles/time&#39;</span>,</span>
<span id="cb179-10"><a href="building-complex-gadget-models.html#cb179-10"></a>           <span class="dt">file_type =</span> <span class="st">&#39;time&#39;</span>,</span>
<span id="cb179-11"><a href="building-complex-gadget-models.html#cb179-11"></a>           <span class="dt">components =</span> <span class="kw">list</span>(<span class="kw">list</span>(<span class="dt">firstyear =</span> <span class="kw">min</span>(schedule<span class="op">$</span>year),</span>
<span id="cb179-12"><a href="building-complex-gadget-models.html#cb179-12"></a>                                  <span class="dt">firststep=</span><span class="dv">1</span>,</span>
<span id="cb179-13"><a href="building-complex-gadget-models.html#cb179-13"></a>                                  <span class="dt">lastyear=</span><span class="kw">max</span>(schedule<span class="op">$</span>year),</span>
<span id="cb179-14"><a href="building-complex-gadget-models.html#cb179-14"></a>                                  <span class="dt">laststep=</span><span class="dv">4</span>,</span>
<span id="cb179-15"><a href="building-complex-gadget-models.html#cb179-15"></a>                                  <span class="dt">notimesteps=</span><span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>)))) <span class="op">%&gt;%</span><span class="st"> </span><span class="co">## number of time steps and step length in months</span></span>
<span id="cb179-16"><a href="building-complex-gadget-models.html#cb179-16"></a><span class="st">  </span><span class="kw">write.gadget.file</span>(gd)</span>
<span id="cb179-17"><a href="building-complex-gadget-models.html#cb179-17"></a></span>
<span id="cb179-18"><a href="building-complex-gadget-models.html#cb179-18"></a></span>
<span id="cb179-19"><a href="building-complex-gadget-models.html#cb179-19"></a></span>
<span id="cb179-20"><a href="building-complex-gadget-models.html#cb179-20"></a><span class="co">## Area file</span></span>
<span id="cb179-21"><a href="building-complex-gadget-models.html#cb179-21"></a></span>
<span id="cb179-22"><a href="building-complex-gadget-models.html#cb179-22"></a><span class="kw">gadgetfile</span>(<span class="st">&#39;Modelfiles/area&#39;</span>,</span>
<span id="cb179-23"><a href="building-complex-gadget-models.html#cb179-23"></a>           <span class="dt">file_type =</span> <span class="st">&#39;area&#39;</span>,</span>
<span id="cb179-24"><a href="building-complex-gadget-models.html#cb179-24"></a>           <span class="dt">components =</span> <span class="kw">list</span>(<span class="kw">list</span>(<span class="dt">areas =</span> <span class="dv">1</span>,</span>
<span id="cb179-25"><a href="building-complex-gadget-models.html#cb179-25"></a>                                  <span class="dt">size =</span> <span class="dv">1</span>,</span>
<span id="cb179-26"><a href="building-complex-gadget-models.html#cb179-26"></a>                                  <span class="dt">temperature =</span> schedule <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb179-27"><a href="building-complex-gadget-models.html#cb179-27"></a><span class="st">                                    </span><span class="kw">mutate</span>(<span class="dt">area =</span> <span class="dv">1</span>, <span class="dt">temperature =</span> <span class="dv">5</span>)))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb179-28"><a href="building-complex-gadget-models.html#cb179-28"></a><span class="st">  </span><span class="kw">write.gadget.file</span>(gd)</span></code></pre></div>
<p>Now that we have attributes of the time and place, we can insert a population into
it. Remember that population subcomponents are called ‘stocks’ in Gadget. To do this, we use the
function <code>gadgetstock</code>. However, using gadgetstock also has some default settings built in for
convenience. The first one is that it automatically sets up the Gadget model with growth
implemented. If we first generate a default stock (with name ‘test’), we find that much of
the structural information we supplied above was not supplied, and most of the other settings
are turned off (value = 0, more on those settings later).</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="building-complex-gadget-models.html#cb180-1"></a><span class="kw">gadgetstock</span>(<span class="st">&#39;test&#39;</span>,gd,<span class="dt">missingOkay =</span> <span class="ot">TRUE</span>) </span></code></pre></div>
<pre><code>## ; Generated by Rgadget 0.5
## stockname    test
## livesonareas 
## minage   
## maxage   
## minlength    
## maxlength    
## dl   
## refweightfile    
## growthandeatlengths  
## doesgrow 1
## growthfunction   lengthvbsimple
## growthparameters #test.Linf  (* 0.001 #test.k)   #test.walpha    #test.wbeta
## beta (* 10 #test.bbin)
## maxlengthgroupgrowth 15
## naturalmortality 
## iseaten  0
## doeseat  0
## initialconditions
## doesmigrate  0
## doesmature   0
## doesmove 0
## doesrenew    0
## doesspawn    0
## doesstray    0</code></pre>
<p>However, growth is the exception: <code>doesgrow</code> is turned on (value set to 1) with the growth
function <code>lengthvbsimple</code> implemented and parameters supplied to that function as
<code>test.Linf</code>, <code>test.k</code> (multiplied by 0.001 to keep it help the optimisation routine by
placing it on a similar scale to other parameters), <code>test.walpha</code>, <code>test.wbeta</code>,
<code>test.bbin</code> (also multiplied by a scalar), and a constant value for <code>maxlengthgroupgrowth</code>.</p>
<div id="growth" class="section level3">
<h3><span class="header-section-number">6.1.1</span> Growth</h3>
<p>Growth is implemented using three processes in Gadget. The first process is described by a
growth function that shows how mean body size at age changes over time. The second process
generates variability around that mean length at age relationship using a beta binomial
distribution (currently, no other distributions are implemented). The third process translates
between lengths and weights.</p>
<p>The first and third processes are implemented together via the chosen growth function. In the
default Rgadget <code>lengthvbsimple</code> function implementation, the length at infinity and growth rate
parameters supplied to this function are automatically named <code>test.Linf</code> and <code>test.k</code> to
signify that these parameters only refer to growth within the ‘test’ stock. Similarly, an
exponential relationship is used to represent growth, using the automatically named
<code>test.walpha</code> and <code>test.wbeta</code> parameters. Because they are by default supplied here and
supplied as switches with ‘#’ preceding them, they will be automatically
generated in the parameter file when an initial Gadget simulation is run, and their values can
then be controlled from this file (as demonstrated <a href="https://hafro.github.io/gadget-course/getting-started-with-the-gadget-framework.html#gadget-variables">here</a>). Beyond <code>lengthvbsimple</code>,
there are a variety of other growth functions that can be implemented,
including those that implement starvation, time- and area- dependent growth, or reading weights
from a length-weight key. These are described in the <a href="https://hafro.github.io/gadget2/userguide/chap-stock.html#sec:stockgrowth">Gadget User Guide</a>.</p>
<p>The second process is implemented in the default by providing a single switch <code>test.bbin</code>
parameter to the beta-binomial distribution, along with a constant value for
<code>maxlengthgroupgrowth</code>. The beta-binomial distribution is implemented in Gadget because high
flexibility in the distribution of growth deviations is provided by changing only a single
estimable parameter. The constant value for <code>maxlengthgroupgrowth</code> describes the maximum number of
length bins a fish is allowed to grow in a single time step, so it should be set high enough to
be realistic.</p>
<p>As growth is one of the major determinants of population dynamics, some words of caution should
be mentioned in any discussion of the implementation of growth in
Gadget. The first is that the implementation of the Von Bertalanffy growth curves used in Gadget
are based on predicting changes in length over a time step, based on the length at the end of
the previous time step and the length of the time step. Therefore, length is not directly
associated with age. This is a useful property when Gadget is being used for estimation, because
it implies that age data are not a prerequisite to estimating growth (although it does help).
However, it also implies that the parameter values obtained when estimating (i.e., the
length at infinity <span class="math inline">\(L_\infty\)</span> and growth rate <span class="math inline">\(k\)</span> parameters) are not directly comparable to those estimated
when using length and age data in non-linear model estimation (standard methods). In particular,
<span class="math inline">\(L_\infty\)</span> using standard estimation methods with age data would represent the mean
length attainable at infinity, but in Gadget it represents the maximal length that could be
expected at infinity, and therefore almost all fish tracked in the model should actually be
below this value. If individuals happen to surpass <span class="math inline">\(L_\infty\)</span> in one time step due to variability in
growth implemented via the beta binomial distribution, those individuals will exhibit negative
growth in the next time step. This process is not represented by standard methods of
estimation using age data. Therefore, care should be taken that any final values used for <span class="math inline">\(L_\infty\)</span> within Gadget should be roughly above that expected of most fish observed, in order
to avoid accidentally implementing unexpected and unrealistic negative growth.</p>
<p>The second word of caution is that although the beta-binomial distribution has proven to be a very useful
distribution for capturing realistic patterns in the variability of the growth process, it is
not a very well-known or intuitive distribution. High values of beta produce a narrow
distribution, while lower values produce a more dispersed distribution with a larger right-hand
tail. Very low values should be avoided because it changes the expected shape of the
distribution. In addition, the default value of maximum 15 length bin steps by which a fish
could grow is set to be generous to allow the beta-binomial enough space to estimate the shape
of the distribution without being confined by an upper limit. However, in practice, where
growth is difficult to estimate or cohorts have very narrow length distributions, setting this
parameter to a much lower value (2 - 4) can sometimes better capture observed patterns
in growth variability.</p>
<p>Finally, it should be kept in mind that growth, like all other time-dependent processes, is
implemented within Gadget according to the time steps provided, not corresponding to an annual
basis. For example, a model with quarterly time steps would yield annual growth based on <span class="math inline">\(\Delta t = 1/4\)</span>,
whereas the same in monthly time steps would yield <span class="math inline">\(\Delta t = 1/12\)</span>. Likewise, setting
<code>maxlengthgroupgrowth</code> to 2 would be far more constricting for a model with quarterly time
steps than a model with monthly time steps: at most <span class="math inline">\(2 * 4 = 8\)</span> length group steps would be allowed
per annum rather than <span class="math inline">\(2 * 12 = 24\)</span>. An exception to this implementation is values for
mortality: they are expected to be suppled as annual mortality rates, and are therefore
subsequently divided among the time steps before implementation (e.g., so that <span class="math inline">\(M = 0.2\)</span> is the
same in quarterly and monthly models).</p>
<p>To play around with the growth model we can now define a simple growth model to test the effect of various parameter settings:</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="building-complex-gadget-models.html#cb182-1"></a><span class="co">## Stock file </span></span>
<span id="cb182-2"><a href="building-complex-gadget-models.html#cb182-2"></a>stock &lt;-<span class="st"> </span><span class="kw">gadgetstock</span>(<span class="st">&#39;growth_stock&#39;</span>,gd,<span class="dt">missingOkay =</span> <span class="ot">TRUE</span>)</span>
<span id="cb182-3"><a href="building-complex-gadget-models.html#cb182-3"></a>stock</span></code></pre></div>
<pre><code>## ; Generated by Rgadget 0.5
## stockname    growth_stock
## livesonareas 
## minage   
## maxage   
## minlength    
## maxlength    
## dl   
## refweightfile    
## growthandeatlengths  
## doesgrow 1
## growthfunction   lengthvbsimple
## growthparameters #growth_stock.Linf  (* 0.001 #growth_stock.k)   #growth_stock.walpha    #growth_stock.wbeta
## beta (* 10 #growth_stock.bbin)
## maxlengthgroupgrowth 15
## naturalmortality 
## iseaten  0
## doeseat  0
## initialconditions
## doesmigrate  0
## doesmature   0
## doesmove 0
## doesrenew    0
## doesspawn    0
## doesstray    0</code></pre>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="building-complex-gadget-models.html#cb184-1"></a>stock &lt;-<span class="st"> </span></span>
<span id="cb184-2"><a href="building-complex-gadget-models.html#cb184-2"></a><span class="st">  </span>stock <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb184-3"><a href="building-complex-gadget-models.html#cb184-3"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;stock&#39;</span>,</span>
<span id="cb184-4"><a href="building-complex-gadget-models.html#cb184-4"></a>                <span class="dt">livesonareas =</span> <span class="dv">1</span>,</span>
<span id="cb184-5"><a href="building-complex-gadget-models.html#cb184-5"></a>                <span class="dt">maxage =</span> <span class="dv">1</span>,</span>
<span id="cb184-6"><a href="building-complex-gadget-models.html#cb184-6"></a>                <span class="dt">minage =</span> <span class="dv">1</span>,</span>
<span id="cb184-7"><a href="building-complex-gadget-models.html#cb184-7"></a>                <span class="dt">minlength =</span> <span class="dv">0</span>,</span>
<span id="cb184-8"><a href="building-complex-gadget-models.html#cb184-8"></a>                <span class="dt">maxlength =</span> <span class="dv">100</span>,</span>
<span id="cb184-9"><a href="building-complex-gadget-models.html#cb184-9"></a>                <span class="dt">dl =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb184-10"><a href="building-complex-gadget-models.html#cb184-10"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;naturalmortality&#39;</span>,<span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb184-11"><a href="building-complex-gadget-models.html#cb184-11"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;refweight&#39;</span>,<span class="dt">data=</span><span class="kw">tibble</span>(<span class="dt">length=</span><span class="dv">0</span><span class="op">:</span><span class="dv">100</span>,<span class="dt">mean=</span><span class="dv">1</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb184-12"><a href="building-complex-gadget-models.html#cb184-12"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;initialconditions&#39;</span>,</span>
<span id="cb184-13"><a href="building-complex-gadget-models.html#cb184-13"></a>                <span class="dt">normalparam =</span> <span class="kw">tibble</span>(<span class="dt">age =</span> <span class="dv">1</span>,</span>
<span id="cb184-14"><a href="building-complex-gadget-models.html#cb184-14"></a>                                     <span class="dt">area =</span> <span class="dv">1</span>,</span>
<span id="cb184-15"><a href="building-complex-gadget-models.html#cb184-15"></a>                                     <span class="dt">age.factor =</span> <span class="dv">1</span>,   </span>
<span id="cb184-16"><a href="building-complex-gadget-models.html#cb184-16"></a>                                     <span class="dt">area.factor =</span><span class="dv">1</span>,</span>
<span id="cb184-17"><a href="building-complex-gadget-models.html#cb184-17"></a>                                     <span class="dt">mean =</span> <span class="dv">1</span>,</span>
<span id="cb184-18"><a href="building-complex-gadget-models.html#cb184-18"></a>                                     <span class="dt">stddev =</span> <span class="fl">.1</span>,</span>
<span id="cb184-19"><a href="building-complex-gadget-models.html#cb184-19"></a>                                     <span class="dt">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb184-20"><a href="building-complex-gadget-models.html#cb184-20"></a>                                     <span class="dt">beta =</span> <span class="dv">1</span>))</span>
<span id="cb184-21"><a href="building-complex-gadget-models.html#cb184-21"></a>stock <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb184-22"><a href="building-complex-gadget-models.html#cb184-22"></a><span class="st">  </span><span class="kw">write.gadget.file</span>(gd)</span>
<span id="cb184-23"><a href="building-complex-gadget-models.html#cb184-23"></a>stock</span></code></pre></div>
<pre><code>## ; Generated by Rgadget 0.5
## stockname    growth_stock
## livesonareas 1
## minage   1
## maxage   1
## minlength    0
## maxlength    100
## dl   1
## refweightfile    Modelfiles/growth_stock.refwgt
## growthandeatlengths  Aggfiles/growth_stock.stock.len.agg
## doesgrow 1
## growthfunction   lengthvbsimple
## growthparameters #growth_stock.Linf  (* 0.001 #growth_stock.k)   #growth_stock.walpha    #growth_stock.wbeta
## beta (* 10 #growth_stock.bbin)
## maxlengthgroupgrowth 15
## naturalmortality 0
## iseaten  0
## doeseat  0
## initialconditions
## minage   1
## maxage   1
## minlength    0
## maxlength    100
## dl   1
## normalparamfile  Modelfiles/growth_stock.init.normalparam
## doesmigrate  0
## doesmature   0
## doesmove 0
## doesrenew    0
## doesspawn    0
## doesstray    0</code></pre>
<p>For the sake of testing let run the model and see if the run is successful:</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="building-complex-gadget-models.html#cb186-1"></a><span class="kw">gadget_evaluate</span>(gd, <span class="dt">log =</span> <span class="st">&#39;growth_log&#39;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;simple_growth_model&quot;
## attr(,&quot;mainfile&quot;)
## [1] &quot;main&quot;
## attr(,&quot;class&quot;)
## [1] &quot;gadget.variant&quot; &quot;list&quot;</code></pre>
<p>To play with the effects of various settings:</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="building-complex-gadget-models.html#cb188-1"></a><span class="kw">read.gadget.parameters</span>(<span class="kw">paste</span>(gd, <span class="st">&#39;params.out&#39;</span>, <span class="dt">sep =</span> <span class="st">&#39;/&#39;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb188-2"><a href="building-complex-gadget-models.html#cb188-2"></a><span class="st">  </span><span class="kw">init_guess</span>(<span class="st">&#39;alpha&#39;</span>, <span class="dt">value =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb188-3"><a href="building-complex-gadget-models.html#cb188-3"></a><span class="st">  </span><span class="kw">init_guess</span>(<span class="st">&#39;beta&#39;</span>, <span class="dt">value =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb188-4"><a href="building-complex-gadget-models.html#cb188-4"></a><span class="st">  </span><span class="kw">init_guess</span>(<span class="st">&#39;Linf&#39;</span>, <span class="dt">value =</span> <span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb188-5"><a href="building-complex-gadget-models.html#cb188-5"></a><span class="st">  </span><span class="kw">init_guess</span>(<span class="st">&#39;k$&#39;</span>, <span class="dt">value =</span> <span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb188-6"><a href="building-complex-gadget-models.html#cb188-6"></a><span class="st">  </span><span class="kw">write.gadget.parameters</span>(<span class="kw">paste</span>(gd, <span class="st">&#39;params.in&#39;</span>, <span class="dt">sep =</span> <span class="st">&#39;/&#39;</span>))</span>
<span id="cb188-7"><a href="building-complex-gadget-models.html#cb188-7"></a></span>
<span id="cb188-8"><a href="building-complex-gadget-models.html#cb188-8"></a></span>
<span id="cb188-9"><a href="building-complex-gadget-models.html#cb188-9"></a>fit &lt;-<span class="st"> </span><span class="kw">gadget.fit</span>(<span class="dt">wgts =</span> <span class="ot">NULL</span>, <span class="dt">params.file =</span> <span class="st">&#39;params.in&#39;</span>, <span class="dt">gd =</span> gd)</span></code></pre></div>
<pre><code>## [1] &quot;Reading input data&quot;
## [1] &quot;Running Gadget&quot;
## [1] &quot;Reading output files&quot;
## [1] &quot;Gathering results&quot;
## [1] &quot;Merging input and output&quot;</code></pre>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="building-complex-gadget-models.html#cb190-1"></a>fit<span class="op">$</span>stock.full <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb190-2"><a href="building-complex-gadget-models.html#cb190-2"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(length,number,<span class="dt">col=</span><span class="kw">as.factor</span>(year))) <span class="op">+</span><span class="st"> </span></span>
<span id="cb190-3"><a href="building-complex-gadget-models.html#cb190-3"></a><span class="st">  </span><span class="kw">geom_line</span>()</span></code></pre></div>
<p><img src="day2_lingmodel_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>We can also test a different value for <span class="math inline">\(\beta\)</span> in the beta binomial:</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="building-complex-gadget-models.html#cb191-1"></a><span class="co">## different value for the beta binomial</span></span>
<span id="cb191-2"><a href="building-complex-gadget-models.html#cb191-2"></a><span class="kw">read.gadget.parameters</span>(<span class="kw">paste</span>(gd, <span class="st">&#39;params.in&#39;</span>, <span class="dt">sep =</span> <span class="st">&#39;/&#39;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb191-3"><a href="building-complex-gadget-models.html#cb191-3"></a><span class="st">  </span><span class="kw">init_guess</span>(<span class="st">&#39;bbin&#39;</span>, <span class="dt">value =</span> <span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb191-4"><a href="building-complex-gadget-models.html#cb191-4"></a><span class="st">  </span><span class="kw">write.gadget.parameters</span>(<span class="kw">paste</span>(gd, <span class="st">&#39;params.in2&#39;</span>, <span class="dt">sep =</span> <span class="st">&#39;/&#39;</span>))</span>
<span id="cb191-5"><a href="building-complex-gadget-models.html#cb191-5"></a></span>
<span id="cb191-6"><a href="building-complex-gadget-models.html#cb191-6"></a>fit2 &lt;-<span class="st"> </span><span class="kw">gadget.fit</span>(<span class="dt">wgts =</span> <span class="ot">NULL</span>, <span class="dt">params.file =</span> <span class="st">&#39;params.in2&#39;</span>, <span class="dt">gd =</span> gd)</span></code></pre></div>
<pre><code>## [1] &quot;Reading input data&quot;
## [1] &quot;Running Gadget&quot;
## [1] &quot;Reading output files&quot;
## [1] &quot;Gathering results&quot;
## [1] &quot;Merging input and output&quot;</code></pre>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="building-complex-gadget-models.html#cb193-1"></a>fit<span class="op">$</span>stock.full <span class="op">%&gt;%</span></span>
<span id="cb193-2"><a href="building-complex-gadget-models.html#cb193-2"></a><span class="st">  </span><span class="kw">bind_rows</span>(fit2<span class="op">$</span>stock.full,<span class="dt">.id=</span><span class="st">&#39;model&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb193-3"><a href="building-complex-gadget-models.html#cb193-3"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(length,number,<span class="dt">col=</span><span class="kw">as.factor</span>(year),<span class="dt">lty =</span> <span class="kw">as.factor</span>(model))) <span class="op">+</span><span class="st"> </span></span>
<span id="cb193-4"><a href="building-complex-gadget-models.html#cb193-4"></a><span class="st">  </span><span class="kw">geom_line</span>()</span></code></pre></div>
<p><img src="day2_lingmodel_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<div id="exercise-5" class="section level4">
<h4><span class="header-section-number">6.1.1.1</span> Exercise</h4>
<ul>
<li>Investigate what are the effects of different growth rates (<span class="math inline">\(k\)</span>) and <span class="math inline">\(L_\infty\)</span> on the length distribution.</li>
</ul>
</div>
</div>
</div>
<div id="ling-stock-assessment-in-icelandic-waters" class="section level2">
<h2><span class="header-section-number">6.2</span> Ling stock assessment in Icelandic waters</h2>
<p>Gadget is particularly useful in a stock
assessment setting when age data are absent or sparse. In these cases,
parameterising age-based stock assessement models may require a lot of
pre-processing based on sparse age data to calculate the model input (e.g., catch
at age), which can produce bias. Using length- and age-based models instead
are appealing because comparisons sparse data can be directly incorporated into the
model likelihood, rather than pre-processed. This was the original main motivation
for developing the model presented here that is currently used for stock assessment.</p>
<p>In this example we present the stock assessment model used for ling <em>Molva molva</em>
in Icelandic fisheries as an example of a length- and age-based model with all the
standard components implemented, including natural mortality, fishing, growth,
maturation, and recruitment.</p>
</div>
<div id="model-initiation" class="section level2">
<h2><span class="header-section-number">6.3</span> Model initiation</h2>
<p>First we load Rgadget, set up directories, and some default model dimensions and names to use throughout.</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="building-complex-gadget-models.html#cb194-1"></a><span class="kw">library</span>(Rgadget)</span>
<span id="cb194-2"><a href="building-complex-gadget-models.html#cb194-2"></a></span>
<span id="cb194-3"><a href="building-complex-gadget-models.html#cb194-3"></a>base_dir &lt;-<span class="st"> &#39;ling_model&#39;</span></span>
<span id="cb194-4"><a href="building-complex-gadget-models.html#cb194-4"></a>vers &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;01-base&#39;</span>)</span>
<span id="cb194-5"><a href="building-complex-gadget-models.html#cb194-5"></a>gd &lt;-<span class="st"> </span><span class="kw">gadget.variant.dir</span>(<span class="kw">sprintf</span>(<span class="kw">paste0</span>(<span class="st">&quot;%s/&quot;</span>,vers),base_dir))</span>
<span id="cb194-6"><a href="building-complex-gadget-models.html#cb194-6"></a></span>
<span id="cb194-7"><a href="building-complex-gadget-models.html#cb194-7"></a>schedule &lt;-<span class="st"> </span></span>
<span id="cb194-8"><a href="building-complex-gadget-models.html#cb194-8"></a><span class="st">  </span><span class="kw">expand.grid</span>(<span class="dt">year =</span> <span class="dv">1982</span><span class="op">:</span><span class="dv">2018</span>, <span class="dt">step =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb194-9"><a href="building-complex-gadget-models.html#cb194-9"></a><span class="st">  </span><span class="kw">arrange</span>(year)</span>
<span id="cb194-10"><a href="building-complex-gadget-models.html#cb194-10"></a></span>
<span id="cb194-11"><a href="building-complex-gadget-models.html#cb194-11"></a><span class="kw">gadgetfile</span>(<span class="st">&#39;Modelfiles/time&#39;</span>,</span>
<span id="cb194-12"><a href="building-complex-gadget-models.html#cb194-12"></a>           <span class="dt">file_type =</span> <span class="st">&#39;time&#39;</span>,</span>
<span id="cb194-13"><a href="building-complex-gadget-models.html#cb194-13"></a>           <span class="dt">components =</span> <span class="kw">list</span>(<span class="kw">list</span>(<span class="dt">firstyear =</span> <span class="kw">min</span>(schedule<span class="op">$</span>year),</span>
<span id="cb194-14"><a href="building-complex-gadget-models.html#cb194-14"></a>                                  <span class="dt">firststep=</span><span class="kw">min</span>(schedule<span class="op">$</span>step),</span>
<span id="cb194-15"><a href="building-complex-gadget-models.html#cb194-15"></a>                                  <span class="dt">lastyear=</span><span class="kw">max</span>(schedule<span class="op">$</span>year),</span>
<span id="cb194-16"><a href="building-complex-gadget-models.html#cb194-16"></a>                                  <span class="dt">laststep=</span><span class="kw">max</span>(schedule<span class="op">$</span>step),</span>
<span id="cb194-17"><a href="building-complex-gadget-models.html#cb194-17"></a>                                  <span class="dt">notimesteps=</span><span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>)))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb194-18"><a href="building-complex-gadget-models.html#cb194-18"></a><span class="st">  </span><span class="kw">write.gadget.file</span>(gd)</span>
<span id="cb194-19"><a href="building-complex-gadget-models.html#cb194-19"></a></span>
<span id="cb194-20"><a href="building-complex-gadget-models.html#cb194-20"></a><span class="co">## Write out areafile and update mainfile with areafile location</span></span>
<span id="cb194-21"><a href="building-complex-gadget-models.html#cb194-21"></a><span class="kw">gadgetfile</span>(<span class="st">&#39;Modelfiles/area&#39;</span>,</span>
<span id="cb194-22"><a href="building-complex-gadget-models.html#cb194-22"></a>           <span class="dt">file_type =</span> <span class="st">&#39;area&#39;</span>,</span>
<span id="cb194-23"><a href="building-complex-gadget-models.html#cb194-23"></a>           <span class="dt">components =</span> <span class="kw">list</span>(<span class="kw">list</span>(<span class="dt">areas =</span> <span class="dv">1</span>,</span>
<span id="cb194-24"><a href="building-complex-gadget-models.html#cb194-24"></a>                                  <span class="dt">size =</span> <span class="dv">1</span>,</span>
<span id="cb194-25"><a href="building-complex-gadget-models.html#cb194-25"></a>                                  <span class="dt">temperature=</span> schedule <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">area =</span> <span class="dv">1</span>, <span class="dt">temperature =</span> <span class="dv">5</span>)))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb194-26"><a href="building-complex-gadget-models.html#cb194-26"></a><span class="st">  </span><span class="kw">write.gadget.file</span>(gd)</span></code></pre></div>
<div id="maturation-as-multi-stock-models" class="section level3">
<h3><span class="header-section-number">6.3.1</span> Maturation as multi-‘stock’ models</h3>
<div id="generating-stocks" class="section level4">
<h4><span class="header-section-number">6.3.1.1</span> Generating stocks</h4>
<p>In Gadget, maturation is modeled as a distributional shift between ‘stocks’, or more accurately
substocks, of a true biological stock. In the case of standard fish stocks,
this simply means that immature individuals are tracked within the immature ‘stock’ until
they ‘transition’ to mature stock component. This structure is convenient because the
generalized multi-‘stock’ implementation of
life stages can be applied to more biologically complex scenarios that have more than two life
stages, or biologically distinct components that need to be tracked separately (e.g., by sex),
but still contribute to the entire population.</p>
<p>For ling, we set up an immature and a mature stock file using the <code>gadgetstock</code> function,
then update the ‘stock’ component of the file using <code>gadget_update</code>. Each ‘stock’ requires
a separate stock file with all biological processes defined; therefore each stock can have
different processes described for each stock. For
example, note that the stocks are also structured a little bit differently: since we know
young mature and old immature ling don’t exist, we don’t bother tracking them in the model.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="building-complex-gadget-models.html#cb195-1"></a>mat_stock &lt;-<span class="st"> &#39;lingmat&#39;</span></span>
<span id="cb195-2"><a href="building-complex-gadget-models.html#cb195-2"></a>imm_stock &lt;-<span class="st"> &#39;lingimm&#39;</span></span>
<span id="cb195-3"><a href="building-complex-gadget-models.html#cb195-3"></a></span>
<span id="cb195-4"><a href="building-complex-gadget-models.html#cb195-4"></a><span class="co">## setup the immature stock first</span></span>
<span id="cb195-5"><a href="building-complex-gadget-models.html#cb195-5"></a>ling.imm &lt;-<span class="st"> </span></span>
<span id="cb195-6"><a href="building-complex-gadget-models.html#cb195-6"></a><span class="st">  </span><span class="kw">gadgetstock</span>(imm_stock,gd,<span class="dt">missingOkay =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb195-7"><a href="building-complex-gadget-models.html#cb195-7"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;stock&#39;</span>,</span>
<span id="cb195-8"><a href="building-complex-gadget-models.html#cb195-8"></a>                <span class="dt">minage =</span> <span class="dv">3</span>,</span>
<span id="cb195-9"><a href="building-complex-gadget-models.html#cb195-9"></a>                <span class="dt">maxage =</span> <span class="dv">10</span>,</span>
<span id="cb195-10"><a href="building-complex-gadget-models.html#cb195-10"></a>                <span class="dt">minlength =</span> <span class="dv">20</span>,</span>
<span id="cb195-11"><a href="building-complex-gadget-models.html#cb195-11"></a>                <span class="dt">maxlength =</span> <span class="dv">160</span>,</span>
<span id="cb195-12"><a href="building-complex-gadget-models.html#cb195-12"></a>                <span class="dt">dl =</span> <span class="dv">4</span>,</span>
<span id="cb195-13"><a href="building-complex-gadget-models.html#cb195-13"></a>                <span class="dt">livesonareas =</span> <span class="dv">1</span>)  </span>
<span id="cb195-14"><a href="building-complex-gadget-models.html#cb195-14"></a></span>
<span id="cb195-15"><a href="building-complex-gadget-models.html#cb195-15"></a>ling.mat &lt;-</span>
<span id="cb195-16"><a href="building-complex-gadget-models.html#cb195-16"></a><span class="st">  </span><span class="kw">gadgetstock</span>(mat_stock,gd,<span class="dt">missingOkay =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb195-17"><a href="building-complex-gadget-models.html#cb195-17"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;stock&#39;</span>,</span>
<span id="cb195-18"><a href="building-complex-gadget-models.html#cb195-18"></a>                <span class="dt">minage =</span> <span class="dv">5</span>,</span>
<span id="cb195-19"><a href="building-complex-gadget-models.html#cb195-19"></a>                <span class="dt">maxage =</span> <span class="dv">15</span>,</span>
<span id="cb195-20"><a href="building-complex-gadget-models.html#cb195-20"></a>                <span class="dt">minlength =</span> <span class="dv">20</span>,</span>
<span id="cb195-21"><a href="building-complex-gadget-models.html#cb195-21"></a>                <span class="dt">maxlength =</span> <span class="dv">160</span>,</span>
<span id="cb195-22"><a href="building-complex-gadget-models.html#cb195-22"></a>                <span class="dt">dl =</span> <span class="dv">4</span>,</span>
<span id="cb195-23"><a href="building-complex-gadget-models.html#cb195-23"></a>                <span class="dt">livesonareas =</span> <span class="dv">1</span>) </span></code></pre></div>
<p>As described above in the <strong>Growth</strong> section, default settings are provided by the
<code>gadgetstock</code> function. However, those settings give parameters that are named to be
stock-specific. To simplify the model a bit, we change the parameters to have the same
value in both stocks, so that both stocks are governed by the same growth equation:</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="building-complex-gadget-models.html#cb196-1"></a> ling.imm &lt;-</span>
<span id="cb196-2"><a href="building-complex-gadget-models.html#cb196-2"></a><span class="st">   </span>ling.imm <span class="op">%&gt;%</span></span>
<span id="cb196-3"><a href="building-complex-gadget-models.html#cb196-3"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;doesgrow&#39;</span>, </span>
<span id="cb196-4"><a href="building-complex-gadget-models.html#cb196-4"></a>                <span class="dt">growthparameters=</span><span class="kw">c</span>(<span class="dt">linf=</span><span class="st">&#39;#ling.Linf&#39;</span>, </span>
<span id="cb196-5"><a href="building-complex-gadget-models.html#cb196-5"></a>                                   <span class="dt">k=</span><span class="kw">to.gadget.formulae</span>(<span class="kw">quote</span>(<span class="fl">0.001</span><span class="op">*</span>ling.k)),</span>
<span id="cb196-6"><a href="building-complex-gadget-models.html#cb196-6"></a>                                   <span class="dt">alpha =</span> <span class="st">&#39;#ling.walpha&#39;</span>,</span>
<span id="cb196-7"><a href="building-complex-gadget-models.html#cb196-7"></a>                                   <span class="dt">beta =</span> <span class="st">&#39;#ling.wbeta&#39;</span>),</span>
<span id="cb196-8"><a href="building-complex-gadget-models.html#cb196-8"></a>                <span class="dt">beta =</span> <span class="kw">to.gadget.formulae</span>(<span class="kw">quote</span>(<span class="dv">10</span><span class="op">*</span>ling.bbin))) </span>
<span id="cb196-9"><a href="building-complex-gadget-models.html#cb196-9"></a></span>
<span id="cb196-10"><a href="building-complex-gadget-models.html#cb196-10"></a>  ling.mat &lt;-</span>
<span id="cb196-11"><a href="building-complex-gadget-models.html#cb196-11"></a><span class="st">   </span>ling.mat <span class="op">%&gt;%</span></span>
<span id="cb196-12"><a href="building-complex-gadget-models.html#cb196-12"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;doesgrow&#39;</span>, </span>
<span id="cb196-13"><a href="building-complex-gadget-models.html#cb196-13"></a>                <span class="dt">growthparameters=</span><span class="kw">c</span>(<span class="dt">linf=</span><span class="st">&#39;#ling.Linf&#39;</span>, </span>
<span id="cb196-14"><a href="building-complex-gadget-models.html#cb196-14"></a>                                   <span class="dt">k=</span><span class="kw">to.gadget.formulae</span>(<span class="kw">quote</span>(<span class="fl">0.001</span><span class="op">*</span>ling.k)),</span>
<span id="cb196-15"><a href="building-complex-gadget-models.html#cb196-15"></a>                                   <span class="dt">alpha =</span> <span class="st">&#39;#ling.walpha&#39;</span>,</span>
<span id="cb196-16"><a href="building-complex-gadget-models.html#cb196-16"></a>                                   <span class="dt">beta =</span> <span class="st">&#39;#ling.wbeta&#39;</span>),</span>
<span id="cb196-17"><a href="building-complex-gadget-models.html#cb196-17"></a>                <span class="dt">beta =</span> <span class="kw">to.gadget.formulae</span>(<span class="kw">quote</span>(<span class="dv">10</span><span class="op">*</span>ling.bbin))) </span></code></pre></div>
<p>An alternative way of implementing this would have been to keep the default parameter
names, but supply the same parameter value within the parameter file. Also notice
that although it is necessary to define the structural arguments listed above
(<code>minage</code>, <code>maxage</code>, <code>minlength</code>, <code>maxlength</code>, <code>dl</code> and <code>livesonareas</code>), updating the ‘stock’
component with gadget_update also sets up a few more convenient default settings in the
gadget stock file.</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="building-complex-gadget-models.html#cb197-1"></a><span class="kw">print</span>(<span class="st">&#39;Immature&#39;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Immature&quot;</code></pre>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="building-complex-gadget-models.html#cb199-1"></a>ling.imm</span></code></pre></div>
<pre><code>## ; Generated by Rgadget 0.5
## stockname    lingimm
## livesonareas 1
## minage   3
## maxage   10
## minlength    20
## maxlength    160
## dl   4
## refweightfile    
## growthandeatlengths  Aggfiles/lingimm.stock.len.agg
## doesgrow 1
## growthfunction   lengthvbsimple
## growthparameters #ling.Linf  (* 0.001 #ling.k)   #ling.walpha    #ling.wbeta
## beta (* 10 #ling.bbin)
## maxlengthgroupgrowth 15
## naturalmortality #lingimm.M  #lingimm.M  #lingimm.M  #lingimm.M  #lingimm.M  #lingimm.M  #lingimm.M  #lingimm.M
## iseaten  0
## doeseat  0
## initialconditions
## doesmigrate  0
## doesmature   0
## doesmove 0
## doesrenew    0
## doesspawn    0
## doesstray    0</code></pre>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="building-complex-gadget-models.html#cb201-1"></a><span class="kw">print</span>(<span class="st">&#39;Mature&#39;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Mature&quot;</code></pre>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="building-complex-gadget-models.html#cb203-1"></a>ling.mat</span></code></pre></div>
<pre><code>## ; Generated by Rgadget 0.5
## stockname    lingmat
## livesonareas 1
## minage   5
## maxage   15
## minlength    20
## maxlength    160
## dl   4
## refweightfile    
## growthandeatlengths  Aggfiles/lingmat.stock.len.agg
## doesgrow 1
## growthfunction   lengthvbsimple
## growthparameters #ling.Linf  (* 0.001 #ling.k)   #ling.walpha    #ling.wbeta
## beta (* 10 #ling.bbin)
## maxlengthgroupgrowth 15
## naturalmortality #lingmat.M  #lingmat.M  #lingmat.M  #lingmat.M  #lingmat.M  #lingmat.M  #lingmat.M  #lingmat.M  #lingmat.M  #lingmat.M  #lingmat.M
## iseaten  0
## doeseat  0
## initialconditions
## doesmigrate  0
## doesmature   0
## doesmove 0
## doesrenew    0
## doesspawn    0
## doesstray    0</code></pre>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="building-complex-gadget-models.html#cb205-1"></a><span class="co">## write to file</span></span>
<span id="cb205-2"><a href="building-complex-gadget-models.html#cb205-2"></a>ling.imm <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb205-3"><a href="building-complex-gadget-models.html#cb205-3"></a><span class="st">  </span><span class="kw">write.gadget.file</span>(gd)</span>
<span id="cb205-4"><a href="building-complex-gadget-models.html#cb205-4"></a></span>
<span id="cb205-5"><a href="building-complex-gadget-models.html#cb205-5"></a>ling.mat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb205-6"><a href="building-complex-gadget-models.html#cb205-6"></a><span class="st">  </span><span class="kw">write.gadget.file</span>(gd)</span></code></pre></div>
<p>In particular, <code>growthandeatlengths</code> has been supplied with a file path name
‘Aggfiles/lingmat.stock.len.agg’, which corresponds with a file that will be
automatically generated once the stock file is written [check it out in your folders].
This new aggregation file (or ‘Aggfile’) is required by Gadget, and contains information
on how to aggregate true lengths into length bins as individuals are tracked through the
model. Aggregation files also become important for the purposes of comparing
simulations to data, so they will be revisited later when model-fitting
procedures are introduced.</p>
<p>In addition, natural mortality parameters have been supplied as automatically
named switches (<code>lingimm.M</code> or <code>lingmat.M</code>) for every age. In the default case,
mortality is not age-dependent, so the same parameter is provided for every age.</p>
</div>
<div id="maturation-process-and-timing" class="section level4">
<h4><span class="header-section-number">6.3.1.2</span> Maturation process and timing</h4>
<p>To implement maturation, we only want the immature stock to be able to mature and
transition, or be moved (ie., to the mature stock). Therefore, <code>doesmove</code> and
<code>doesmature</code> components are both switched on (values set to 1) by supplying
additional information to them, whereas neither of
these are switched on for the mature stock.</p>
<p>Maturation is split into a two-step process in Gadget. For all ages included in the
immature stock, maturation is determined by a maturation function (set using the
<code>doesmature</code> component). For all ages older than the immature stock, maturation is
governed by a stepwise ‘transition’ (or lack of transition) to the mature stock (set
using the <code>doesmove</code> component).</p>
<p>For all ages within the immature stock, at what length individuals in the immature stock
become mature is governed by the maturation function in the <code>doesmature</code> component.
When choosing a maturity function, both the rate of maturation and timing of maturity should
be considered. For example, the maturity function used below (<code>continuous</code>) reflects a
maturation that occurs continuously through the year (not seasonal) at a rate with a
logistic dependence on length, age, or both. The first two parameters listed under
the <code>coefficients</code> correspond with length-dependency (alpha and L50, respectively), whereas
the last two correspond with age-dependency (beta and a50, respectively). Therefore,
for ling, we have only implemented length-dependency. Maturation in the <code>continuous</code>
functions occurs instantaneously (i.e., the maturation function is evaluated
and individuals are moved to the mature stock in every time step). When individuals
transition, they are placed into the same age-length bins of the destination
stock. If that bin does not exist in the destination stock, or transitioning is not defined
to occur, then the fish remain in the oldest age-length bins of the source stock, which act
as a plus group. The <a href="https://hafro.github.io/gadget/docs/userguide">Gadget User Guide</a> describes other possible
maturity functions, which implement for example a dependency on body condition,
seasonal maturation (in which maturation is only evaluated in a certain time step), and
length-dependent knife-edged (rather than logistic) maturation.</p>
<p>For all ages older than the immature stock, maturation is
governed by a stepwise ‘transition’ (or lack of transition) to the mature stock, set
using the <code>doesmove</code> component. In our example we turn on the <code>doesmove</code> component
to require that all fish in the oldest age of the immature stock should be moved to the
mature stock upon aging beyond the range of the immature stock. If this <code>doesmove</code> is not
turned on, then these individuals would instead remain in the immature stock as the
oldest age would be considered a plus group, and could lead to a large component of
old immature fish populating the model.</p>
<p>For both the <code>doesmove</code> and <code>doesmature</code> components, the proportion of
the originating stock transitioning to the
destination stock needs to be designated. This is because both components additionally
allow for maturation / transition into multiple stocks. It is therefore required that
the stock names and corresponding ratios are supplied that describe what proportion
of the immature should mature into each stock. Our example shows
all (ratio = 1) immature ling to be maturing into the mature stock (‘lingmat’) under the
argument <code>maturestocksandratios</code>, as well as transitioning to the same stock (under argument
<code>transitionstocksandratios</code>) in the fourth time step of every year when in the maximal age bin of the immature stock.</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="building-complex-gadget-models.html#cb206-1"></a>mat_stock &lt;-<span class="st"> &#39;lingmat&#39;</span></span>
<span id="cb206-2"><a href="building-complex-gadget-models.html#cb206-2"></a>imm_stock &lt;-<span class="st"> &#39;lingimm&#39;</span></span>
<span id="cb206-3"><a href="building-complex-gadget-models.html#cb206-3"></a></span>
<span id="cb206-4"><a href="building-complex-gadget-models.html#cb206-4"></a><span class="co">## setup the immature stock first</span></span>
<span id="cb206-5"><a href="building-complex-gadget-models.html#cb206-5"></a>ling.imm &lt;-<span class="st"> </span></span>
<span id="cb206-6"><a href="building-complex-gadget-models.html#cb206-6"></a><span class="st">  </span>ling.imm  <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb206-7"><a href="building-complex-gadget-models.html#cb206-7"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;doesmature&#39;</span>, </span>
<span id="cb206-8"><a href="building-complex-gadget-models.html#cb206-8"></a>                <span class="dt">maturityfunction =</span> <span class="st">&#39;continuous&#39;</span>,</span>
<span id="cb206-9"><a href="building-complex-gadget-models.html#cb206-9"></a>                <span class="dt">maturestocksandratios =</span> <span class="kw">list</span>(<span class="dt">stock=</span><span class="st">&#39;lingmat&#39;</span>, <span class="dt">ratio =</span> <span class="dv">1</span>),</span>
<span id="cb206-10"><a href="building-complex-gadget-models.html#cb206-10"></a>                <span class="dt">coefficients =</span> <span class="kw">list</span>(<span class="dt">alpha =</span> <span class="kw">to.gadget.formulae</span>(<span class="kw">quote</span>(<span class="fl">0.001</span><span class="op">*</span>ling.mat1)), </span>
<span id="cb206-11"><a href="building-complex-gadget-models.html#cb206-11"></a>                                    <span class="dt">l50=</span><span class="st">&#39;#ling.mat2&#39;</span>, <span class="dt">beta=</span><span class="dv">0</span>, <span class="dt">a50=</span><span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb206-12"><a href="building-complex-gadget-models.html#cb206-12"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;doesmove&#39;</span>,</span>
<span id="cb206-13"><a href="building-complex-gadget-models.html#cb206-13"></a>                <span class="dt">transitionstocksandratios =</span> <span class="st">&#39;lingmat 1&#39;</span>,</span>
<span id="cb206-14"><a href="building-complex-gadget-models.html#cb206-14"></a>                <span class="dt">transitionstep =</span> <span class="dv">4</span>)</span></code></pre></div>
<p>Note that although the <code>doesmove</code> component as described here is used for the maturation
process, it actually provides far more flexibility in designing Gadget models by providing
a mechanism for tracking stock components as the transition from one state to another.
For example, in another case it may be useful to track the transition from male to female
in a species that exhibits sequential hermaphroditism.</p>
</div>
</div>
<div id="initial-conditions" class="section level3">
<h3><span class="header-section-number">6.3.2</span> Initial conditions</h3>
<p>The model structures defined in the previous sections shows that numbers within each stock
will be tracked in simulations for both stocks at a certain age, within one of 35 length bins,
and on area 1.</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="building-complex-gadget-models.html#cb207-1"></a><span class="kw">print</span>(<span class="st">&#39;Immature&#39;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Immature&quot;</code></pre>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="building-complex-gadget-models.html#cb209-1"></a>ling.imm</span></code></pre></div>
<pre><code>## ; Generated by Rgadget 0.5
## stockname    lingimm
## livesonareas 1
## minage   3
## maxage   10
## minlength    20
## maxlength    160
## dl   4
## refweightfile    
## growthandeatlengths  Aggfiles/lingimm.stock.len.agg
## doesgrow 1
## growthfunction   lengthvbsimple
## growthparameters #ling.Linf  (* 0.001 #ling.k)   #ling.walpha    #ling.wbeta
## beta (* 10 #ling.bbin)
## maxlengthgroupgrowth 15
## naturalmortality #lingimm.M  #lingimm.M  #lingimm.M  #lingimm.M  #lingimm.M  #lingimm.M  #lingimm.M  #lingimm.M
## iseaten  0
## doeseat  0
## initialconditions
## doesmigrate  0
## doesmature   1
## maturityfunction continuous
## maturityfile Modelfiles/lingimm.maturity
## doesmove 1
## transitionstocksandratios    lingmat 1
## transitionstep   4
## doesrenew    0
## doesspawn    0
## doesstray    0</code></pre>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="building-complex-gadget-models.html#cb211-1"></a><span class="kw">print</span>(<span class="st">&#39;Mature&#39;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Mature&quot;</code></pre>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="building-complex-gadget-models.html#cb213-1"></a>ling.mat</span></code></pre></div>
<pre><code>## ; Generated by Rgadget 0.5
## stockname    lingmat
## livesonareas 1
## minage   5
## maxage   15
## minlength    20
## maxlength    160
## dl   4
## refweightfile    
## growthandeatlengths  Aggfiles/lingmat.stock.len.agg
## doesgrow 1
## growthfunction   lengthvbsimple
## growthparameters #ling.Linf  (* 0.001 #ling.k)   #ling.walpha    #ling.wbeta
## beta (* 10 #ling.bbin)
## maxlengthgroupgrowth 15
## naturalmortality #lingmat.M  #lingmat.M  #lingmat.M  #lingmat.M  #lingmat.M  #lingmat.M  #lingmat.M  #lingmat.M  #lingmat.M  #lingmat.M  #lingmat.M
## iseaten  0
## doeseat  0
## initialconditions
## doesmigrate  0
## doesmature   0
## doesmove 0
## doesrenew    0
## doesspawn    0
## doesstray    0</code></pre>
<p>As Gadget is set up as a forward simulation, initial conditions need to be supplied to each
bin defined by a stock’s structure. For example, the immature stock needs 11 age x 35 length x
1 area bins to contain initial numbers of individuals. Gadget is set up by default to put
10 000 fish in each age group per area. However, in reality, at any point in time, including
the initial time step of the model, the numbers at age of a real population are not expected
to be equal. In any population with mortality, for example, there should be fewer older individuals than
younger individuals. Similarly, differences between areas can shift all numbers at age to be
higher or lower than those found in another area. In addition, each set of 10 000 fish, which
correspond to an age and area, need to be assigned length bins according to a mean length, and
some level of variability around that mean.</p>
<p>These two attributes, numbers for each age x area group and distribution of those numbers
across length bins, are controlled by using <code>gadget_update</code> to modify the <code>initialconditions</code>
component of the stock file. In our ling example, this is done by supplying a data frame to an
argument called <code>normparam</code>. Calling the <code>normalparam</code> argument specifies the distribution of
lengths to be according to a normal parameteric distribution, and that body weights calculated
from these are according to an exponential equation of the same form as supplied in under the
section <strong>Growth</strong>. Alternatively, it is possible to implement weights according to condition
factor and length-weight key, or supply the numbers that make up the stock distribution rather
than a theoretical distribution. Implementation methods for these should be referred to in
the <a href="https://hafro.github.io/gadget/docs/userguide">Gadget User Guide</a>.</p>
<p>The data frame supplied to <code>normalparam</code> needs one row per age x area combination; therefore, the
first two columns in our example specify ages found in the stock (first columns), all with an area set to 1 (second column). [That is, using
the <code>.</code> placeholder passes the <code>ling.imm</code> object to that location, where <code>minage</code> and <code>maxage</code>
information is extracted]. The next two columns implement differences among ages and
differences among areas respectively, by supplying age - and area - specific factors against
which the 10 000 initial fish will be multiplied. These columns are called <code>age.factor</code> and
<code>area.factor</code>, respectively. The next two columns reflect the mean
length and standard deviation that will be used to distribute lengths for that age x area
combination. Note that although different lengths at age could in theory be supplied for
different areas, only one growth function is supplied for all areas, so justifying the utility
of different lengths at age among different areas for only the initial time step may be
difficult. Standard deviations of lengths are supplied by age age x area groups.</p>
<p>The data frame described above can be filled with constants, but as we saw <a href="https://hafro.github.io/gadget-course/getting-started-with-the-gadget-framework.html#gadget-variables">here</a>, we can
also replace these constants with parameter switches whose values can be controlled within the
parameter file, or even formulas containing constants, switches, or both. For example, both the
parameters used to describe the exponential length-weight relationship (alpha and beta, last
columns of the data frame) and standard deviations (third-from-last column) are set here to be empirically derived constants. However, in the code
below, we supply standard deviations as numerical values but alpha and beta as switches, as
the latter are also used in other components of the stock file (growth). Today we will use
this capability to set the initial conditions of the ling model to have two properties that aid
in realism and internal consistency. First, we would like numbers at age to be distributed
according to a total mortality experienced by the population at the beginning of the time
series. Second, we would like to set mean lengths of the age groups to be those expected by the
same Von Bertalanffy relationship implemented under the <strong>Growth</strong> section.</p>
<p>To implement the first pattern via the <code>age.factor</code> column, a different equation per age is supplied. Each equation is based on an age-specific initial number parameter (e.g.,
<code>lingimm.init.3</code> for age 3), which is then multiplied with the exponent of negative total
mortality rate times the number of annual time steps since recruitment (i.e., the age). This
ensures that the distribution in numbers among ages will be close to that expected simply
from natural mortality. In addition, the pre-supplied natural mortality parameter <code>lingimm.M</code>
is added to user-defined parameter <code>ling.init.F</code>, which represents an initial level of fishing
mortality experienced before the first time step of the model. Doing this slightly changes the
distribution to account for prior effects of fishing. Under this transformation, all
initial parameters (<code>lingimm.init.3</code>, <code>lingimm.init.4</code>, etc.) have the same interpretation:
they are the back-calculated recruitment values for the year classes to which the observed
ages correspond. Implementing the initial parameters with a consistent interpretation yields
the benefits of expecting their values to be on roughly the same scale and fosters easier
communication (e.g., fixing all age-specific parameters to the same value would denote fixed
recruitment during the years prior to the time series). So in mathematical terms the initial
number of fish at age a will:
<span class="math display">\[N_a = 10 000 \times q \nu_a e^{-a(M_a+F_0)}\]</span>
And is written as:</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="building-complex-gadget-models.html#cb215-1"></a><span class="kw">quote</span>(<span class="kw">exp</span>(<span class="op">-</span><span class="dv">1</span><span class="op">*</span>(lingimm.M<span class="op">+</span>ling.init.F)<span class="op">*</span><span class="dv">3</span>)<span class="op">*</span>lingimm.init<span class="fl">.3</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">to.gadget.formulae</span>()</span></code></pre></div>
<pre><code>## [1] &quot;(* (exp (* (* (- 1) (+ #lingimm.M #ling.init.F)) 3)) #lingimm.init.3)&quot;</code></pre>
<p>To implement the second pattern, in mean lengths-at-age provided, we can borrow an Rgadget
convenience function <code>von_b_formula</code> that writes out the <code>lengthvbsimple</code> equations in Gadget-friendly formulae.</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="building-complex-gadget-models.html#cb217-1"></a><span class="kw">von_b_formula</span>(<span class="dv">3</span>,<span class="dt">linf=</span><span class="st">&#39;ling.Linf&#39;</span>,<span class="dt">k=</span><span class="st">&#39;ling.k&#39;</span>,<span class="dt">recl=</span><span class="st">&#39;ling.recl&#39;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;(* #ling.Linf (- 1 (exp (* (* (- 1) (* 0.001 #ling.k)) (- 3 (+ 1 (/ (log (- 1 (/ #ling.recl #ling.Linf))) (* 0.001 #ling.k))))))))&quot;</code></pre>
<p>To be internally consistent, the parameters supplied to this convenience function, as well as
the <code>alpha</code> and <code>beta</code> columns defined in the <code>normalparam</code> data frame, are set to be the same as
those used when implementing growth in the <code>doesgrow</code> component above. Notice one more
parameter called <code>ling.recl</code> is also supplied for internal consistency with recruitment
settings, which are explained in the next section.</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="building-complex-gadget-models.html#cb219-1"></a><span class="co">#taken from data analyses</span></span>
<span id="cb219-2"><a href="building-complex-gadget-models.html#cb219-2"></a>init.sigma.i &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">2</span>, <span class="kw">length</span>(ling.imm[[<span class="dv">1</span>]]<span class="op">$</span>minage<span class="op">:</span>ling.imm[[<span class="dv">1</span>]]<span class="op">$</span>maxage))</span>
<span id="cb219-3"><a href="building-complex-gadget-models.html#cb219-3"></a>init.sigma.m &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">2</span>, <span class="kw">length</span>(ling.mat[[<span class="dv">1</span>]]<span class="op">$</span>minage<span class="op">:</span>ling.mat[[<span class="dv">1</span>]]<span class="op">$</span>maxage))</span>
<span id="cb219-4"><a href="building-complex-gadget-models.html#cb219-4"></a></span>
<span id="cb219-5"><a href="building-complex-gadget-models.html#cb219-5"></a></span>
<span id="cb219-6"><a href="building-complex-gadget-models.html#cb219-6"></a>ling.imm &lt;-</span>
<span id="cb219-7"><a href="building-complex-gadget-models.html#cb219-7"></a><span class="st">  </span>ling.imm <span class="op">%&gt;%</span></span>
<span id="cb219-8"><a href="building-complex-gadget-models.html#cb219-8"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;initialconditions&#39;</span>,</span>
<span id="cb219-9"><a href="building-complex-gadget-models.html#cb219-9"></a>                <span class="dt">normalparam =</span> <span class="kw">tibble</span>(<span class="dt">age =</span> .[[<span class="dv">1</span>]]<span class="op">$</span>minage<span class="op">:</span>.[[<span class="dv">1</span>]]<span class="op">$</span>maxage,</span>
<span id="cb219-10"><a href="building-complex-gadget-models.html#cb219-10"></a>                                         <span class="dt">area =</span> <span class="dv">1</span>,</span>
<span id="cb219-11"><a href="building-complex-gadget-models.html#cb219-11"></a>                                         <span class="dt">age.factor =</span> <span class="kw">parse</span>(<span class="dt">text=</span><span class="kw">sprintf</span>(<span class="st">&#39;exp(-1*(lingimm.M+ling.init.F)*%1$s)*lingimm.init.%1$s&#39;</span>,age)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb219-12"><a href="building-complex-gadget-models.html#cb219-12"></a><span class="st">                                           </span>purrr<span class="op">::</span><span class="kw">map</span>(to.gadget.formulae) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb219-13"><a href="building-complex-gadget-models.html#cb219-13"></a><span class="st">                                           </span><span class="kw">unlist</span>(),   </span>
<span id="cb219-14"><a href="building-complex-gadget-models.html#cb219-14"></a>                                         <span class="dt">area.factor =</span> <span class="st">&#39;#lingimm.init.scalar&#39;</span>,</span>
<span id="cb219-15"><a href="building-complex-gadget-models.html#cb219-15"></a>                                         <span class="dt">mean =</span> <span class="kw">von_b_formula</span>(age,<span class="dt">linf=</span><span class="st">&#39;ling.Linf&#39;</span>,<span class="dt">k=</span><span class="st">&#39;ling.k&#39;</span>,<span class="dt">recl=</span><span class="st">&#39;ling.recl&#39;</span>),</span>
<span id="cb219-16"><a href="building-complex-gadget-models.html#cb219-16"></a>                                         <span class="dt">stddev =</span> init.sigma.i,</span>
<span id="cb219-17"><a href="building-complex-gadget-models.html#cb219-17"></a>                                         <span class="dt">alpha =</span> <span class="st">&#39;#ling.walpha&#39;</span>,</span>
<span id="cb219-18"><a href="building-complex-gadget-models.html#cb219-18"></a>                                         <span class="dt">beta =</span> <span class="st">&#39;#ling.wbeta&#39;</span>)) </span>
<span id="cb219-19"><a href="building-complex-gadget-models.html#cb219-19"></a></span>
<span id="cb219-20"><a href="building-complex-gadget-models.html#cb219-20"></a>ling.mat &lt;-</span>
<span id="cb219-21"><a href="building-complex-gadget-models.html#cb219-21"></a><span class="st">  </span>ling.mat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb219-22"><a href="building-complex-gadget-models.html#cb219-22"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;initialconditions&#39;</span>,</span>
<span id="cb219-23"><a href="building-complex-gadget-models.html#cb219-23"></a>                <span class="dt">normalparam =</span> <span class="kw">tibble</span>(<span class="dt">age =</span> .[[<span class="dv">1</span>]]<span class="op">$</span>minage<span class="op">:</span>.[[<span class="dv">1</span>]]<span class="op">$</span>maxage,</span>
<span id="cb219-24"><a href="building-complex-gadget-models.html#cb219-24"></a>                                     <span class="dt">area =</span> <span class="dv">1</span>,</span>
<span id="cb219-25"><a href="building-complex-gadget-models.html#cb219-25"></a>                                     <span class="dt">age.factor =</span> <span class="kw">parse</span>(<span class="dt">text=</span><span class="kw">sprintf</span>(<span class="st">&#39;exp(-1*(lingmat.M+ling.init.F)*%1$s)*lingmat.init.%1$s&#39;</span>,age)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb219-26"><a href="building-complex-gadget-models.html#cb219-26"></a><span class="st">                                       </span>purrr<span class="op">::</span><span class="kw">map</span>(to.gadget.formulae) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb219-27"><a href="building-complex-gadget-models.html#cb219-27"></a><span class="st">                                       </span><span class="kw">unlist</span>(),</span>
<span id="cb219-28"><a href="building-complex-gadget-models.html#cb219-28"></a>                                     <span class="dt">area.factor =</span> <span class="st">&#39;#lingmat.init.scalar&#39;</span>,</span>
<span id="cb219-29"><a href="building-complex-gadget-models.html#cb219-29"></a>                                     <span class="dt">mean =</span> <span class="kw">von_b_formula</span>(age,<span class="dt">linf=</span><span class="st">&#39;ling.Linf&#39;</span>,<span class="dt">k=</span><span class="st">&#39;ling.k&#39;</span>,<span class="dt">recl=</span><span class="st">&#39;ling.recl&#39;</span>),</span>
<span id="cb219-30"><a href="building-complex-gadget-models.html#cb219-30"></a>                                     <span class="dt">stddev =</span> init.sigma.m,</span>
<span id="cb219-31"><a href="building-complex-gadget-models.html#cb219-31"></a>                                     <span class="dt">alpha =</span> <span class="st">&#39;#lingmat.walpha&#39;</span>,</span>
<span id="cb219-32"><a href="building-complex-gadget-models.html#cb219-32"></a>                                     <span class="dt">beta =</span> <span class="st">&#39;#lingmat.wbeta&#39;</span>))  </span>
<span id="cb219-33"><a href="building-complex-gadget-models.html#cb219-33"></a><span class="co">## write to file</span></span>
<span id="cb219-34"><a href="building-complex-gadget-models.html#cb219-34"></a>ling.imm <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb219-35"><a href="building-complex-gadget-models.html#cb219-35"></a><span class="st">  </span><span class="kw">write.gadget.file</span>(gd)</span>
<span id="cb219-36"><a href="building-complex-gadget-models.html#cb219-36"></a></span>
<span id="cb219-37"><a href="building-complex-gadget-models.html#cb219-37"></a>ling.mat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb219-38"><a href="building-complex-gadget-models.html#cb219-38"></a><span class="st">  </span><span class="kw">write.gadget.file</span>(gd)</span></code></pre></div>
<p>Note that the new files ‘Modelfiles/lingimm.init.normalparam’ and
‘Modelfiles/lingmat.init.normalparam’ are created to hold the information in the data
frames.</p>
</div>
<div id="renewal" class="section level3">
<h3><span class="header-section-number">6.3.3</span> Renewal</h3>
<p>Renewal can be thought of as another type of Initial Condition. In addition to
numbers-at-age and their length distributions being needed for all ages in the first time
step of the model, each year forward also needs individuals to populate the youngest age
of each stock. Mature stocks are populated by the immature stocks through maturation, but
the immature stocks requires inputted individuals from a recruitment process. Remember from
<a href="https://hafro.github.io/gadget-course/getting-started-with-the-gadget-framework.html#recruitment">here</a> that this can be accomplished either through renewal, in which a number is added to a
certain age at a certain time step in every year, or it can occur via a stock-recruitment
relationship (see <a href="https://hafro.github.io/gadget-course/getting-started-with-the-gadget-framework.html#recruitment">here</a>). For ling we keep it
simple and provide switches for each year’s number at the youngest age. That way,
these can either be inputted as values through a paramater file or they can be estimated at a
later stage.</p>
<p>To incorporate renewal, <code>gadget_update</code> is used to switch on the <code>doesrenew</code> argument to
have a value of 1 in the stock file, and a data frame very similar to the initial conditions
data frame is provided, except that it includes a year and step column to specify when the
recruitment occurs. An area and age combination also need to be provided as in initial conditions,
so that 10 000 fish can be supplied to this combination, and lengths distributed to these
10 000 fish in a similar manner as in initial conditions (i.e., via a parameteric
distribution or a numerical distribution). A factor is then supplied under the column
‘number’ that scales these 10 000 fish up or down relative to other year x time-step
combinations. Below, we have provided a knew parameter for each year (beginning with
<code>ling.rec</code>), each of which are multiplied by the scalar <code>ling.rec.scalar</code> which is
used to scale the whole time series of renewal values. Here, lengths are supplied via a normal parametric
distribution (as under initial conditions), so a column is also provided for <code>mean</code> and <code>stddev</code>
to designate the parametric distribution. Just as in initial conditions, the mean was set
using the same Von Bertalanffy equation and parameters, including the <code>ling.recl</code>, which
represents length at age 0. In the last columns, the same <code>ling.walpha</code> and <code>ling.wbeta</code>
parameters are provided for translation into biomass.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="building-complex-gadget-models.html#cb220-1"></a> ling.imm &lt;-</span>
<span id="cb220-2"><a href="building-complex-gadget-models.html#cb220-2"></a><span class="st">   </span>ling.imm <span class="op">%&gt;%</span></span>
<span id="cb220-3"><a href="building-complex-gadget-models.html#cb220-3"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;doesrenew&#39;</span>,</span>
<span id="cb220-4"><a href="building-complex-gadget-models.html#cb220-4"></a>                <span class="dt">normalparam =</span> <span class="kw">tibble</span>(<span class="dt">year =</span> schedule<span class="op">$</span>year,</span>
<span id="cb220-5"><a href="building-complex-gadget-models.html#cb220-5"></a>                                         <span class="dt">step =</span> <span class="dv">1</span>,</span>
<span id="cb220-6"><a href="building-complex-gadget-models.html#cb220-6"></a>                                         <span class="dt">area =</span> <span class="dv">1</span>,</span>
<span id="cb220-7"><a href="building-complex-gadget-models.html#cb220-7"></a>                                         <span class="dt">age =</span> .[[<span class="dv">1</span>]]<span class="op">$</span>minage,</span>
<span id="cb220-8"><a href="building-complex-gadget-models.html#cb220-8"></a>                                         <span class="dt">number =</span> <span class="kw">parse</span>(<span class="dt">text=</span><span class="kw">sprintf</span>(<span class="st">&#39;ling.rec.scalar*ling.rec.%s&#39;</span>,year)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb220-9"><a href="building-complex-gadget-models.html#cb220-9"></a><span class="st">                                           </span><span class="kw">map</span>(to.gadget.formulae) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb220-10"><a href="building-complex-gadget-models.html#cb220-10"></a><span class="st">                                           </span><span class="kw">unlist</span>(),</span>
<span id="cb220-11"><a href="building-complex-gadget-models.html#cb220-11"></a>                                         <span class="dt">mean =</span> <span class="kw">von_b_formula</span>(age,<span class="dt">linf=</span><span class="st">&#39;ling.Linf&#39;</span>,<span class="dt">k=</span><span class="st">&#39;ling.k&#39;</span>,<span class="dt">recl=</span><span class="st">&#39;ling.recl&#39;</span>),</span>
<span id="cb220-12"><a href="building-complex-gadget-models.html#cb220-12"></a>                                         <span class="dt">stddev =</span> <span class="st">&#39;#ling.rec.sd&#39;</span>,</span>
<span id="cb220-13"><a href="building-complex-gadget-models.html#cb220-13"></a>                                         <span class="dt">alpha =</span> <span class="st">&#39;#ling.walpha&#39;</span>,</span>
<span id="cb220-14"><a href="building-complex-gadget-models.html#cb220-14"></a>                                         <span class="dt">beta =</span> <span class="st">&#39;#ling.wbeta&#39;</span>)) </span>
<span id="cb220-15"><a href="building-complex-gadget-models.html#cb220-15"></a></span>
<span id="cb220-16"><a href="building-complex-gadget-models.html#cb220-16"></a><span class="co">## write to file</span></span>
<span id="cb220-17"><a href="building-complex-gadget-models.html#cb220-17"></a>ling.imm <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb220-18"><a href="building-complex-gadget-models.html#cb220-18"></a><span class="st">  </span><span class="kw">write.gadget.file</span>(gd)</span></code></pre></div>
<p>Note that the new file <code>Modelfiles/lingimm.rec.normalparam</code> is created to hold the
information in the data frame.</p>
</div>
<div id="reference-weight" class="section level3">
<h3><span class="header-section-number">6.3.4</span> Reference Weight</h3>
<p>Some implementations of the initial conditions and growth functions translate between
lengths and weights via a constant length-weight key. Although the functions provided in our
example here do not depend on it, we provide an example in the following code for how
<code>gadget_update</code> can be used to update the <code>refweight</code> component to provide the key as a data
frame, which is the same for both stocks.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="building-complex-gadget-models.html#cb221-1"></a><span class="co">#For internal consistency, these parameter values should be the</span></span>
<span id="cb221-2"><a href="building-complex-gadget-models.html#cb221-2"></a><span class="co">#same as those for ling.walpha &amp; ling.wbeta in the params file</span></span>
<span id="cb221-3"><a href="building-complex-gadget-models.html#cb221-3"></a>lw_pars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.00000228</span>, <span class="fl">3.20</span>) </span>
<span id="cb221-4"><a href="building-complex-gadget-models.html#cb221-4"></a></span>
<span id="cb221-5"><a href="building-complex-gadget-models.html#cb221-5"></a> ling.imm &lt;-</span>
<span id="cb221-6"><a href="building-complex-gadget-models.html#cb221-6"></a><span class="st">   </span>ling.imm <span class="op">%&gt;%</span></span>
<span id="cb221-7"><a href="building-complex-gadget-models.html#cb221-7"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;refweight&#39;</span>,</span>
<span id="cb221-8"><a href="building-complex-gadget-models.html#cb221-8"></a>                <span class="dt">data=</span><span class="kw">tibble</span>(<span class="dt">length=</span><span class="kw">seq</span>(.[[<span class="dv">1</span>]]<span class="op">$</span>minlength,.[[<span class="dv">1</span>]]<span class="op">$</span>maxlength,.[[<span class="dv">1</span>]]<span class="op">$</span>dl),</span>
<span id="cb221-9"><a href="building-complex-gadget-models.html#cb221-9"></a>                            <span class="dt">mean=</span>lw_pars[<span class="dv">1</span>]<span class="op">*</span>length<span class="op">^</span>lw_pars[<span class="dv">2</span>]))</span>
<span id="cb221-10"><a href="building-complex-gadget-models.html#cb221-10"></a>ling.mat &lt;-</span>
<span id="cb221-11"><a href="building-complex-gadget-models.html#cb221-11"></a><span class="st">  </span>ling.mat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb221-12"><a href="building-complex-gadget-models.html#cb221-12"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;refweight&#39;</span>,</span>
<span id="cb221-13"><a href="building-complex-gadget-models.html#cb221-13"></a>                <span class="dt">data=</span><span class="kw">tibble</span>(<span class="dt">length=</span><span class="kw">seq</span>(.[[<span class="dv">1</span>]]<span class="op">$</span>minlength,.[[<span class="dv">1</span>]]<span class="op">$</span>maxlength,.[[<span class="dv">1</span>]]<span class="op">$</span>dl),</span>
<span id="cb221-14"><a href="building-complex-gadget-models.html#cb221-14"></a>                            <span class="dt">mean=</span>lw_pars[<span class="dv">1</span>]<span class="op">*</span>length<span class="op">^</span>lw_pars[<span class="dv">2</span>]))</span>
<span id="cb221-15"><a href="building-complex-gadget-models.html#cb221-15"></a></span>
<span id="cb221-16"><a href="building-complex-gadget-models.html#cb221-16"></a></span>
<span id="cb221-17"><a href="building-complex-gadget-models.html#cb221-17"></a><span class="co">## write to file</span></span>
<span id="cb221-18"><a href="building-complex-gadget-models.html#cb221-18"></a>ling.imm <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb221-19"><a href="building-complex-gadget-models.html#cb221-19"></a><span class="st">  </span><span class="kw">write.gadget.file</span>(gd)</span>
<span id="cb221-20"><a href="building-complex-gadget-models.html#cb221-20"></a></span>
<span id="cb221-21"><a href="building-complex-gadget-models.html#cb221-21"></a>ling.mat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb221-22"><a href="building-complex-gadget-models.html#cb221-22"></a><span class="st">  </span><span class="kw">write.gadget.file</span>(gd)</span></code></pre></div>
<p>Note that the new files <code>Modelfiles/lingimm.refwgt</code> and <code>Modelfiles/lingmat.refwgt</code>
are created to hold the information in the data frames.</p>
</div>
<div id="is-fished-eaten" class="section level3">
<h3><span class="header-section-number">6.3.5</span> Is fished / eaten</h3>
<p>Finally, it is important to designate the component <code>iseaten</code> to have
a value of 1, if the stock is to be consumed by other species or
fished by fleets. In Gadget, fishing is considered to be one of many forms of
consumption.</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="building-complex-gadget-models.html#cb222-1"></a> ling.imm &lt;-</span>
<span id="cb222-2"><a href="building-complex-gadget-models.html#cb222-2"></a><span class="st">   </span>ling.imm <span class="op">%&gt;%</span></span>
<span id="cb222-3"><a href="building-complex-gadget-models.html#cb222-3"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;iseaten&#39;</span>,<span class="dv">1</span>)</span>
<span id="cb222-4"><a href="building-complex-gadget-models.html#cb222-4"></a></span>
<span id="cb222-5"><a href="building-complex-gadget-models.html#cb222-5"></a>ling.mat &lt;-</span>
<span id="cb222-6"><a href="building-complex-gadget-models.html#cb222-6"></a><span class="st">  </span>ling.mat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb222-7"><a href="building-complex-gadget-models.html#cb222-7"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;iseaten&#39;</span>,<span class="dv">1</span>) </span>
<span id="cb222-8"><a href="building-complex-gadget-models.html#cb222-8"></a></span>
<span id="cb222-9"><a href="building-complex-gadget-models.html#cb222-9"></a><span class="co">## write to file</span></span>
<span id="cb222-10"><a href="building-complex-gadget-models.html#cb222-10"></a>ling.imm <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb222-11"><a href="building-complex-gadget-models.html#cb222-11"></a><span class="st">  </span><span class="kw">write.gadget.file</span>(gd)</span>
<span id="cb222-12"><a href="building-complex-gadget-models.html#cb222-12"></a></span>
<span id="cb222-13"><a href="building-complex-gadget-models.html#cb222-13"></a>ling.mat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb222-14"><a href="building-complex-gadget-models.html#cb222-14"></a><span class="st">  </span><span class="kw">write.gadget.file</span>(gd)</span></code></pre></div>
</div>
<div id="set-up-fleets-using-catch-or-effort-data" class="section level3">
<h3><span class="header-section-number">6.3.6</span> Set up fleets using catch or effort data</h3>
<p>If fleets will be set up using data, catch or effort data must be first organized in the same
structure as the model (units kg for catch). Here we continue with <code>totalfleet</code> examples that
requires catch data for four fishing fleets: “foreign”, “longline”, “bottom trawl”, and “gillnet”
fleets. [Foreign vessels are assumed to use long lines, but are kept separate because the have no
biological data from fishery samples - more on this later]. Fleets are separated by gear so
that a different selectivity curve can be implemented for each fleet (but foreign is assumed
to have the same selectivity as the longline fleet). The survey is also
treated as a fleet here so that it too can have a different selectivity curve implemented.
However, note that because we don’t want the survey to actually have any fishing impact on
the population, but we still want to use biological ‘fishery data’ resulting from the
survey’s catches, we ‘trick’ Gadget by only allowing it to have a 1 kg catch within each
step / year combination. Gadget will give an error if there exists no catch in the time steps and areas when/where biological fishery data originate.</p>
<p>Also notice that the attribute <code>area_group</code> needs to be applied to the data frame using the
function <code>structure</code>. These attributes are called on by Rgadget when creating the
appropriate aggregation files. The following will use files that can be downloaded <a href="https://heima.hafro.is/~bthe/data_provided.zip">here</a></p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="building-complex-gadget-models.html#cb223-1"></a><span class="co">## </span></span>
<span id="cb223-2"><a href="building-complex-gadget-models.html#cb223-2"></a><span class="kw">download.file</span>(<span class="st">&#39;https://heima.hafro.is/~bthe/data_provided.zip&#39;</span>, <span class="dt">destfile =</span> <span class="st">&quot;data_provided.zip&quot;</span>)</span>
<span id="cb223-3"><a href="building-complex-gadget-models.html#cb223-3"></a><span class="kw">unzip</span>(<span class="st">&#39;data_provided.zip&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="building-complex-gadget-models.html#cb224-1"></a>lln.landings &lt;-<span class="st"> </span><span class="kw">structure</span>(<span class="kw">read_csv</span>(<span class="st">&#39;data_provided/lln.csv&#39;</span>),</span>
<span id="cb224-2"><a href="building-complex-gadget-models.html#cb224-2"></a>            <span class="dt">area_group =</span> <span class="kw">list</span>(<span class="st">`</span><span class="dt">1</span><span class="st">`</span> =<span class="st"> </span><span class="dv">1</span>))</span>
<span id="cb224-3"><a href="building-complex-gadget-models.html#cb224-3"></a>bmt.landings &lt;-<span class="st"> </span><span class="kw">structure</span>(<span class="kw">read_csv</span>(<span class="st">&#39;data_provided/bmt.csv&#39;</span>),</span>
<span id="cb224-4"><a href="building-complex-gadget-models.html#cb224-4"></a>            <span class="dt">area_group =</span> <span class="kw">list</span>(<span class="st">`</span><span class="dt">1</span><span class="st">`</span> =<span class="st"> </span><span class="dv">1</span>))</span>
<span id="cb224-5"><a href="building-complex-gadget-models.html#cb224-5"></a>gil.landings &lt;-<span class="st"> </span><span class="kw">structure</span>(<span class="kw">read_csv</span>(<span class="st">&#39;data_provided/gil.csv&#39;</span>),</span>
<span id="cb224-6"><a href="building-complex-gadget-models.html#cb224-6"></a>            <span class="dt">area_group =</span> <span class="kw">list</span>(<span class="st">`</span><span class="dt">1</span><span class="st">`</span> =<span class="st"> </span><span class="dv">1</span>))</span>
<span id="cb224-7"><a href="building-complex-gadget-models.html#cb224-7"></a>for.landings &lt;-<span class="st"> </span><span class="kw">structure</span>(<span class="kw">read_csv</span>(<span class="st">&#39;data_provided/for.csv&#39;</span>),</span>
<span id="cb224-8"><a href="building-complex-gadget-models.html#cb224-8"></a>            <span class="dt">area_group =</span> <span class="kw">list</span>(<span class="st">`</span><span class="dt">1</span><span class="st">`</span> =<span class="st"> </span><span class="dv">1</span>))</span>
<span id="cb224-9"><a href="building-complex-gadget-models.html#cb224-9"></a>surv.landings &lt;-<span class="st"> </span><span class="kw">structure</span>(<span class="kw">read_csv</span>(<span class="st">&#39;data_provided/surv.csv&#39;</span>),</span>
<span id="cb224-10"><a href="building-complex-gadget-models.html#cb224-10"></a>            <span class="dt">area_group =</span> <span class="kw">list</span>(<span class="st">`</span><span class="dt">1</span><span class="st">`</span> =<span class="st"> </span><span class="dv">1</span>))</span>
<span id="cb224-11"><a href="building-complex-gadget-models.html#cb224-11"></a></span>
<span id="cb224-12"><a href="building-complex-gadget-models.html#cb224-12"></a>lln.landings</span></code></pre></div>
<pre><code>## [90m# A tibble: 100 x 4[39m
##     year  step  area total_weight
##  [90m*[39m [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;dbl&gt;[39m[23m        [3m[90m&lt;dbl&gt;[39m[23m
## [90m 1[39m  [4m1[24m994     1     1       [4m2[24m[4m3[24m[4m2[24m073
## [90m 2[39m  [4m1[24m994     2     1        [4m6[24m[4m3[24m300
## [90m 3[39m  [4m1[24m994     3     1       [4m2[24m[4m3[24m[4m0[24m816
## [90m 4[39m  [4m1[24m994     4     1       [4m4[24m[4m6[24m[4m5[24m965
## [90m 5[39m  [4m1[24m995     1     1       [4m3[24m[4m5[24m[4m1[24m216
## [90m 6[39m  [4m1[24m995     2     1       [4m1[24m[4m5[24m[4m8[24m494
## [90m 7[39m  [4m1[24m995     3     1       [4m1[24m[4m9[24m[4m2[24m527
## [90m 8[39m  [4m1[24m995     4     1       [4m6[24m[4m1[24m[4m7[24m108
## [90m 9[39m  [4m1[24m996     1     1       [4m5[24m[4m1[24m[4m6[24m931
## [90m10[39m  [4m1[24m996     2     1       [4m2[24m[4m8[24m[4m5[24m695
## [90m# … with 90 more rows[39m</code></pre>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="building-complex-gadget-models.html#cb226-1"></a>surv.landings</span></code></pre></div>
<pre><code>## [90m# A tibble: 37 x 4[39m
##     year  step  area number
##  [90m*[39m [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;dbl&gt;[39m[23m  [3m[90m&lt;dbl&gt;[39m[23m
## [90m 1[39m  [4m1[24m982     2     1      1
## [90m 2[39m  [4m1[24m983     2     1      1
## [90m 3[39m  [4m1[24m984     2     1      1
## [90m 4[39m  [4m1[24m985     2     1      1
## [90m 5[39m  [4m1[24m986     2     1      1
## [90m 6[39m  [4m1[24m987     2     1      1
## [90m 7[39m  [4m1[24m988     2     1      1
## [90m 8[39m  [4m1[24m989     2     1      1
## [90m 9[39m  [4m1[24m990     2     1      1
## [90m10[39m  [4m1[24m991     2     1      1
## [90m# … with 27 more rows[39m</code></pre>
<p>After obtaining the data, it is time to create the fleet files using <code>gadgetfleet</code> and
<code>gadget_update</code> as we have seen before. There are a variety of fleet types that can be
implemented in Gadget depending on the purpose and data available. Below we designate
the fleet as a <code>totalfleet</code> because the data available are landings by biomass at time.
It is an ‘ouput’ implementation, as is another option called <code>numberfleet</code>, which
requires landings numbers (not biomass) at time. Possible ‘input’ options are
<code>linearfleet</code> or <code>effortfleet</code> which are implementations that control effort. The
last option <code>quotafleet</code> is more dynamic because it sets the kg taken by each fleet
through a simple harvest control rule based on the previous year’s biomass level, then
splits it among the fleet.</p>
<p>Setting up a fleet using <code>gadget_update</code> requires setting the fleet type (below to
<code>totalfleet</code>), giving the fleet a name (below <code>surv</code>, <code>lln</code>, <code>bmt</code>, <code>gil</code>, and <code>foreign</code>),
designating a <code>suitability</code> function, and supplying the catch data described above.</p>
<p>In Gadget, the fleets act as a simple predator in the model, with consumption controlled
by input or output data to the fleet (i.e., effort or landings), depending on the type
of fleet chosen. Therefore, ‘suitability’ is the term Gadget uses to encompass patterns
of selectivity patterns related to both fleet and predator consumption. However, fleet files
are set up differently than predator files (designated as another ‘stock’) because of common
differences in data and a lack of variation in predator ‘size’ when it comes to fishing fleets.</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="building-complex-gadget-models.html#cb228-1"></a><span class="kw">gadgetfleet</span>(<span class="st">&#39;Modelfiles/fleet&#39;</span>,gd,<span class="dt">missingOkay =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb228-2"><a href="building-complex-gadget-models.html#cb228-2"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;totalfleet&#39;</span>,</span>
<span id="cb228-3"><a href="building-complex-gadget-models.html#cb228-3"></a>                <span class="dt">name =</span> <span class="st">&#39;surv&#39;</span>,</span>
<span id="cb228-4"><a href="building-complex-gadget-models.html#cb228-4"></a>                <span class="dt">suitability =</span> </span>
<span id="cb228-5"><a href="building-complex-gadget-models.html#cb228-5"></a>                  <span class="kw">list</span>(<span class="dt">lingimm =</span> <span class="kw">list</span>(<span class="dt">type=</span><span class="st">&#39;function&#39;</span>,<span class="dt">suit_func=</span><span class="st">&#39;exponentiall50&#39;</span>,</span>
<span id="cb228-6"><a href="building-complex-gadget-models.html#cb228-6"></a>                                      <span class="dt">alpha =</span> <span class="st">&#39;#ling.surv.alpha&#39;</span>,</span>
<span id="cb228-7"><a href="building-complex-gadget-models.html#cb228-7"></a>                                      <span class="dt">beta =</span> <span class="st">&#39;#ling.surv.l50&#39;</span>),</span>
<span id="cb228-8"><a href="building-complex-gadget-models.html#cb228-8"></a>                       <span class="dt">lingmat =</span> <span class="kw">list</span>(<span class="dt">type=</span><span class="st">&#39;function&#39;</span>,<span class="dt">suit_func=</span><span class="st">&#39;exponentiall50&#39;</span>,</span>
<span id="cb228-9"><a href="building-complex-gadget-models.html#cb228-9"></a>                                      <span class="dt">alpha =</span> <span class="st">&#39;#ling.surv.alpha&#39;</span>,</span>
<span id="cb228-10"><a href="building-complex-gadget-models.html#cb228-10"></a>                                      <span class="dt">beta =</span> <span class="st">&#39;#ling.surv.l50&#39;</span>)),</span>
<span id="cb228-11"><a href="building-complex-gadget-models.html#cb228-11"></a>                <span class="dt">data =</span> surv.landings) <span class="op">%&gt;%</span></span>
<span id="cb228-12"><a href="building-complex-gadget-models.html#cb228-12"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;totalfleet&#39;</span>,</span>
<span id="cb228-13"><a href="building-complex-gadget-models.html#cb228-13"></a>                <span class="dt">name =</span> <span class="st">&#39;lln&#39;</span>,</span>
<span id="cb228-14"><a href="building-complex-gadget-models.html#cb228-14"></a>                <span class="dt">suitability =</span> </span>
<span id="cb228-15"><a href="building-complex-gadget-models.html#cb228-15"></a>                  <span class="kw">list</span>(<span class="dt">lingimm =</span> <span class="kw">list</span>(<span class="dt">type=</span><span class="st">&#39;function&#39;</span>,<span class="dt">suit_func=</span><span class="st">&#39;exponentiall50&#39;</span>,</span>
<span id="cb228-16"><a href="building-complex-gadget-models.html#cb228-16"></a>                                      <span class="dt">alpha =</span> <span class="st">&#39;#ling.lln.alpha&#39;</span>,</span>
<span id="cb228-17"><a href="building-complex-gadget-models.html#cb228-17"></a>                                      <span class="dt">beta =</span> <span class="st">&#39;#ling.lln.l50&#39;</span>),</span>
<span id="cb228-18"><a href="building-complex-gadget-models.html#cb228-18"></a>                       <span class="dt">lingmat =</span> <span class="kw">list</span>(<span class="dt">type=</span><span class="st">&#39;function&#39;</span>,<span class="dt">suit_func=</span><span class="st">&#39;exponentiall50&#39;</span>,</span>
<span id="cb228-19"><a href="building-complex-gadget-models.html#cb228-19"></a>                                      <span class="dt">alpha =</span> <span class="st">&#39;#ling.lln.alpha&#39;</span>,</span>
<span id="cb228-20"><a href="building-complex-gadget-models.html#cb228-20"></a>                                      <span class="dt">beta =</span> <span class="st">&#39;#ling.lln.l50&#39;</span>)),</span>
<span id="cb228-21"><a href="building-complex-gadget-models.html#cb228-21"></a>                <span class="dt">data =</span> lln.landings) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb228-22"><a href="building-complex-gadget-models.html#cb228-22"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;totalfleet&#39;</span>,</span>
<span id="cb228-23"><a href="building-complex-gadget-models.html#cb228-23"></a>                <span class="dt">name =</span> <span class="st">&#39;bmt&#39;</span>,</span>
<span id="cb228-24"><a href="building-complex-gadget-models.html#cb228-24"></a>                <span class="dt">suitability =</span> </span>
<span id="cb228-25"><a href="building-complex-gadget-models.html#cb228-25"></a>                  <span class="kw">list</span>(<span class="dt">lingimm =</span> <span class="kw">list</span>(<span class="dt">type=</span><span class="st">&#39;function&#39;</span>,<span class="dt">suit_func=</span><span class="st">&#39;exponentiall50&#39;</span>,</span>
<span id="cb228-26"><a href="building-complex-gadget-models.html#cb228-26"></a>                                      <span class="dt">alpha =</span> <span class="st">&#39;#ling.bmt.alpha&#39;</span>,</span>
<span id="cb228-27"><a href="building-complex-gadget-models.html#cb228-27"></a>                                      <span class="dt">beta =</span> <span class="st">&#39;#ling.bmt.l50&#39;</span>),</span>
<span id="cb228-28"><a href="building-complex-gadget-models.html#cb228-28"></a>                       <span class="dt">lingmat =</span> <span class="kw">list</span>(<span class="dt">type=</span><span class="st">&#39;function&#39;</span>,<span class="dt">suit_func=</span><span class="st">&#39;exponentiall50&#39;</span>,</span>
<span id="cb228-29"><a href="building-complex-gadget-models.html#cb228-29"></a>                                      <span class="dt">alpha =</span> <span class="st">&#39;#ling.bmt.alpha&#39;</span>,</span>
<span id="cb228-30"><a href="building-complex-gadget-models.html#cb228-30"></a>                                      <span class="dt">beta =</span> <span class="st">&#39;#ling.bmt.l50&#39;</span>)),</span>
<span id="cb228-31"><a href="building-complex-gadget-models.html#cb228-31"></a>                <span class="dt">data =</span> bmt.landings) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb228-32"><a href="building-complex-gadget-models.html#cb228-32"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;totalfleet&#39;</span>,</span>
<span id="cb228-33"><a href="building-complex-gadget-models.html#cb228-33"></a>                <span class="dt">name =</span> <span class="st">&#39;gil&#39;</span>,</span>
<span id="cb228-34"><a href="building-complex-gadget-models.html#cb228-34"></a>                <span class="dt">suitability =</span> </span>
<span id="cb228-35"><a href="building-complex-gadget-models.html#cb228-35"></a>                  <span class="kw">list</span>(<span class="dt">lingimm =</span> <span class="kw">list</span>(<span class="dt">type=</span><span class="st">&#39;function&#39;</span>,<span class="dt">suit_func=</span><span class="st">&#39;exponentiall50&#39;</span>,</span>
<span id="cb228-36"><a href="building-complex-gadget-models.html#cb228-36"></a>                                      <span class="dt">alpha =</span> <span class="st">&#39;#ling.gil.alpha&#39;</span>,</span>
<span id="cb228-37"><a href="building-complex-gadget-models.html#cb228-37"></a>                                      <span class="dt">beta =</span> <span class="st">&#39;#ling.gil.l50&#39;</span>),</span>
<span id="cb228-38"><a href="building-complex-gadget-models.html#cb228-38"></a>                       <span class="dt">lingmat =</span> <span class="kw">list</span>(<span class="dt">type=</span><span class="st">&#39;function&#39;</span>,<span class="dt">suit_func=</span><span class="st">&#39;exponentiall50&#39;</span>,</span>
<span id="cb228-39"><a href="building-complex-gadget-models.html#cb228-39"></a>                                      <span class="dt">alpha =</span> <span class="st">&#39;#ling.gil.alpha&#39;</span>,</span>
<span id="cb228-40"><a href="building-complex-gadget-models.html#cb228-40"></a>                                      <span class="dt">beta =</span> <span class="st">&#39;#ling.gil.l50&#39;</span>)),</span>
<span id="cb228-41"><a href="building-complex-gadget-models.html#cb228-41"></a>                <span class="dt">data =</span> gil.landings) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb228-42"><a href="building-complex-gadget-models.html#cb228-42"></a><span class="st">  </span><span class="kw">gadget_update</span>(<span class="st">&#39;totalfleet&#39;</span>,</span>
<span id="cb228-43"><a href="building-complex-gadget-models.html#cb228-43"></a>                <span class="dt">name =</span> <span class="st">&#39;foreign&#39;</span>,</span>
<span id="cb228-44"><a href="building-complex-gadget-models.html#cb228-44"></a>                <span class="dt">suitability =</span> </span>
<span id="cb228-45"><a href="building-complex-gadget-models.html#cb228-45"></a>                   <span class="kw">list</span>(<span class="dt">lingimm =</span> <span class="kw">list</span>(<span class="dt">type=</span><span class="st">&#39;function&#39;</span>,<span class="dt">suit_func=</span><span class="st">&#39;exponentiall50&#39;</span>,</span>
<span id="cb228-46"><a href="building-complex-gadget-models.html#cb228-46"></a>                                       <span class="dt">alpha =</span> <span class="st">&#39;#ling.lln.alpha&#39;</span>,</span>
<span id="cb228-47"><a href="building-complex-gadget-models.html#cb228-47"></a>                                       <span class="dt">beta =</span> <span class="st">&#39;#ling.lln.l50&#39;</span>),</span>
<span id="cb228-48"><a href="building-complex-gadget-models.html#cb228-48"></a>                        <span class="dt">lingmat =</span> <span class="kw">list</span>(<span class="dt">type=</span><span class="st">&#39;function&#39;</span>,<span class="dt">suit_func=</span><span class="st">&#39;exponentiall50&#39;</span>,</span>
<span id="cb228-49"><a href="building-complex-gadget-models.html#cb228-49"></a>                                       <span class="dt">alpha =</span> <span class="st">&#39;#ling.lln.alpha&#39;</span>,</span>
<span id="cb228-50"><a href="building-complex-gadget-models.html#cb228-50"></a>                                       <span class="dt">beta =</span> <span class="st">&#39;#ling.lln.l50&#39;</span>)),</span>
<span id="cb228-51"><a href="building-complex-gadget-models.html#cb228-51"></a>                <span class="co">#   list(lingimm = list(type=&#39;function&#39;,suit_func=&#39;andersenfleet&#39;,</span></span>
<span id="cb228-52"><a href="building-complex-gadget-models.html#cb228-52"></a>                <span class="co">#                       p0 = &#39;#ling.lln.p0&#39;,</span></span>
<span id="cb228-53"><a href="building-complex-gadget-models.html#cb228-53"></a>                <span class="co">#                       p1 = to.gadget.formulae(quote(log(180/ling.lln.lmode))),</span></span>
<span id="cb228-54"><a href="building-complex-gadget-models.html#cb228-54"></a>                <span class="co">#                       p2 = &#39;#ling.lln.p2&#39;,</span></span>
<span id="cb228-55"><a href="building-complex-gadget-models.html#cb228-55"></a>                <span class="co">#                       p3 = &#39;#ling.lln.p3&#39;,</span></span>
<span id="cb228-56"><a href="building-complex-gadget-models.html#cb228-56"></a>                <span class="co">#                       p4 = &#39;#ling.lln.p4&#39;,</span></span>
<span id="cb228-57"><a href="building-complex-gadget-models.html#cb228-57"></a>                <span class="co">#                       L = &#39;180&#39;),</span></span>
<span id="cb228-58"><a href="building-complex-gadget-models.html#cb228-58"></a>                <span class="co">#       lingmat =  list(type=&#39;function&#39;,suit_func=&#39;andersenfleet&#39;,</span></span>
<span id="cb228-59"><a href="building-complex-gadget-models.html#cb228-59"></a>                <span class="co">#                       p0 = &#39;#ling.lln.p0&#39;,</span></span>
<span id="cb228-60"><a href="building-complex-gadget-models.html#cb228-60"></a>                <span class="co">#                       p1 = to.gadget.formulae(quote(log(180/ling.lln.lmode))),</span></span>
<span id="cb228-61"><a href="building-complex-gadget-models.html#cb228-61"></a>                <span class="co">#                       p2 = &#39;#ling.lln.p2&#39;,</span></span>
<span id="cb228-62"><a href="building-complex-gadget-models.html#cb228-62"></a>                <span class="co">#                       p3 = &#39;#ling.lln.p3&#39;,</span></span>
<span id="cb228-63"><a href="building-complex-gadget-models.html#cb228-63"></a>                <span class="co">#                       p4 = &#39;#ling.lln.p4&#39;,</span></span>
<span id="cb228-64"><a href="building-complex-gadget-models.html#cb228-64"></a>                <span class="co">#                       L = &#39;180&#39;)),</span></span>
<span id="cb228-65"><a href="building-complex-gadget-models.html#cb228-65"></a>                 <span class="dt">data =</span> for.landings) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb228-66"><a href="building-complex-gadget-models.html#cb228-66"></a><span class="st">  </span><span class="kw">write.gadget.file</span>(gd)</span></code></pre></div>
<div id="exercise-6" class="section level4">
<h4><span class="header-section-number">6.3.6.1</span> Exercise</h4>
<ul>
<li>Try changing the longline and foreign fleet to the <code>andersenfleet</code> function (see commented
out code under the foreign fleet, as well as day 1 material). Use the Rgadget helper function
to explore it. Under what conditions could this function be useful? [Hint: also look up the
description in the <a href="https://hafro.github.io/gadget/docs/userguide">Gadget User Guide</a>]</li>
</ul>
</div>
</div>
</div>
<div id="run-the-simulation-using-pre-determined-parameters" class="section level2">
<h2><span class="header-section-number">6.4</span> Run the simulation using pre-determined parameters</h2>
<p>Now we run Gadget on the ling model just as in the simple model example.</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="building-complex-gadget-models.html#cb229-1"></a><span class="kw">gadget_evaluate</span>(gd,<span class="dt">log =</span> <span class="st">&#39;ling_log&#39;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;ling_model/01-base&quot;
## attr(,&quot;mainfile&quot;)
## [1] &quot;main&quot;
## attr(,&quot;class&quot;)
## [1] &quot;gadget.variant&quot; &quot;list&quot;</code></pre>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="building-complex-gadget-models.html#cb231-1"></a><span class="kw">read.gadget.parameters</span>(<span class="kw">paste0</span>(gd,<span class="st">&#39;/params.out&#39;</span>))</span></code></pre></div>
<pre><code>## [90m# A tibble: 81 x 5[39m
##    switch              value lower upper optimise
##  [90m*[39m [3m[90m&lt;chr&gt;[39m[23m               [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;dbl&gt;[39m[23m    [3m[90m&lt;dbl&gt;[39m[23m
## [90m 1[39m ling.Linf               1 -[31m[4m9[24m99[39m[31m9[39m  [4m9[24m999        0
## [90m 2[39m ling.k                  1 -[31m[4m9[24m99[39m[31m9[39m  [4m9[24m999        0
## [90m 3[39m ling.walpha             1 -[31m[4m9[24m99[39m[31m9[39m  [4m9[24m999        0
## [90m 4[39m ling.wbeta              1 -[31m[4m9[24m99[39m[31m9[39m  [4m9[24m999        0
## [90m 5[39m ling.bbin               1 -[31m[4m9[24m99[39m[31m9[39m  [4m9[24m999        0
## [90m 6[39m lingmat.M               1 -[31m[4m9[24m99[39m[31m9[39m  [4m9[24m999        0
## [90m 7[39m lingmat.init.scalar     1 -[31m[4m9[24m99[39m[31m9[39m  [4m9[24m999        0
## [90m 8[39m ling.init.F             1 -[31m[4m9[24m99[39m[31m9[39m  [4m9[24m999        0
## [90m 9[39m lingmat.init.5          1 -[31m[4m9[24m99[39m[31m9[39m  [4m9[24m999        0
## [90m10[39m lingmat.init.6          1 -[31m[4m9[24m99[39m[31m9[39m  [4m9[24m999        0
## [90m# … with 71 more rows[39m</code></pre>
<p>As you can see above, a default simulation run uses unrealistic parameter values when none
are provided. To make it a little more interesting, we change the input parameter file to
one that we know contains some reasonable values.</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="building-complex-gadget-models.html#cb233-1"></a>params.forsim &lt;-<span class="st"> </span></span>
<span id="cb233-2"><a href="building-complex-gadget-models.html#cb233-2"></a><span class="st">  </span><span class="kw">read.gadget.parameters</span>(<span class="st">&#39;data_provided/params.forsim&#39;</span>)</span>
<span id="cb233-3"><a href="building-complex-gadget-models.html#cb233-3"></a></span>
<span id="cb233-4"><a href="building-complex-gadget-models.html#cb233-4"></a><span class="kw">gadget_evaluate</span>(gd,<span class="dt">log =</span> <span class="st">&#39;simple_log2&#39;</span>,<span class="dt">params.in =</span> params.forsim)</span></code></pre></div>
<pre><code>## [1] &quot;ling_model/01-base&quot;
## attr(,&quot;mainfile&quot;)
## [1] &quot;main&quot;
## attr(,&quot;class&quot;)
## [1] &quot;gadget.variant&quot; &quot;list&quot;</code></pre>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="building-complex-gadget-models.html#cb235-1"></a>params.forsim</span></code></pre></div>
<pre><code>## [90m# A tibble: 80 x 5[39m
##    switch                     value    lower upper optimise
##  [90m*[39m [3m[90m&lt;chr&gt;[39m[23m                      [3m[90m&lt;dbl&gt;[39m[23m    [3m[90m&lt;dbl&gt;[39m[23m [3m[90m&lt;dbl&gt;[39m[23m    [3m[90m&lt;dbl&gt;[39m[23m
## [90m 1[39m ling.Linf           163.         1.00[90me[39m+ 2   200        1
## [90m 2[39m ling.k               96.2        4.00[90me[39m+ 1   100        1
## [90m 3[39m ling.walpha           0.000[4m0[24m[4m0[24m[4m2[24m28 1.00[90me[39m[31m-10[39m     1        0
## [90m 4[39m ling.wbeta            3.20       2.00[90me[39m+ 0     4        0
## [90m 5[39m ling.bbin            26.7        1.00[90me[39m[31m- 8[39m   100        1
## [90m 6[39m lingimm.M             0.15       1.00[90me[39m[31m- 3[39m     1        0
## [90m 7[39m lingimm.init.scalar   1.66       1.00[90me[39m+ 0   300        1
## [90m 8[39m ling.init.F           0.219      1.00[90me[39m[31m- 1[39m     1        1
## [90m 9[39m lingimm.init.3      366.         1.00[90me[39m[31m- 3[39m  [4m1[24m000        1
## [90m10[39m lingimm.init.4      377.         1.00[90me[39m[31m- 3[39m  [4m1[24m000        1
## [90m# … with 70 more rows[39m</code></pre>
<p>We can as before look into the simulation results:</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="building-complex-gadget-models.html#cb237-1"></a>params.forsim <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb237-2"><a href="building-complex-gadget-models.html#cb237-2"></a><span class="st">  </span><span class="kw">write.gadget.parameters</span>(<span class="kw">paste</span>(gd, <span class="st">&#39;params.forsim&#39;</span>, <span class="dt">sep=</span> <span class="st">&#39;/&#39;</span>))</span>
<span id="cb237-3"><a href="building-complex-gadget-models.html#cb237-3"></a></span>
<span id="cb237-4"><a href="building-complex-gadget-models.html#cb237-4"></a>fit &lt;-<span class="st"> </span><span class="kw">gadget.fit</span>(<span class="dt">gd =</span> gd, <span class="dt">wgts =</span> <span class="ot">NULL</span>, <span class="dt">params.file =</span> <span class="st">&#39;params.forsim&#39;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Reading input data&quot;
## [1] &quot;Running Gadget&quot;
## [1] &quot;Reading output files&quot;
## [1] &quot;Gathering results&quot;
## [1] &quot;Merging input and output&quot;</code></pre>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="building-complex-gadget-models.html#cb239-1"></a><span class="co">## standard ICES plots</span></span>
<span id="cb239-2"><a href="building-complex-gadget-models.html#cb239-2"></a></span>
<span id="cb239-3"><a href="building-complex-gadget-models.html#cb239-3"></a><span class="kw">library</span>(patchwork)</span>
<span id="cb239-4"><a href="building-complex-gadget-models.html#cb239-4"></a><span class="kw">plot</span>(fit, <span class="dt">data =</span> <span class="st">&#39;res.by.year&#39;</span>,<span class="dt">type=</span><span class="st">&#39;catch&#39;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb239-5"><a href="building-complex-gadget-models.html#cb239-5"></a><span class="st">  </span><span class="kw">plot</span>(fit, <span class="dt">data =</span>  <span class="st">&#39;res.by.year&#39;</span>, <span class="dt">type =</span> <span class="st">&#39;rec&#39;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb239-6"><a href="building-complex-gadget-models.html#cb239-6"></a><span class="st">  </span><span class="kw">plot</span>(fit, <span class="dt">data =</span> <span class="st">&#39;res.by.year&#39;</span>, <span class="dt">type =</span> <span class="st">&#39;F&#39;</span>) <span class="op">+</span></span>
<span id="cb239-7"><a href="building-complex-gadget-models.html#cb239-7"></a><span class="st">  </span><span class="kw">plot</span>(fit, <span class="dt">data =</span> <span class="st">&#39;res.by.year&#39;</span>, <span class="dt">type =</span> <span class="st">&#39;total&#39;</span>)</span></code></pre></div>
<p><img src="day2_lingmodel_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
</div>
<div id="talking-points" class="section level2">
<h2><span class="header-section-number">6.5</span> Talking points</h2>
<ul>
<li>How would you structure your model?
<ul>
<li>Split by sex?</li>
<li>How many fleets?</li>
<li>…</li>
</ul></li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="defining-stock-interations.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="fitting-a-model-to-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="assets/gitbook-2.6.7/js/app.min.js"></script>
<script src="assets/gitbook-2.6.7/js/lunr.js"></script>
<script src="assets/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/hafro/gadget-course/edit/master/day2_lingmodel.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/hafro/gadget-course/blob/master/day2_lingmodel.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
